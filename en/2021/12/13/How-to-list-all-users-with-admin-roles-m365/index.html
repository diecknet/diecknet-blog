<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>List all Users with administrative roles in a Microsoft 365 environment | diecknet</title>
<meta name=keywords content="azure ad,microsoft 365,powershell"><meta name=description content="Option 1: Use M365 Admin Portal
There is finally a way in the main Microsoft 365 Admin Portal. Go to &ldquo;Roles&rdquo; -> &ldquo;Role assignments&rdquo; and click on &ldquo;Export admin list&rdquo; to get a CSV file with all admins and their roles.


Option 2: Use PowerShell / Azure AD Graph Module
Just a short PowerShell snippet to list all users with administrative roles in a Microsoft 365 (or Azure AD) environment. Please note that this uses the older Azure AD Graph Module (already planned for deprecation). I don&rsquo;t have an example code that uses the newer Microsoft Graph API yet."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/en/2021/12/13/How-to-list-all-users-with-admin-roles-m365/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://diecknet.de/en/2021/12/13/How-to-list-all-users-with-admin-roles-m365/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="List all Users with administrative roles in a Microsoft 365 environment"><meta property="og:description" content="Option 1: Use M365 Admin Portal
There is finally a way in the main Microsoft 365 Admin Portal. Go to &ldquo;Roles&rdquo; -> &ldquo;Role assignments&rdquo; and click on &ldquo;Export admin list&rdquo; to get a CSV file with all admins and their roles.


Option 2: Use PowerShell / Azure AD Graph Module
Just a short PowerShell snippet to list all users with administrative roles in a Microsoft 365 (or Azure AD) environment. Please note that this uses the older Azure AD Graph Module (already planned for deprecation). I don&rsquo;t have an example code that uses the newer Microsoft Graph API yet."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/en/2021/12/13/How-to-list-all-users-with-admin-roles-m365/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-13T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-13T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="List all Users with administrative roles in a Microsoft 365 environment"><meta name=twitter:description content="Option 1: Use M365 Admin Portal
There is finally a way in the main Microsoft 365 Admin Portal. Go to &ldquo;Roles&rdquo; -> &ldquo;Role assignments&rdquo; and click on &ldquo;Export admin list&rdquo; to get a CSV file with all admins and their roles.


Option 2: Use PowerShell / Azure AD Graph Module
Just a short PowerShell snippet to list all users with administrative roles in a Microsoft 365 (or Azure AD) environment. Please note that this uses the older Azure AD Graph Module (already planned for deprecation). I don&rsquo;t have an example code that uses the newer Microsoft Graph API yet."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/en/posts/"},{"@type":"ListItem","position":2,"name":"List all Users with administrative roles in a Microsoft 365 environment","item":"https://diecknet.de/en/2021/12/13/How-to-list-all-users-with-admin-roles-m365/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"List all Users with administrative roles in a Microsoft 365 environment","name":"List all Users with administrative roles in a Microsoft 365 environment","description":"Option 1: Use M365 Admin Portal There is finally a way in the main Microsoft 365 Admin Portal. Go to \u0026ldquo;Roles\u0026rdquo; -\u0026gt; \u0026ldquo;Role assignments\u0026rdquo; and click on \u0026ldquo;Export admin list\u0026rdquo; to get a CSV file with all admins and their roles.\nOption 2: Use PowerShell / Azure AD Graph Module Just a short PowerShell snippet to list all users with administrative roles in a Microsoft 365 (or Azure AD) environment. Please note that this uses the older Azure AD Graph Module (already planned for deprecation). I don\u0026rsquo;t have an example code that uses the newer Microsoft Graph API yet.\n","keywords":["azure ad","microsoft 365","powershell"],"articleBody":"Option 1: Use M365 Admin Portal There is finally a way in the main Microsoft 365 Admin Portal. Go to “Roles” -\u003e “Role assignments” and click on “Export admin list” to get a CSV file with all admins and their roles.\nOption 2: Use PowerShell / Azure AD Graph Module Just a short PowerShell snippet to list all users with administrative roles in a Microsoft 365 (or Azure AD) environment. Please note that this uses the older Azure AD Graph Module (already planned for deprecation). I don’t have an example code that uses the newer Microsoft Graph API yet.\nPrerequisites You need the Azure AD PowerShell for Graph module installed, and you need to connect to your Azure AD tenant.\nInstall the Azure AD PowerShell for Graph module (if you don’t have it yet) Connect to your tenant by executing Connect-AzureAD PowerShell Code to list all admins Read the following snippet, make sure it’s not malicious or stupid, then execute it. The script outputs a CSV export into C:\\temp\\AAD_Admins.csv.\n1 2 3 4 5 6 7 8 9 10 $AllRoleAssignments = ForEach ($Role in (Get-AzureADMSRoleDefinition)) { $RoleAssignment = Get-AzureADMSRoleAssignment -Filter \"roleDefinitionId eq '$($Role.Id)'\" if($RoleAssignment) { $User = Get-AzureADObjectByObjectId -ObjectIds $RoleAssignment.PrincipalId if($User.ObjectType -eq \"User\") { $User | Select-Object DisplayName,UserPrincipalName,ObjectType } } } $AllRoleAssignments | Sort-Object -Unique \"UserPrincipalName\" | Export-csv -Encoding utf8 -NoTypeInformation -Path C:\\temp\\AAD_Admins.csv What this doesn’t do This snippet doesn’t export which roles the users have This snippet doesn’t export App/Service Principals with admin roles But that’s all that I needed at this moment. Feel free to modify the code to your needs.\n","wordCount":"263","inLanguage":"en","datePublished":"2021-12-13T00:00:00Z","dateModified":"2021-12-13T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/en/2021/12/13/How-to-list-all-users-with-admin-roles-m365/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/en/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/ title=Deutsch aria-label=Deutsch>Deutsch</a></li><li><a href=https://diecknet.de/en/ title=English aria-label=English><b>English</b></a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/en/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/en/services/ title=Services><span>Services</span></a></li><li><a href=https://diecknet.de/en/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/en/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/en/>Home</a>&nbsp;»&nbsp;<a href=https://diecknet.de/en/posts/>Posts</a></div><h1 class=post-title>List all Users with administrative roles in a Microsoft 365 environment</h1><div class=post-meta><span title='2021-12-13 00:00:00 +0000 UTC'>2021-12-13</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/en/posts/2021/2021-12-13-How-to-list-all-users-with-admin-roles-m365.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#option-1-use-m365-admin-portal aria-label="Option 1: Use M365 Admin Portal">Option 1: Use M365 Admin Portal</a></li><li><a href=#option-2-use-powershell--azure-ad-graph-module aria-label="Option 2: Use PowerShell / Azure AD Graph Module">Option 2: Use PowerShell / Azure AD Graph Module</a><ul><li><a href=#prerequisites aria-label=Prerequisites>Prerequisites</a></li><li><a href=#powershell-code-to-list-all-admins aria-label="PowerShell Code to list all admins">PowerShell Code to list all admins</a></li><li><a href=#what-this-doesnt-do aria-label="What this doesn&rsquo;t do">What this doesn&rsquo;t do</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=option-1-use-m365-admin-portal>Option 1: Use M365 Admin Portal<a hidden class=anchor aria-hidden=true href=#option-1-use-m365-admin-portal>#</a></h2><p>There is finally a way in the main Microsoft 365 Admin Portal. Go to <a href=https://admin.microsoft.com/Adminportal/Home?#/rbac/directory target=_blank>&ldquo;Roles&rdquo; -> &ldquo;Role assignments&rdquo;</a> and click on &ldquo;Export admin list&rdquo; to get a CSV file with all admins and their roles.</p><p><a href=/images/2023/2023-12-06_Export_m365_admin_role_assignments.jpg><img loading=lazy src=/images/2023/2023-12-06_Export_m365_admin_role_assignments.jpg alt="M365 Admin Center - role assignments" title="M365 Admin Center - role assignments"></a></p><h2 id=option-2-use-powershell--azure-ad-graph-module>Option 2: Use PowerShell / Azure AD Graph Module<a hidden class=anchor aria-hidden=true href=#option-2-use-powershell--azure-ad-graph-module>#</a></h2><p>Just a short PowerShell snippet to list all users with administrative roles in a Microsoft 365 (or Azure AD) environment. Please note that this uses the older Azure AD Graph Module (already planned for deprecation). I don&rsquo;t have an example code that uses the newer Microsoft Graph API <strong>yet</strong>.</p><h3 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h3><p>You need the Azure AD PowerShell for Graph module installed, and you need to connect to your Azure AD tenant.</p><ol><li><a href="https://docs.microsoft.com/en-us/powershell/azure/active-directory/install-adv2?view=azureadps-2.0" target=_blank>Install the Azure AD PowerShell for Graph module (if you don&rsquo;t have it yet)</a></li><li>Connect to your tenant by executing <code>Connect-AzureAD</code></li></ol><h3 id=powershell-code-to-list-all-admins>PowerShell Code to list all admins<a hidden class=anchor aria-hidden=true href=#powershell-code-to-list-all-admins>#</a></h3><p>Read the following snippet, make sure it&rsquo;s not malicious or stupid, then execute it. The script outputs a CSV export into <code>C:\temp\AAD_Admins.csv</code>.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$AllRoleAssignments</span> = <span style=color:#fc5fa3>ForEach</span> (<span style=color:#41a1c0>$Role</span> <span style=color:#fc5fa3>in</span> (<span style=color:#d0a8ff>Get-AzureADMSRoleDefinition</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$RoleAssignment</span> = <span style=color:#d0a8ff>Get-AzureADMSRoleAssignment</span> -Filter <span style=color:#fc6a5d>&#34;roleDefinitionId eq &#39;</span>$(<span style=color:#41a1c0>$Role</span>.Id)<span style=color:#fc6a5d>&#39;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#fc5fa3>if</span>(<span style=color:#41a1c0>$RoleAssignment</span>) {
</span></span><span style=display:flex><span>        <span style=color:#41a1c0>$User</span> = <span style=color:#d0a8ff>Get-AzureADObjectByObjectId</span> -ObjectIds <span style=color:#41a1c0>$RoleAssignment</span>.PrincipalId
</span></span><span style=display:flex><span>        <span style=color:#fc5fa3>if</span>(<span style=color:#41a1c0>$User</span>.ObjectType -eq <span style=color:#fc6a5d>&#34;User&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#41a1c0>$User</span> | <span style=color:#d0a8ff>Select-Object</span> DisplayName,UserPrincipalName,ObjectType
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#41a1c0>$AllRoleAssignments</span> | <span style=color:#d0a8ff>Sort-Object</span> -Unique <span style=color:#fc6a5d>&#34;UserPrincipalName&#34;</span> | <span style=color:#d0a8ff>Export-csv</span> -Encoding utf8 -NoTypeInformation -Path C:\temp\AAD_Admins.csv
</span></span></code></pre></td></tr></table></div></div><h3 id=what-this-doesnt-do>What this doesn&rsquo;t do<a hidden class=anchor aria-hidden=true href=#what-this-doesnt-do>#</a></h3><ol><li>This snippet doesn&rsquo;t export which roles the users have</li><li>This snippet doesn&rsquo;t export App/Service Principals with admin roles</li></ol><p>But that&rsquo;s all that I needed at this moment. Feel free to modify the code to your needs.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/en/tags/azure-ad/>Azure Ad</a></li><li><a href=https://diecknet.de/en/tags/microsoft-365/>Microsoft 365</a></li><li><a href=https://diecknet.de/en/tags/powershell/>Powershell</a></li></ul><div class=share-buttons></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://diecknet.de/en/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/en/legal/>Imprint</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/en/privacy/>Privacy</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>