<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Downside of going serverless | diecknet</title>
<meta name=keywords content="simpleip,serverless,cloud,vercel,cloudflare,cloudflareworkers,ipaddress,php"><meta name=description content="After creating SimpleIP.de as a serverless application (see my blog post My simple serverless journey was not that easy) I was kinda proud. Interesting technology, small and useful website. Nice.
Reality But after a while reality kicked in. I was playing around with some IPv6 systems, when it hit me. With the previous design, the site would show only the primary IP-Address of the client. If the client supports both IPv6 and IPv4, it would still only show one IP-Address."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/en/2021/10/27/My-simple-serverless-journey-part2/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://diecknet.de/en/2021/10/27/My-simple-serverless-journey-part2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="The Downside of going serverless"><meta property="og:description" content="After creating SimpleIP.de as a serverless application (see my blog post My simple serverless journey was not that easy) I was kinda proud. Interesting technology, small and useful website. Nice.
Reality But after a while reality kicked in. I was playing around with some IPv6 systems, when it hit me. With the previous design, the site would show only the primary IP-Address of the client. If the client supports both IPv6 and IPv4, it would still only show one IP-Address."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/en/2021/10/27/My-simple-serverless-journey-part2/"><meta property="og:image" content="https://diecknet.de/images/2021/2021-10-27_SimpleIP.de.update.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-27T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://diecknet.de/images/2021/2021-10-27_SimpleIP.de.update.png"><meta name=twitter:title content="The Downside of going serverless"><meta name=twitter:description content="After creating SimpleIP.de as a serverless application (see my blog post My simple serverless journey was not that easy) I was kinda proud. Interesting technology, small and useful website. Nice.
Reality But after a while reality kicked in. I was playing around with some IPv6 systems, when it hit me. With the previous design, the site would show only the primary IP-Address of the client. If the client supports both IPv6 and IPv4, it would still only show one IP-Address."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/en/posts/"},{"@type":"ListItem","position":2,"name":"The Downside of going serverless","item":"https://diecknet.de/en/2021/10/27/My-simple-serverless-journey-part2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Downside of going serverless","name":"The Downside of going serverless","description":"After creating SimpleIP.de as a serverless application (see my blog post My simple serverless journey was not that easy) I was kinda proud. Interesting technology, small and useful website. Nice.\nReality But after a while reality kicked in. I was playing around with some IPv6 systems, when it hit me. With the previous design, the site would show only the primary IP-Address of the client. If the client supports both IPv6 and IPv4, it would still only show one IP-Address.","keywords":["simpleip","serverless","cloud","vercel","cloudflare","cloudflareworkers","ipaddress","php"],"articleBody":"After creating SimpleIP.de as a serverless application (see my blog post My simple serverless journey was not that easy) I was kinda proud. Interesting technology, small and useful website. Nice.\nReality But after a while reality kicked in. I was playing around with some IPv6 systems, when it hit me. With the previous design, the site would show only the primary IP-Address of the client. If the client supports both IPv6 and IPv4, it would still only show one IP-Address.\nI tried a bit around. Eventhough Cloudflare allows DNS Host A (IPv4) and AAAA (IPv6) entries, it wouldn‚Äôt work as I wanted. Cloudflare needs to proxy the DNS entries, to make Cloudflarer Workers work. And even if you only add one IP Version, it would still proxy for both Internet Protocol versions. So the reality of serverless is: You only have very limited control over the server that hosts your application. For some scenarios that might be okay, for others not.\nMy Workaround I wouldn‚Äôt really call this a fix, just a hacky workaround. I created a subdomain alt.simpleip.de that points to a Shared Webhost Account at Netcup. In my Netcup Customer Control Panel, I added two Subdomains (or rather Sub-Subdomains):\nv4.alt.simpleip.de v6.alt.simpleip.de I then added ‚ÄúLet‚Äôs Encrypt‚Äù TLS certificates and put a small PHP-Script on the server. The script outputs the IP-Address of the client using\n1 print $_SERVER['REMOTE_ADDR']; The trick is, that v4.alt.simpleip.de only has a Host A Record - so it only works for IPv4 clients. And v6.alt.simpleip.de only has a Host AAAA Record - so it only works for IPv6 clients. Initially I wanted to use ipv4.alt.simpleip.de and ipv6.alt.simpleip.de, but apparently a bug in the Netcup Plesk Control Panel prevented that ü§î. Weird.\nAnyway my API is running. Next step was to add some JavaScript code to the website. The code tries to connect to both of these hostnames. If there is a result, it‚Äôll get added to the site. I left the old Cloudflare based approach still in the site. So when a client requests the page, the new program flow is as follows:\nCloudflare Workers injects the Client-IP-Address into the HTML and delivers the site (No Client-JS needed). When the HTML Body loads and Client-JS is enabled: Client based JavaScript call to IPv4 endpoint Client based JavaScript call to IPv6 endpoint Conclusion So it‚Äôs still kinda serverless, since I don‚Äôt administer the Webserver at Netcup üòá. It‚Äôs a Shared Webhost package. When going serverless, there are several obstacles, but there‚Äôs mostlikely a Workaround. For my use case, I still prefer these workarounds instead of administering a full server.\n","wordCount":"434","inLanguage":"en","image":"https://diecknet.de/images/2021/2021-10-27_SimpleIP.de.update.png","datePublished":"2021-10-27T00:00:00Z","dateModified":"2021-10-27T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/en/2021/10/27/My-simple-serverless-journey-part2/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/en/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/ title=Deutsch aria-label=Deutsch>Deutsch</a></li><li><a href=https://diecknet.de/en/ title=English aria-label=English><b>English</b></a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/en/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/en/services/ title=Services><span>Services</span></a></li><li><a href=https://diecknet.de/en/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/en/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/en/>Home</a>&nbsp;¬ª&nbsp;<a href=https://diecknet.de/en/posts/>Posts</a></div><h1 class=post-title>The Downside of going serverless</h1><div class=post-meta><span title='2021-10-27 00:00:00 +0000 UTC'>2021-10-27</span>&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/en/posts/2021/2021-10-27-My-simple-serverless-journey-part2.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><figure class=entry-cover><img loading=lazy src=https://diecknet.de/images/2021/2021-10-27_SimpleIP.de.update.png alt></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#reality aria-label=Reality>Reality</a></li><li><a href=#my-workaround aria-label="My Workaround">My Workaround</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><p>After creating <a href=https://simpleip.de target=_blank>SimpleIP.de</a> as a serverless application (see my blog post <a href=/en/2021/05/02/My-simple-serverless-journey/>My simple serverless journey was not that easy</a>) I was kinda proud. Interesting technology, small and useful website. Nice.</p><h2 id=reality>Reality<a hidden class=anchor aria-hidden=true href=#reality>#</a></h2><p>But after a while reality kicked in. I was playing around with some IPv6 systems, when it hit me. With the previous design, the site would show only the <em>primary</em> IP-Address of the client. If the client supports both IPv6 <strong>and</strong> IPv4, it would still only show one IP-Address.</p><p>I tried a bit around. Eventhough Cloudflare allows DNS Host A (IPv4) and AAAA (IPv6) entries, it wouldn&rsquo;t work as I wanted. Cloudflare needs to proxy the DNS entries, to make Cloudflarer Workers work. And even if you only add one IP Version, it would still proxy for both Internet Protocol versions. So the reality of serverless is: <strong>You only have very limited control over the server that hosts your application.</strong> For some scenarios that might be okay, for others not.</p><h2 id=my-workaround>My Workaround<a hidden class=anchor aria-hidden=true href=#my-workaround>#</a></h2><p>I wouldn&rsquo;t really call this a fix, just a hacky workaround. I created a subdomain <code>alt.simpleip.de</code> that points to a Shared Webhost Account at <a href=https://netcup.de target=_blank>Netcup</a>. In my Netcup Customer Control Panel, I added two Subdomains (or rather Sub-Subdomains):</p><ul><li><code>v4.alt.simpleip.de</code></li><li><code>v6.alt.simpleip.de</code></li></ul><p>I then added &ldquo;Let&rsquo;s Encrypt&rdquo; TLS certificates and put a <a href=https://github.com/diecknet/simple-ip-site/blob/8a50cbe079227c6972c3d6b80cc7b5a07c0bfc4e/alt.simpleip.de/index.php target=_blank>small PHP-Script</a> on the server. The script outputs the IP-Address of the client using</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#fc5fa3>print</span> <span style=color:#41a1c0>$_SERVER</span>[<span style=color:#fc6a5d>&#39;REMOTE_ADDR&#39;</span>];
</span></span></code></pre></td></tr></table></div></div><p>The trick is, that <code>v4.alt.simpleip.de</code> only has a Host A Record - so it only works for IPv4 clients. And <code>v6.alt.simpleip.de</code> only has a Host AAAA Record - so it only works for IPv6 clients. Initially I wanted to use <code>ipv4.alt.simpleip.de</code> and <code>ipv6.alt.simpleip.de</code>, but apparently a bug in the Netcup Plesk Control Panel prevented that ü§î. Weird.</p><p>Anyway my API is running. Next step was to add some JavaScript code to the website. The code tries to connect to both of these hostnames. If there is a result, it&rsquo;ll get added to the site. I left the old Cloudflare based approach still in the site. So when a client requests the page, the new program flow is as follows:</p><ol><li>Cloudflare Workers injects the Client-IP-Address into the HTML and delivers the site (No Client-JS needed).</li><li>When the HTML Body loads <strong>and</strong> Client-JS is enabled:<ul><li>Client based JavaScript call to <strong>IPv4</strong> endpoint</li><li>Client based JavaScript call to <strong>IPv6</strong> endpoint</li></ul></li></ol><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>So it&rsquo;s still <em>kinda</em> serverless, since I don&rsquo;t administer the Webserver at Netcup üòá. It&rsquo;s a Shared Webhost package. When going serverless, there are several obstacles, but there&rsquo;s mostlikely a Workaround. For my use case, I still prefer these workarounds instead of administering a full server.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/en/tags/simpleip/>Simpleip</a></li><li><a href=https://diecknet.de/en/tags/serverless/>Serverless</a></li><li><a href=https://diecknet.de/en/tags/cloud/>Cloud</a></li><li><a href=https://diecknet.de/en/tags/vercel/>Vercel</a></li><li><a href=https://diecknet.de/en/tags/cloudflare/>Cloudflare</a></li><li><a href=https://diecknet.de/en/tags/cloudflareworkers/>Cloudflareworkers</a></li><li><a href=https://diecknet.de/en/tags/ipaddress/>Ipaddress</a></li><li><a href=https://diecknet.de/en/tags/php/>Php</a></li></ul><div class=share-buttons></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://diecknet.de/en/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/en/legal/>Imprint</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/en/privacy/>Privacy</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>