<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PowerShell NTFS Alternate Data Streams | diecknet</title>
<meta name=keywords content="powershell,ntfs"><meta name=description content="The NTFS file system is used by default in Windows. And normally a file has only one associated normal data stream with the name :$DATA. But there are also the so-called &ldquo;Alternate Data Streams&rdquo; (ADS), which can contain additional data. These ADS are not visible in the Windows Explorer or most other applications.
ADS are sometimes used by the system, but could also be used by attackers to hide data."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=de href=https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/><link rel=alternate hreflang=en href=https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="PowerShell NTFS Alternate Data Streams"><meta property="og:description" content="The NTFS file system is used by default in Windows. And normally a file has only one associated normal data stream with the name :$DATA. But there are also the so-called &ldquo;Alternate Data Streams&rdquo; (ADS), which can contain additional data. These ADS are not visible in the Windows Explorer or most other applications.
ADS are sometimes used by the system, but could also be used by attackers to hide data."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-30T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-30T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="PowerShell NTFS Alternate Data Streams"><meta name=twitter:description content="The NTFS file system is used by default in Windows. And normally a file has only one associated normal data stream with the name :$DATA. But there are also the so-called &ldquo;Alternate Data Streams&rdquo; (ADS), which can contain additional data. These ADS are not visible in the Windows Explorer or most other applications.
ADS are sometimes used by the system, but could also be used by attackers to hide data."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/en/posts/"},{"@type":"ListItem","position":2,"name":"PowerShell NTFS Alternate Data Streams","item":"https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PowerShell NTFS Alternate Data Streams","name":"PowerShell NTFS Alternate Data Streams","description":"The NTFS file system is used by default in Windows. And normally a file has only one associated normal data stream with the name :$DATA. But there are also the so-called \u0026ldquo;Alternate Data Streams\u0026rdquo; (ADS), which can contain additional data. These ADS are not visible in the Windows Explorer or most other applications.\nADS are sometimes used by the system, but could also be used by attackers to hide data.","keywords":["powershell","ntfs"],"articleBody":"The NTFS file system is used by default in Windows. And normally a file has only one associated normal data stream with the name :$DATA. But there are also the so-called “Alternate Data Streams” (ADS), which can contain additional data. These ADS are not visible in the Windows Explorer or most other applications.\nADS are sometimes used by the system, but could also be used by attackers to hide data.\nRead NTFS Alternate Data Streams Many web browsers on windows stamp downloaded files from the Internet with a “Mark of the web” (MOTW) in the Zone.Identifier stream. This stream contains information about the source of the file - e.g. that it was downloaded from the Internet. To read the content of an ADS, you can simply use Get-Content with the -Stream parameter and the stream name. Alternatively, : can be appended to the file name.\n1 2 3 4 5 6 7 8 9 # Two variants to read the Zone.Identifier Stream Get-Content .\\Example.txt -Stream Zone.Identifier Get-Content .\\Example.txt:Zone.Identifier # Return [ZoneTransfer] ZoneId=3 ReferrerUrl=https://diecknet.de HostUrl=https://github.com The actual content of Zone.Identifier can vary. Sometimes it contains more or less information. However, the information on the ZoneId should always be included. The following values are possible for the zone:\nValue Meaning 0 My Computer 1 Local Intranet Zone 2 Trusted sites Zone 3 Internet Zone 4 Restricted Sites Zone Source: https://learn.microsoft.com/en-us/previous-versions/troubleshoot/browsers/security-privacy/ie-security-zones-registry-entries#zones\nThe Windows Smartscreen Filter sometimes also creates its own ADS called SmartScreen. If it contains Anaheim, the file has been classified as unsafe.\n1 2 3 4 Get-Content .\\Example.exe -Stream Smartscreen # Return Anaheim And if there are any other streams, you can of course read them using the same procedure.\nRemove the Mark of the web The regular way to remove the “Mark of the web” is via Unblock-File or via the properties dialog of the file.\n1 Unblock-File .\\MyFile.docx Find NTFS Alternate Data Streams To find out which Alternate Data Streams are available, the -Stream parameter of the Get-Item cmdlet can be used. With * as a placeholder, we can find all ADS.\n1 2 # List all streams of all data in the current directory Get-Item * -Stream * We can also filter out the information that the standard :$DATA stream is available:\n1 Get-Item * -Stream * | Where-Object {$_.Stream -ne ':$DATA' } With my Get-NTFSADS.ps1 script it’s even a bit easier and prettier. Check it out on Github.\nWrite NTFS Alternate Data Streams It is possible to write your own data into ADS. For example, Set-Content/Add-Content can be used for this.\n1 2 3 4 5 6 7 # Two variants to set the example stream, it may be overwritten Set-Content .\\MyFile.docx -Stream \"Example\" -Value \"Hello PowerShell!\" Set-Content .\\MyFile.docx:Example -Value \"Hello PowerShell!\" # Two variants to add to the example stream Add-Content .\\MyFile.docx -Stream \"Beispiel\" -Value \"Hello PowerShell!\" Add-Content .\\MyFile.docx:Example -Value \"Hello PowerShell!\" Delete NTFS Alternate Data Streams ADS can also be deleted via Remove-Item like normal files. The file and the :$DATA stream would continue to exist in the following example:\n1 Remove-Item .\\MyFile.docx -Stream \"Example\" Conclusion NTFS Alternate Data Streams are an interesting function. They are less suitable as a gateway for attackers, as no additional data streams can be transferred during a normal download. However, ADS could still be transferred in some container formats, e.g. within .vhdx files for virtual hard disk images. However, the use of an ADS-capable container would also be very suspicious.\nI think that ADS could rather be used by attackers if they have already infiltrated a system. Malicious code or other data could then be hidden. However, modern EDR solutions should (in my opinion) take action if ADS is used. Technically, this would be possible via Sysmon logging, for example.\n","wordCount":"623","inLanguage":"en","datePublished":"2024-08-30T00:00:00Z","dateModified":"2024-08-30T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/en/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/ title=Deutsch aria-label=Deutsch>Deutsch</a></li><li><a href=https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/ title=English aria-label=English><b>English</b></a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/en/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/en/services/ title=Services><span>Services</span></a></li><li><a href=https://diecknet.de/en/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/en/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/en/>Home</a>&nbsp;»&nbsp;<a href=https://diecknet.de/en/posts/>Posts</a></div><h1 class=post-title>PowerShell NTFS Alternate Data Streams</h1><div class=post-meta><span title='2024-08-30 00:00:00 +0000 UTC'>2024-08-30</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<ul class=i18n_list>🌍&nbsp;Dieser Inhalt ist auch verfügbar auf:&nbsp;<li><a href=https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/>Deutsch</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/en/posts/2024/2024-08-30-PowerShell-NTFS-Alternate-Data-Streams.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#read-ntfs-alternate-data-streams aria-label="Read NTFS Alternate Data Streams">Read NTFS Alternate Data Streams</a><ul><li><a href=#remove-the-mark-of-the-web aria-label="Remove the Mark of the web">Remove the Mark of the web</a></li></ul></li><li><a href=#find-ntfs-alternate-data-streams aria-label="Find NTFS Alternate Data Streams">Find NTFS Alternate Data Streams</a></li><li><a href=#write-ntfs-alternate-data-streams aria-label="Write NTFS Alternate Data Streams">Write NTFS Alternate Data Streams</a></li><li><a href=#delete-ntfs-alternate-data-streams aria-label="Delete NTFS Alternate Data Streams">Delete NTFS Alternate Data Streams</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><p>The NTFS file system is used by default in Windows. And normally a file has only one associated normal data stream with the name <code>:$DATA</code>. But there are also the so-called &ldquo;Alternate Data Streams&rdquo; (ADS), which can contain additional data. These ADS are not visible in the Windows Explorer or most other applications.</p><p>ADS are sometimes used by the system, but could also be used by attackers to hide data.</p><h2 id=read-ntfs-alternate-data-streams>Read NTFS Alternate Data Streams<a hidden class=anchor aria-hidden=true href=#read-ntfs-alternate-data-streams>#</a></h2><p>Many web browsers on windows stamp downloaded files from the Internet with a &ldquo;Mark of the web&rdquo; (MOTW) in the <code>Zone.Identifier</code> stream. This stream contains information about the source of the file - e.g. that it was downloaded from the Internet.
To read the content of an ADS, you can simply use <code>Get-Content</code> with the <code>-Stream</code> parameter and the stream name. Alternatively, <code>:&lt;name of stream></code> can be appended to the file name.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Two variants to read the Zone.Identifier Stream</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-Content</span> .\Example.txt -Stream Zone.Identifier
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-Content</span> .\Example.txt<span style=color:#960050>:</span>Zone.Identifier
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Return</span>
</span></span><span style=display:flex><span>[ZoneTransfer]
</span></span><span style=display:flex><span>ZoneId=<span style=color:#d0bf69>3</span>
</span></span><span style=display:flex><span>ReferrerUrl=https<span style=color:#960050>:</span>//diecknet.de
</span></span><span style=display:flex><span>HostUrl=https<span style=color:#960050>:</span>//github.com
</span></span></code></pre></td></tr></table></div></div><p>The actual content of <code>Zone.Identifier</code> can vary. Sometimes it contains more or less information. However, the information on the <code>ZoneId</code> should always be included. The following values are possible for the zone:</p><table><thead><tr><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td>0</td><td>My Computer</td></tr><tr><td>1</td><td>Local Intranet Zone</td></tr><tr><td>2</td><td>Trusted sites Zone</td></tr><tr><td>3</td><td>Internet Zone</td></tr><tr><td>4</td><td>Restricted Sites Zone</td></tr></tbody></table><p>Source: <a href=https://learn.microsoft.com/en-us/previous-versions/troubleshoot/browsers/security-privacy/ie-security-zones-registry-entries#zones target=_blank>https://learn.microsoft.com/en-us/previous-versions/troubleshoot/browsers/security-privacy/ie-security-zones-registry-entries#zones</a></p><p>The Windows Smartscreen Filter sometimes also creates its own ADS called <code>SmartScreen</code>. If it contains <code>Anaheim</code>, the file has been classified as unsafe.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-Content</span> .\Example.exe -Stream Smartscreen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Return</span>
</span></span><span style=display:flex><span>Anaheim
</span></span></code></pre></td></tr></table></div></div><p>And if there are any other streams, you can of course read them using the same procedure.</p><h3 id=remove-the-mark-of-the-web>Remove the Mark of the web<a hidden class=anchor aria-hidden=true href=#remove-the-mark-of-the-web>#</a></h3><p>The regular way to remove the &ldquo;Mark of the web&rdquo; is via <code>Unblock-File</code> or via the properties dialog of the file.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Unblock-File</span> .\MyFile.docx
</span></span></code></pre></td></tr></table></div></div><p><a href=/images/2024/2024-08-30_NTFS_ADS_Properties.jpg><img loading=lazy src=/images/2024/2024-08-30_NTFS_ADS_Properties.jpg alt="Setting the checkmark &amp;lsquo;Unblock&amp;rsquo; in the file properties, removes the Mark of the web" title="Setting the checkmark 'Unblock' in the file properties, removes the Mark of the web"></a></p><h2 id=find-ntfs-alternate-data-streams>Find NTFS Alternate Data Streams<a hidden class=anchor aria-hidden=true href=#find-ntfs-alternate-data-streams>#</a></h2><p>To find out which Alternate Data Streams are available, the <code>-Stream</code> parameter of the <code>Get-Item</code> cmdlet can be used. With <code>*</code> as a placeholder, we can find all ADS.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># List all streams of all data in the current directory</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-Item</span> * -Stream *
</span></span></code></pre></td></tr></table></div></div><p>We can also filter out the information that the standard <code>:$DATA</code> stream is available:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-Item</span> * -Stream * | <span style=color:#d0a8ff>Where-Object</span> {<span style=color:#41a1c0>$_</span>.Stream -ne <span style=color:#fc6a5d>&#39;:$DATA&#39;</span> }
</span></span></code></pre></td></tr></table></div></div><p>With my <a href=https://github.com/diecknet/diecknet-scripts/blob/main/Windows/Get-NTFSADS.ps1 target=_blank><code>Get-NTFSADS.ps1 script</code></a> it&rsquo;s even a bit easier and prettier. Check it out on <a href=https://github.com/diecknet/diecknet-scripts/blob/main/Windows/Get-NTFSADS.ps1 target=_blank>Github</a>.</p><h2 id=write-ntfs-alternate-data-streams>Write NTFS Alternate Data Streams<a hidden class=anchor aria-hidden=true href=#write-ntfs-alternate-data-streams>#</a></h2><p>It is possible to write your own data into ADS. For example, <code>Set-Content</code>/<code>Add-Content</code> can be used for this.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Two variants to set the example stream, it may be overwritten</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Set-Content</span> .\MyFile.docx -Stream <span style=color:#fc6a5d>&#34;Example&#34;</span> -Value <span style=color:#fc6a5d>&#34;Hello PowerShell!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Set-Content</span> .\MyFile.docx<span style=color:#960050>:</span>Example -Value <span style=color:#fc6a5d>&#34;Hello PowerShell!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Two variants to add to the example stream</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Add-Content</span> .\MyFile.docx -Stream <span style=color:#fc6a5d>&#34;Beispiel&#34;</span> -Value <span style=color:#fc6a5d>&#34;Hello PowerShell!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Add-Content</span> .\MyFile.docx<span style=color:#960050>:</span>Example -Value <span style=color:#fc6a5d>&#34;Hello PowerShell!&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=delete-ntfs-alternate-data-streams>Delete NTFS Alternate Data Streams<a hidden class=anchor aria-hidden=true href=#delete-ntfs-alternate-data-streams>#</a></h2><p>ADS can also be deleted via <code>Remove-Item</code> like normal files. The file and the <code>:$DATA</code> stream would continue to exist in the following example:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Remove-Item</span> .\MyFile.docx -Stream <span style=color:#fc6a5d>&#34;Example&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>NTFS Alternate Data Streams are an interesting function. They are less suitable as a gateway for attackers, as no additional data streams can be transferred during a normal download. However, ADS could still be transferred in some container formats, e.g. within <code>.vhdx</code> files for virtual hard disk images. However, the use of an ADS-capable container would also be very suspicious.</p><p>I think that ADS could rather be used by attackers if they have already infiltrated a system. Malicious code or other data could then be hidden. However, modern EDR solutions should (in my opinion) take action if ADS is used. Technically, this would be possible via Sysmon logging, for example.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/en/tags/powershell/>Powershell</a></li><li><a href=https://diecknet.de/en/tags/ntfs/>Ntfs</a></li></ul><div class=share-buttons></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://diecknet.de/en/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/en/legal/>Imprint</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/en/privacy/>Privacy</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>