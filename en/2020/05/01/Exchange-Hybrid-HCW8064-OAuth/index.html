<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Exchange Hybrid: HCW8064 OAuth configuration couldn't get performed | diecknet</title>
<meta name=keywords content="exchange,exchange2013,exchangehybrid,oauth,office365"><meta name=description content="At the end of the Hybrid Configuration Wizard (HCW) I received the following warning message:
HCW8064 - The HCW has completed, but was not able to perform the OAuth portion of your Hybrid configuration. If you need features that rely on OAuth, you can try running the HCW again or manually configure OAuth using these manual steps.
The link &ldquo;more information&rdquo; links to https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. If you lookup what OAuth is used for, this article comes up."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=de href=https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/><link rel=alternate hreflang=en href=https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Exchange Hybrid: HCW8064 OAuth configuration couldn't get performed"><meta property="og:description" content="At the end of the Hybrid Configuration Wizard (HCW) I received the following warning message:
HCW8064 - The HCW has completed, but was not able to perform the OAuth portion of your Hybrid configuration. If you need features that rely on OAuth, you can try running the HCW again or manually configure OAuth using these manual steps.
The link &ldquo;more information&rdquo; links to https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. If you lookup what OAuth is used for, this article comes up."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/"><meta property="og:image" content="https://diecknet.de/images/2020/2020-04-28-HCW8064-01.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-05-01T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://diecknet.de/images/2020/2020-04-28-HCW8064-01.png"><meta name=twitter:title content="Exchange Hybrid: HCW8064 OAuth configuration couldn't get performed"><meta name=twitter:description content="At the end of the Hybrid Configuration Wizard (HCW) I received the following warning message:
HCW8064 - The HCW has completed, but was not able to perform the OAuth portion of your Hybrid configuration. If you need features that rely on OAuth, you can try running the HCW again or manually configure OAuth using these manual steps.
The link &ldquo;more information&rdquo; links to https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. If you lookup what OAuth is used for, this article comes up."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/en/posts/"},{"@type":"ListItem","position":2,"name":"Exchange Hybrid: HCW8064 OAuth configuration couldn't get performed","item":"https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Exchange Hybrid: HCW8064 OAuth configuration couldn't get performed","name":"Exchange Hybrid: HCW8064 OAuth configuration couldn\u0027t get performed","description":"At the end of the Hybrid Configuration Wizard (HCW) I received the following warning message:\nHCW8064 - The HCW has completed, but was not able to perform the OAuth portion of your Hybrid configuration. If you need features that rely on OAuth, you can try running the HCW again or manually configure OAuth using these manual steps.\nThe link \u0026ldquo;more information\u0026rdquo; links to https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. If you lookup what OAuth is used for, this article comes up.","keywords":["exchange","exchange2013","exchangehybrid","oauth","office365"],"articleBody":"At the end of the Hybrid Configuration Wizard (HCW) I received the following warning message:\nHCW8064 - The HCW has completed, but was not able to perform the OAuth portion of your Hybrid configuration. If you need features that rely on OAuth, you can try running the HCW again or manually configure OAuth using these manual steps.\nThe link ‚Äúmore information‚Äù links to https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. If you lookup what OAuth is used for, this article comes up. There you can read OAuth is needed for cross-premises eDiscovery searches. Since these functions were not relevant in the project, I ignored them for the time being. By the way, running HCW again did not set up OAuth properly in this case. But sometimes you can easily fix a issue like this by re-running HCW.\nOAuth can also be used for authentication for cross-premise sharing of Free/Busy information. The linked OAuth-article mentions only eDiscovery - which is also the section of the documentation where the article resides. More OAuth-scenarios are not explained there. Free/Busy is not mentioned in the article about configuring OAuth for Exchange Hybrid either.\nNo Free/Busy available After the first test users were migrated to Exchange Online, it turned out that the cross-premise access to Free/Busy information did not work. There are two very good articles in the Exchange Team Blog explaining Hybrid Free/Busy:\nDemystifying Hybrid Free/Busy: what are the moving parts? Demystifying Hybrid Free/Busy: Finding errors and troubleshooting Intra-Organization Connector (IOC) You can check both on-premise and in Exchange Online whether an Intra-Organization Connector (required for Hybrid OAuth) is present. Since the configuration via HCW failed, no working IOC configuration should be stored.\n1 Get-IntraOrganizationConnector | fl The attribute ‚ÄúEnabled‚Äù is set to False, therefore no OAuth is used. Just as expected. Organization Relationship (ORG REL) The next step is to check if an Organization Relationship exists.\n1 Get-OrganizationRelationship | fl In my case, an Organization Relationship was returned. So DAUTH is in use.\nChecking DAUTH I‚Äôve actually only scratched the surface here. After some troubleshooting it turned out that authentication via DAUTH really isn‚Äôt working in this case. I have tried to check the cross-premise availability in Outlook on the Web (OWA). In the browser developer console (accessible via ‚ÄúF12‚Äù) under ‚ÄúNetwork‚Äù you can filter for ‚ÄúGetUserAvailabilityInternal‚Äù.\nThe relevant information I could find there:\nError 0x80048800\nwst:FailedAuthentication\nAADSTS901124: Application ‚Äòfydibohf25spdlt.example.com‚Äô does not exist.\nThe details of the Free/Busy Troubleshooting are also available in Exchange Team Blog: Demystifying Hybrid Free/Busy: Finding errors and troubleshooting. Since the non-existent application and the code ‚ÄúAADSTS901124‚Äù seemed to be no standard scenario, I actually wanted to open a ticket at Microsoft. But since OAuth is the modern and recommended authentication method anyway, one can also do troubleshooting for that.\nSetting up OAuth manually Basically the manual setup of OAuth is described in the article Configure OAuth authentication between Exchange and Exchange Online organizations. I‚Äôm not going to repeat it all here. What was different for me, though:\nExchange Server Auth Certificate expired and renewed In the section ‚ÄúStep 3: Export the on-premises authorization certificate‚Äù it‚Äôs described how the Microsoft Exchange Server Auth Certificate can get exported. In the next step it would get imported into Exchange Online. Since the Exchange 2013 system has been in operation at the customer‚Äôs site for over 5 years, the certificate has already been replaced once. Since Hybrid and OAuth have never been used here, the new certificate was never stored for authentication.\nAt the German site msxfaq.de there is a good article about Exchange OAuth. It describes, among other things, how per Set-AuthConfig the new certificate can be applied:\n1 2 Set-AuthConfig -NewCertificateThumbprint -NewCertificateEffectiveDate (Get-Date) Set-AuthConfig -PublishCertificate After that an iisreset is also required.\nConfiguring Intra-Organization Connector Afterwards I could proceed according to the documentation (Step 3, 4 and 5). Step 6 and 7 didn‚Äôt apply anymore. There was no need to create the IOC, they just had to get enabled by Get-IntraOrganizationConnector | Set-IntraOrganizationConnector -Enabled $true. Step 8 didn‚Äôt play a role, because there were no pre-Exchange 2013 SP1 servers in the environment.\nTests Afterwards I could successfully perform the following tests:\nOAuth Test using PowerShell Execute in the On-Premise Exchange Management Shell:\n1 Test-OAuthConnectivity -Service EWS -TargetUri https://outlook.office365.com/ews/exchange.asmx -Mailbox \u003cOn-Premises Mailbox\u003e -Verbose | Format-List Execute in Exchange Online PowerShell:\n1 Test-OAuthConnectivity -Service EWS -TargetUri ","wordCount":"806","inLanguage":"en","image":"https://diecknet.de/images/2020/2020-04-28-HCW8064-01.png","datePublished":"2020-05-01T00:00:00Z","dateModified":"2020-05-01T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/en/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/ title=Deutsch aria-label=Deutsch>Deutsch</a></li><li><a href=https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/ title=English aria-label=English><b>English</b></a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/en/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/en/services/ title=Services><span>Services</span></a></li><li><a href=https://diecknet.de/en/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/en/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/en/>Home</a>&nbsp;¬ª&nbsp;<a href=https://diecknet.de/en/posts/>Posts</a></div><h1 class=post-title>Exchange Hybrid: HCW8064 OAuth configuration couldn't get performed</h1><div class=post-meta><span title='2020-05-01 00:00:00 +0000 UTC'>2020-05-01</span>&nbsp;¬∑&nbsp;4 min&nbsp;¬∑&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<ul class=i18n_list>üåç&nbsp;Dieser Inhalt ist auch verf√ºgbar auf:&nbsp;<li><a href=https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/>Deutsch</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/en/posts/2020/2020-05-01-Exchange-Hybrid-HCW8064-OAuth.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><figure class=entry-cover><img loading=lazy src=https://diecknet.de/images/2020/2020-04-28-HCW8064-01.png alt></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#no-freebusy-available aria-label="No Free/Busy available">No Free/Busy available</a></li><li><a href=#intra-organization-connector-ioc aria-label="Intra-Organization Connector (IOC)">Intra-Organization Connector (IOC)</a></li><li><a href=#organization-relationship-org-rel aria-label="Organization Relationship (ORG REL)">Organization Relationship (ORG REL)</a></li><li><a href=#checking-dauth aria-label="Checking DAUTH">Checking DAUTH</a></li><li><a href=#setting-up-oauth-manually aria-label="Setting up OAuth manually">Setting up OAuth manually</a><ul><li><a href=#exchange-server-auth-certificate-expired-and-renewed aria-label="Exchange Server Auth Certificate expired and renewed">Exchange Server Auth Certificate expired and renewed</a></li><li><a href=#configuring-intra-organization-connector aria-label="Configuring Intra-Organization Connector">Configuring Intra-Organization Connector</a></li></ul></li><li><a href=#tests aria-label=Tests>Tests</a><ul><li><a href=#oauth-test-using-powershell aria-label="OAuth Test using PowerShell">OAuth Test using PowerShell</a></li><li><a href=#retrieving-freebusy-times-cross-premise aria-label="Retrieving Free/Busy times (Cross-Premise)">Retrieving Free/Busy times (Cross-Premise)</a></li></ul></li><li><a href=#related-links aria-label="Related links">Related links</a></li></ul></div></details></div><div class=post-content><p>At the end of the Hybrid Configuration Wizard (HCW) I received the following warning message:</p><blockquote><p>HCW8064 - The HCW has completed, but was not able to perform the OAuth portion of your Hybrid configuration. If you need features that rely on OAuth, you can try running the HCW again or manually configure OAuth using these manual steps.</p></blockquote><p>The link &ldquo;<strong>more information</strong>&rdquo; links to <a href=https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you target=_blank>https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you</a>. If you lookup what OAuth is used for, <a href="https://docs.microsoft.com/en-us/exchange/using-oauth-authentication-to-support-ediscovery-in-an-exchange-hybrid-deployment-exchange-2013-help?redirectedfrom=MSDN" target=_blank>this article</a> comes up. There you can read OAuth is needed for cross-premises eDiscovery searches. Since these functions were not relevant in the project, I ignored them for the time being. By the way, running HCW again did not set up OAuth properly in this case. But sometimes you can easily fix a issue like this by re-running HCW.</p><p>OAuth <em>can</em> also be used for authentication for cross-premise sharing of Free/Busy information. The linked <a href="https://docs.microsoft.com/en-us/exchange/using-oauth-authentication-to-support-ediscovery-in-an-exchange-hybrid-deployment-exchange-2013-help?redirectedfrom=MSDN" target=_blank>OAuth-article</a> mentions <strong>only</strong> eDiscovery - which is also the section of the documentation where the article resides. More OAuth-scenarios are not explained there. Free/Busy is not mentioned in <a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help target=_blank>the article about configuring OAuth for Exchange Hybrid</a> either.</p><h2 id=no-freebusy-available>No Free/Busy available<a hidden class=anchor aria-hidden=true href=#no-freebusy-available>#</a></h2><p>After the first test users were migrated to Exchange Online, it turned out that the cross-premise access to Free/Busy information did not work. There are two very good articles in the Exchange Team Blog explaining Hybrid Free/Busy:</p><ul><li><a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-what-are-the-moving-parts/ba-p/607704 target=_blank>Demystifying Hybrid Free/Busy: what are the moving parts?</a></li><li><a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-finding-errors-and-troubleshooting/ba-p/607727 target=_blank>Demystifying Hybrid Free/Busy: Finding errors and troubleshooting</a></li></ul><h2 id=intra-organization-connector-ioc>Intra-Organization Connector (IOC)<a hidden class=anchor aria-hidden=true href=#intra-organization-connector-ioc>#</a></h2><p>You can check both on-premise and in Exchange Online whether an <code>Intra-Organization Connector</code> (required for Hybrid OAuth) is present. Since the configuration via HCW failed, no working IOC configuration should be stored.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-IntraOrganizationConnector</span> | <span style=color:#d0a8ff>fl
</span></span></span></code></pre></td></tr></table></div></div><p>The attribute &ldquo;Enabled&rdquo; is set to <code>False</code>, therefore no OAuth is used. Just as expected.
<img loading=lazy src=/images/2020/2020-04-28-IOC-01.png alt="&amp;ldquo;Get-IntraOrganizationConnector | fl&amp;rdquo; - &amp;ldquo;Enabled&amp;rdquo; is set to &amp;ldquo;False&amp;rdquo;" title="'Get-IntraOrganizationConnector | fl' - 'Enabled' is set to 'False'"></p><h2 id=organization-relationship-org-rel>Organization Relationship (ORG REL)<a hidden class=anchor aria-hidden=true href=#organization-relationship-org-rel>#</a></h2><p>The next step is to check if an Organization Relationship exists.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-OrganizationRelationship</span> | <span style=color:#d0a8ff>fl
</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/images/2020/2020-04-28-ORG-REL.png alt="Get-OrganizationRelationship to show that the Organization Relationship to the O365 Mail Domain exists&amp;quot;" title="Get-OrganizationRelationship to show that the Organization Relationship to the O365 Mail Domain exists"></p><p>In my case, an Organization Relationship was returned. So DAUTH is in use.</p><h2 id=checking-dauth>Checking DAUTH<a hidden class=anchor aria-hidden=true href=#checking-dauth>#</a></h2><p>I&rsquo;ve actually only scratched the surface here. After some troubleshooting it turned out that authentication via DAUTH really isn&rsquo;t working in this case. I have tried to check the cross-premise availability in Outlook on the Web (OWA). In the browser developer console (accessible via &ldquo;F12&rdquo;) under &ldquo;Network&rdquo; you can filter for &ldquo;GetUserAvailabilityInternal&rdquo;.</p><p><img loading=lazy src=/images/2020/2020-04-28-NetworkConsoleBrowserOWA.png alt="Retrieving developer options - Network in the browser for OWA" title="Retrieving developer options - Network in the browser for OWA"></p><p>The relevant information I could find there:</p><blockquote><p>Error 0x80048800<br>wst:FailedAuthentication<br>AADSTS901124: Application &lsquo;fydibohf25spdlt.example.com&rsquo; does not exist.</p></blockquote><p>The details of the Free/Busy Troubleshooting are also available in <a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-finding-errors-and-troubleshooting/ba-p/607727 target=_blank>Exchange Team Blog: Demystifying Hybrid Free/Busy: Finding errors and troubleshooting</a>. Since the non-existent application and the code &ldquo;AADSTS901124&rdquo; seemed to be no standard scenario, I actually wanted to open a ticket at Microsoft. But since OAuth is the modern and recommended authentication method anyway, one can also do troubleshooting for that.</p><h2 id=setting-up-oauth-manually>Setting up OAuth manually<a hidden class=anchor aria-hidden=true href=#setting-up-oauth-manually>#</a></h2><p>Basically the manual setup of OAuth is described in the article <a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help target=_blank>Configure OAuth authentication between Exchange and Exchange Online organizations</a>. I&rsquo;m not going to repeat it all here. What was different for me, though:</p><h3 id=exchange-server-auth-certificate-expired-and-renewed>Exchange Server Auth Certificate expired and renewed<a hidden class=anchor aria-hidden=true href=#exchange-server-auth-certificate-expired-and-renewed>#</a></h3><p>In the section <a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help#step-3-export-the-on-premises-authorization-certificate target=_blank>&ldquo;Step 3: Export the on-premises authorization certificate&rdquo;</a> it&rsquo;s described how the <strong>Microsoft Exchange Server Auth Certificate</strong> can get exported. In the next step it would get imported into Exchange Online. Since the Exchange 2013 system has been in operation at the customer&rsquo;s site for over 5 years, the certificate has already been replaced once. Since Hybrid and OAuth have never been used here, the new certificate was never stored for authentication.</p><p>At the German site <a href=https://www.msxfaq.de/exchange/e2013/exchange_oauth.htm target=_blank>msxfaq.de there is a good article about Exchange OAuth</a>. It describes, among other things, how per <code>Set-AuthConfig</code> the new certificate can be applied:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Set-AuthConfig</span> -NewCertificateThumbprint &lt;myCertThumbprint&gt; -NewCertificateEffectiveDate (<span style=color:#d0a8ff>Get-Date</span>)
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Set-AuthConfig</span> -PublishCertificate
</span></span></code></pre></td></tr></table></div></div><p>After that an <code>iisreset</code> is also required.</p><h3 id=configuring-intra-organization-connector>Configuring Intra-Organization Connector<a hidden class=anchor aria-hidden=true href=#configuring-intra-organization-connector>#</a></h3><p>Afterwards I could proceed according to the documentation (<a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help#step-3-export-the-on-premises-authorization-certificate target=_blank>Step 3, 4 and 5</a>). <a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help#step-6-create-an-intraorganizationconnector-from-your-on-premises-organization-to-office-365 target=_blank>Step 6 and 7</a> didn&rsquo;t apply anymore. There was no need to create the IOC, they just had to get enabled by <code>Get-IntraOrganizationConnector | Set-IntraOrganizationConnector -Enabled $true</code>. Step 8 didn&rsquo;t play a role, because there were no pre-Exchange 2013 SP1 servers in the environment.</p><h2 id=tests>Tests<a hidden class=anchor aria-hidden=true href=#tests>#</a></h2><p>Afterwards I could successfully perform the following tests:</p><h3 id=oauth-test-using-powershell>OAuth Test using PowerShell<a hidden class=anchor aria-hidden=true href=#oauth-test-using-powershell>#</a></h3><p>Execute in the On-Premise Exchange Management Shell:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Test-OAuthConnectivity</span> -Service EWS -TargetUri https<span style=color:#960050>:</span>//outlook.office365.com/ews/exchange.asmx -Mailbox &lt;<span style=color:#d0a8ff>On-Premises</span> Mailbox&gt; -Verbose | <span style=color:#d0a8ff>Format-List</span>
</span></span></code></pre></td></tr></table></div></div><p>Execute in Exchange Online PowerShell:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Test-OAuthConnectivity</span> -Service EWS -TargetUri &lt;external hostname authority of your Exchange <span style=color:#d0a8ff>On-Premises</span> deployment&gt;/metadata/json/<span style=color:#d0bf69>1</span> -Mailbox &lt;Exchange Online Mailbox&gt; -Verbose | <span style=color:#d0a8ff>Format-List</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=retrieving-freebusy-times-cross-premise>Retrieving Free/Busy times (Cross-Premise)<a hidden class=anchor aria-hidden=true href=#retrieving-freebusy-times-cross-premise>#</a></h3><p>Now it was possible to retrieve cross-premise free/busy times - in both directions. Here is an example screenshot showing the query from an Exchange Online mailbox to an Exchange On-Premise mailbox.</p><p><img loading=lazy src=/images/2020/2020-04-28-FreeBusy.png alt="Outlook on the Web: retrieving Free/Busy times from Exchange Online to Exchange On-Premise - successfully" title="Outlook on the Web: retrieving Free/Busy times from Exchange Online to Exchange On-Premise - successfully"></p><h2 id=related-links>Related links<a hidden class=anchor aria-hidden=true href=#related-links>#</a></h2><ul><li><a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-what-are-the-moving-parts/ba-p/607704 target=_blank>Demystifying Hybrid Free/Busy: what are the moving parts? (Exchange Team Blog)</a></li><li><a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-finding-errors-and-troubleshooting/ba-p/607727 target=_blank>Demystifying Hybrid Free/Busy: Finding errors and troubleshooting (Exchange Team Blog)</a></li><li><a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help target=_blank>Configure OAuth authentication between Exchange and Exchange Online organizations (docs.microsoft.com)</a></li><li><a href=https://www.msxfaq.de/exchange/e2013/exchange_oauth.htm target=_blank>Exchange OAuth article (msxfaq.de)</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/en/tags/exchange/>Exchange</a></li><li><a href=https://diecknet.de/en/tags/exchange2013/>Exchange2013</a></li><li><a href=https://diecknet.de/en/tags/exchangehybrid/>Exchangehybrid</a></li><li><a href=https://diecknet.de/en/tags/oauth/>Oauth</a></li><li><a href=https://diecknet.de/en/tags/office365/>Office365</a></li></ul><div class=share-buttons></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://diecknet.de/en/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/en/legal/>Imprint</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/en/privacy/>Privacy</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>