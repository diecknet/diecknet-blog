<!doctype html><html lang=de dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Exchange Hybrid: HCW8064 OAuth konnte nicht eingerichtet werden | diecknet</title>
<meta name=keywords content="exchange,exchange2013,exchangehybrid,oauth,office365"><meta name=description content="Zum Abschluss des Hybrid Configuration Wizard (HCW) wurde mir folgende Warnungs-Meldung angezeigt:
HCW8064 - Der Assistent für Hybridkonfiguration wurde abgeschlossen, er konnte den OAuth-Anteil der Hybridkonfiguration aber nicht ausführen. Wenn Sie Features benötigen, die OAuth voraussetzen, können Sie versuchen den Assistenten für Hybridkonfiguration erneut auszuführen oder OAuth mithilfe dieser manuellen Schritte manuell konfigurieren.
Der Link &ldquo;Weitere Informationen&rdquo; verweist auf https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. Wenn man schaut, wofür OAuth verwendet, wird dieser Artikel referenziert. Dort ist zu lesen, OAuth für Cross-Premises eDiscovery Suchen benötigt wird."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=de href=https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/><link rel=alternate hreflang=en href=https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Exchange Hybrid: HCW8064 OAuth konnte nicht eingerichtet werden"><meta property="og:description" content="Zum Abschluss des Hybrid Configuration Wizard (HCW) wurde mir folgende Warnungs-Meldung angezeigt:
HCW8064 - Der Assistent für Hybridkonfiguration wurde abgeschlossen, er konnte den OAuth-Anteil der Hybridkonfiguration aber nicht ausführen. Wenn Sie Features benötigen, die OAuth voraussetzen, können Sie versuchen den Assistenten für Hybridkonfiguration erneut auszuführen oder OAuth mithilfe dieser manuellen Schritte manuell konfigurieren.
Der Link &ldquo;Weitere Informationen&rdquo; verweist auf https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. Wenn man schaut, wofür OAuth verwendet, wird dieser Artikel referenziert. Dort ist zu lesen, OAuth für Cross-Premises eDiscovery Suchen benötigt wird."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/"><meta property="og:image" content="https://diecknet.de/images/2020/2020-04-28-HCW8064-01.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-05-01T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://diecknet.de/images/2020/2020-04-28-HCW8064-01.png"><meta name=twitter:title content="Exchange Hybrid: HCW8064 OAuth konnte nicht eingerichtet werden"><meta name=twitter:description content="Zum Abschluss des Hybrid Configuration Wizard (HCW) wurde mir folgende Warnungs-Meldung angezeigt:
HCW8064 - Der Assistent für Hybridkonfiguration wurde abgeschlossen, er konnte den OAuth-Anteil der Hybridkonfiguration aber nicht ausführen. Wenn Sie Features benötigen, die OAuth voraussetzen, können Sie versuchen den Assistenten für Hybridkonfiguration erneut auszuführen oder OAuth mithilfe dieser manuellen Schritte manuell konfigurieren.
Der Link &ldquo;Weitere Informationen&rdquo; verweist auf https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. Wenn man schaut, wofür OAuth verwendet, wird dieser Artikel referenziert. Dort ist zu lesen, OAuth für Cross-Premises eDiscovery Suchen benötigt wird."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/de/posts/"},{"@type":"ListItem","position":2,"name":"Exchange Hybrid: HCW8064 OAuth konnte nicht eingerichtet werden","item":"https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Exchange Hybrid: HCW8064 OAuth konnte nicht eingerichtet werden","name":"Exchange Hybrid: HCW8064 OAuth konnte nicht eingerichtet werden","description":"Zum Abschluss des Hybrid Configuration Wizard (HCW) wurde mir folgende Warnungs-Meldung angezeigt:\nHCW8064 - Der Assistent für Hybridkonfiguration wurde abgeschlossen, er konnte den OAuth-Anteil der Hybridkonfiguration aber nicht ausführen. Wenn Sie Features benötigen, die OAuth voraussetzen, können Sie versuchen den Assistenten für Hybridkonfiguration erneut auszuführen oder OAuth mithilfe dieser manuellen Schritte manuell konfigurieren.\nDer Link \u0026ldquo;Weitere Informationen\u0026rdquo; verweist auf https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. Wenn man schaut, wofür OAuth verwendet, wird dieser Artikel referenziert. Dort ist zu lesen, OAuth für Cross-Premises eDiscovery Suchen benötigt wird.","keywords":["exchange","exchange2013","exchangehybrid","oauth","office365"],"articleBody":"Zum Abschluss des Hybrid Configuration Wizard (HCW) wurde mir folgende Warnungs-Meldung angezeigt:\nHCW8064 - Der Assistent für Hybridkonfiguration wurde abgeschlossen, er konnte den OAuth-Anteil der Hybridkonfiguration aber nicht ausführen. Wenn Sie Features benötigen, die OAuth voraussetzen, können Sie versuchen den Assistenten für Hybridkonfiguration erneut auszuführen oder OAuth mithilfe dieser manuellen Schritte manuell konfigurieren.\nDer Link “Weitere Informationen” verweist auf https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you. Wenn man schaut, wofür OAuth verwendet, wird dieser Artikel referenziert. Dort ist zu lesen, OAuth für Cross-Premises eDiscovery Suchen benötigt wird. Da diese erwähnten Funktionen in dem Projekt nicht relevant waren, habe ich das erstmal ignoriert. Eine erneute Ausführung des HCW hat übrigens auch kein OAuth einrichten können. Manchmal kann aber das erneute Ausführen des HCW solche Probleme tatsächlich beheben - einfach ausprobieren!\nOAuth kann allerdings auch für die Authentifizierung für den Cross-Premise Austausch von Free/Busy Informationen genutzt werden. Der verlinkte OAuth-Artikel erwähnt allerdings ausschließlich eDiscovery - das ist auch die Sektion der Dokumentation in der sich der Artikel befindet. Weitere OAuth-Szenarien werden hier nicht erläutert. Im Artikel zur Konfiguration von OAuth für Exchange Hybrid wird Free/Busy auch nicht erwähnt.\nKein Free/Busy möglich Nachdem die ersten Test-User zu Exchange Online migriert wurden, hat sich gezeigt, dass der Cross-Premise Abruf von Free/Busy Informationen nicht funktioniert. Zur Erläuterung von Hybrid Free/Busy gibt es hier zwei sehr gute Artikel im Exchange Team Blog:\nDemystifying Hybrid Free/Busy: what are the moving parts? Demystifying Hybrid Free/Busy: Finding errors and troubleshooting Intra-Organization Connector (IOC) Sowohl On-Premise als auch in Exchange Online kann geprüft werden, ob ein Intra-Organization Connector (für Hybrid OAuth notwendig) verwendet wird. Da die Konfiguration per HCW fehlgeschlagen ist, sollte keine funktionierende IOC Konfiguration hinterlegt sein.\n1 Get-IntraOrganizationConnector | fl Das Attribut “Enabled” steht auf “False”, demnach wird kein OAuth verwendet. Also wie erwartet. Organization Relationship (ORG REL) Als nächstes sollte geprüft werden, ob ein Organization Relationship vorhanden ist.\n1 Get-OrganizationRelationship | fl In meinem Fall, wurde ein Organization Relationship zurückgegeben. Es wird also DAUTH verwendet.\nDAUTH Überprüfung Ich habe hier tatsächlich nur an der Oberfläche gekratzt. Nach einigem Troubleshooting hat sich gezeigt, dass die Authentifizierung per DAUTH in diesem Fall tatsächlich nicht funktioniert. Ich habe zum Überprüfen in Outlook on the Web (OWA) versucht eine Cross-Premise Verfügbarkeit abzurufen. In der Browser-Entwicklerkonsole (per “F12” aufrufbar) kann dann unter “Network” nach “GetUserAvailabilityInternal” gefiltert werden. Die relevanten Informationen die ich dort finden konnte:\nError 0x80048800\nwst:FailedAuthentication\nAADSTS901124: Application ‘fydibohf25spdlt.example.com’ does not exist.\nDie Details zum Free/Busy Troubleshooting sind auch im Exchange Team Blog: Demystifying Hybrid Free/Busy: Finding errors and troubleshooting zu finden. Da die nicht existente Application und der Code “AADSTS901124” anscheinend kein Standard-Szenario ist, wollte ich eigentlich schon ein Ticket bei Microsoft eröffnen. Da aber OAuth ohnehin die moderne und empfohlene Authentifizierungsmethode ist, kann man aber auch ersteinmal dafür Troubleshooting betreiben.\nOAuth manuell einrichten Grundsätzlich wird die manuelle Einrichtung von OAuth im Artikel Configure OAuth authentication between Exchange and Exchange Online organizations beschrieben. Ich wiederhole das jetzt nicht hier alles. Was bei mir allerdings noch anders war:\nExchange Server Auth Certificate abgelaufen und erneuert Im Abschnitt “Step 3: Export the on-premises authorization certificate” wird beschrieben, wie das Microsoft Exchange Server Auth Certificate exportiert werden kann. Im nächsten Schritt würde es dann in Exchange Online importiert werden. Da das Exchange 2013 System beim Kunden bereits seit über 5 Jahren im Betrieb ist, wurde das Zertifikat bereits einmal ausgetauscht. Da Hybrid und OAuth hier noch nie verwendet wurden, wurde das neue Zertifikat auch nie für die Authentifizierung hinterlegt.\nAuf msxfaq.de gibt es einen guten Artikel zu Exchange OAuth. Dort wird unter anderem beschrieben, wie per powershell Set-AuthConfig das neue Zertifikat hinterlegt werden kann:\n1 2 Set-AuthConfig -NewCertificateThumbprint -NewCertificateEffectiveDate (Get-Date) Set-AuthConfig -PublishCertificate Anschließend ist noch ein iisreset notwendig.\nIntra-Organization Connector konfigurieren Anschließend konnte ich der Dokumentation entsprechend weiter verfahren (Step 3, 4 und 5). Step 6 und 7 waren nicht mehr zutreffend. Die IOC mussten nicht mehr angelegt werden, sondern mussten nur noch per Get-IntraOrganizationConnector | Set-IntraOrganizationConnector -Enabled $true aktiviert werden. Step 8 spielte keine Rolle, da keine pre-Exchange 2013 SP1 Server in der Umgebung vorhanden waren.\nTests Anschließend konnte ich folgende Tests erfolgreich durchführen:\nOAuth Test per PowerShell In On-Premise Exchange Management Shell ausführen:\n1 Test-OAuthConnectivity -Service EWS -TargetUri https://outlook.office365.com/ews/exchange.asmx -Mailbox \u003cOn-Premises Mailbox\u003e -Verbose | Format-List In Exchange Online PowerShell ausführen:\n1 Test-OAuthConnectivity -Service EWS -TargetUri ","wordCount":"798","inLanguage":"de","image":"https://diecknet.de/images/2020/2020-04-28-HCW8064-01.png","datePublished":"2020-05-01T00:00:00Z","dateModified":"2020-05-01T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/de/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/ title=Deutsch aria-label=Deutsch><b>Deutsch</b></a></li><li><a href=https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/de/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/de/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/de/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/de/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/de/>Home</a>&nbsp;»&nbsp;<a href=https://diecknet.de/de/posts/>Posts</a></div><h1 class=post-title>Exchange Hybrid: HCW8064 OAuth konnte nicht eingerichtet werden</h1><div class=post-meta><span title='2020-05-01 00:00:00 +0000 UTC'>2020-05-01</span>&nbsp;·&nbsp;4 Minuten&nbsp;·&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<ul class=i18n_list>🌍&nbsp;This content is also available in:&nbsp;<li><a href=https://diecknet.de/en/2020/05/01/Exchange-Hybrid-HCW8064-OAuth/>English</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/de/posts/2020/2020-05-01-Exchange-Hybrid-HCW8064-OAuth.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><figure class=entry-cover><img loading=lazy src=https://diecknet.de/images/2020/2020-04-28-HCW8064-01.png alt></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Inhaltsverzeichnis</span></summary><div class=inner><ul><li><a href=#kein-freebusy-m%c3%b6glich aria-label="Kein Free/Busy möglich">Kein Free/Busy möglich</a></li><li><a href=#intra-organization-connector-ioc aria-label="Intra-Organization Connector (IOC)">Intra-Organization Connector (IOC)</a></li><li><a href=#organization-relationship-org-rel aria-label="Organization Relationship (ORG REL)">Organization Relationship (ORG REL)</a></li><li><a href=#dauth-%c3%bcberpr%c3%bcfung aria-label="DAUTH Überprüfung">DAUTH Überprüfung</a></li><li><a href=#oauth-manuell-einrichten aria-label="OAuth manuell einrichten">OAuth manuell einrichten</a><ul><li><a href=#exchange-server-auth-certificate-abgelaufen-und-erneuert aria-label="Exchange Server Auth Certificate abgelaufen und erneuert">Exchange Server Auth Certificate abgelaufen und erneuert</a></li><li><a href=#intra-organization-connector-konfigurieren aria-label="Intra-Organization Connector konfigurieren">Intra-Organization Connector konfigurieren</a></li></ul></li><li><a href=#tests aria-label=Tests>Tests</a><ul><li><a href=#oauth-test-per-powershell aria-label="OAuth Test per PowerShell">OAuth Test per PowerShell</a></li><li><a href=#abruf-von-freebusy-zeiten-cross-premise aria-label="Abruf von Free/Busy Zeiten (Cross-Premise)">Abruf von Free/Busy Zeiten (Cross-Premise)</a></li></ul></li><li><a href=#weiterf%c3%bchrende-links aria-label="Weiterführende Links">Weiterführende Links</a></li></ul></div></details></div><div class=post-content><p>Zum Abschluss des Hybrid Configuration Wizard (HCW) wurde mir folgende Warnungs-Meldung angezeigt:</p><blockquote><p>HCW8064 - Der Assistent für Hybridkonfiguration wurde abgeschlossen, er konnte den OAuth-Anteil der Hybridkonfiguration aber nicht ausführen. Wenn Sie Features benötigen, die OAuth voraussetzen, können Sie versuchen den Assistenten für Hybridkonfiguration erneut auszuführen oder OAuth mithilfe dieser manuellen Schritte manuell konfigurieren.</p></blockquote><p>Der Link &ldquo;<strong>Weitere Informationen</strong>&rdquo; verweist auf <a href=https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you target=_blank>https://support.microsoft.com/en-us/help/3089172/hcw-has-completed-but-was-not-able-to-perform-the-oauth-portion-of-you</a>. Wenn man schaut, wofür OAuth verwendet, wird <a href="https://docs.microsoft.com/en-us/exchange/using-oauth-authentication-to-support-ediscovery-in-an-exchange-hybrid-deployment-exchange-2013-help?redirectedfrom=MSDN" target=_blank>dieser Artikel</a> referenziert. Dort ist zu lesen, OAuth für Cross-Premises eDiscovery Suchen benötigt wird. Da diese erwähnten Funktionen in dem Projekt nicht relevant waren, habe ich das erstmal ignoriert. Eine erneute Ausführung des HCW hat übrigens auch kein OAuth einrichten können. Manchmal kann aber das erneute Ausführen des HCW solche Probleme tatsächlich beheben - einfach ausprobieren!</p><p>OAuth <em>kann</em> allerdings auch für die Authentifizierung für den Cross-Premise Austausch von Free/Busy Informationen genutzt werden. Der verlinkte <a href="https://docs.microsoft.com/en-us/exchange/using-oauth-authentication-to-support-ediscovery-in-an-exchange-hybrid-deployment-exchange-2013-help?redirectedfrom=MSDN" target=_blank>OAuth-Artikel</a> erwähnt allerdings <strong>ausschließlich</strong> eDiscovery - das ist auch die Sektion der Dokumentation in der sich der Artikel befindet. Weitere OAuth-Szenarien werden hier nicht erläutert. Im <a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help target=_blank>Artikel zur Konfiguration von OAuth für Exchange Hybrid</a> wird Free/Busy auch nicht erwähnt.</p><h2 id=kein-freebusy-möglich>Kein Free/Busy möglich<a hidden class=anchor aria-hidden=true href=#kein-freebusy-möglich>#</a></h2><p>Nachdem die ersten Test-User zu Exchange Online migriert wurden, hat sich gezeigt, dass der Cross-Premise Abruf von Free/Busy Informationen nicht funktioniert. Zur Erläuterung von Hybrid Free/Busy gibt es hier zwei sehr gute Artikel im Exchange Team Blog:</p><ul><li><a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-what-are-the-moving-parts/ba-p/607704 target=_blank>Demystifying Hybrid Free/Busy: what are the moving parts?</a></li><li><a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-finding-errors-and-troubleshooting/ba-p/607727 target=_blank>Demystifying Hybrid Free/Busy: Finding errors and troubleshooting</a></li></ul><h2 id=intra-organization-connector-ioc>Intra-Organization Connector (IOC)<a hidden class=anchor aria-hidden=true href=#intra-organization-connector-ioc>#</a></h2><p>Sowohl On-Premise als auch in Exchange Online kann geprüft werden, ob ein <strong>Intra-Organization Connector</strong> (für Hybrid OAuth notwendig) verwendet wird. Da die Konfiguration per HCW fehlgeschlagen ist, sollte keine funktionierende IOC Konfiguration hinterlegt sein.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-IntraOrganizationConnector</span> | <span style=color:#d0a8ff>fl
</span></span></span></code></pre></td></tr></table></div></div><p>Das Attribut &ldquo;Enabled&rdquo; steht auf &ldquo;False&rdquo;, demnach wird kein OAuth verwendet. Also wie erwartet.
<img loading=lazy src=/images/2020/2020-04-28-IOC-01.png alt="&amp;ldquo;Get-IntraOrganizationConnector | fl&amp;rdquo; - &amp;ldquo;Enabled&amp;rdquo; steht auf &amp;ldquo;False&amp;rdquo;" title="'Get-IntraOrganizationConnector | fl' - 'Enabled' steht auf 'False'"></p><h2 id=organization-relationship-org-rel>Organization Relationship (ORG REL)<a hidden class=anchor aria-hidden=true href=#organization-relationship-org-rel>#</a></h2><p>Als nächstes sollte geprüft werden, ob ein Organization Relationship vorhanden ist.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-OrganizationRelationship</span> | <span style=color:#d0a8ff>fl
</span></span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/images/2020/2020-04-28-ORG-REL.png alt="Get-OrganizationRelationship verwenden um zu überprüfen ob ein Organization Relationship zur O365 Mail Domain vorhanden ist" title="Get-OrganizationRelationship verwenden um zu überprüfen ob ein Organization Relationship zur O365 Mail Domain vorhanden ist"></p><p>In meinem Fall, wurde ein Organization Relationship zurückgegeben. Es wird also DAUTH verwendet.</p><h2 id=dauth-überprüfung>DAUTH Überprüfung<a hidden class=anchor aria-hidden=true href=#dauth-überprüfung>#</a></h2><p>Ich habe hier tatsächlich nur an der Oberfläche gekratzt. Nach einigem Troubleshooting hat sich gezeigt, dass die Authentifizierung per DAUTH in diesem Fall tatsächlich nicht funktioniert. Ich habe zum Überprüfen in Outlook on the Web (OWA) versucht eine Cross-Premise Verfügbarkeit abzurufen. In der Browser-Entwicklerkonsole (per &ldquo;F12&rdquo; aufrufbar) kann dann unter &ldquo;Network&rdquo; nach &ldquo;GetUserAvailabilityInternal&rdquo; gefiltert werden.
<img loading=lazy src=/images/2020/2020-04-28-NetworkConsoleBrowserOWA.png alt="Abruf der Entwickleroptionen - Network im Browser für OWA" title="Abruf der Entwickleroptionen - Network im Browser für OWA"></p><p>Die relevanten Informationen die ich dort finden konnte:</p><blockquote><p>Error 0x80048800<br>wst:FailedAuthentication<br>AADSTS901124: Application &lsquo;fydibohf25spdlt.example.com&rsquo; does not exist.</p></blockquote><p>Die Details zum Free/Busy Troubleshooting sind auch im <a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-finding-errors-and-troubleshooting/ba-p/607727 target=_blank>Exchange Team Blog: Demystifying Hybrid Free/Busy: Finding errors and troubleshooting</a> zu finden. Da die nicht existente Application und der Code &ldquo;AADSTS901124&rdquo; anscheinend kein Standard-Szenario ist, wollte ich eigentlich schon ein Ticket bei Microsoft eröffnen. Da aber OAuth ohnehin die moderne und empfohlene Authentifizierungsmethode ist, kann man aber auch ersteinmal dafür Troubleshooting betreiben.</p><h2 id=oauth-manuell-einrichten>OAuth manuell einrichten<a hidden class=anchor aria-hidden=true href=#oauth-manuell-einrichten>#</a></h2><p>Grundsätzlich wird die manuelle Einrichtung von OAuth im Artikel <a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help target=_blank>Configure OAuth authentication between Exchange and Exchange Online organizations</a> beschrieben. Ich wiederhole das jetzt nicht hier alles. Was bei mir allerdings noch anders war:</p><h3 id=exchange-server-auth-certificate-abgelaufen-und-erneuert>Exchange Server Auth Certificate abgelaufen und erneuert<a hidden class=anchor aria-hidden=true href=#exchange-server-auth-certificate-abgelaufen-und-erneuert>#</a></h3><p>Im Abschnitt <a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help#step-3-export-the-on-premises-authorization-certificate target=_blank>&ldquo;Step 3: Export the on-premises authorization certificate&rdquo;</a> wird beschrieben, wie das <strong>Microsoft Exchange Server Auth Certificate</strong> exportiert werden kann. Im nächsten Schritt würde es dann in Exchange Online importiert werden. Da das Exchange 2013 System beim Kunden bereits seit über 5 Jahren im Betrieb ist, wurde das Zertifikat bereits einmal ausgetauscht. Da Hybrid und OAuth hier noch nie verwendet wurden, wurde das neue Zertifikat auch nie für die Authentifizierung hinterlegt.</p><p>Auf <a href=https://www.msxfaq.de/exchange/e2013/exchange_oauth.htm target=_blank>msxfaq.de gibt es einen guten Artikel zu Exchange OAuth</a>. Dort wird unter anderem beschrieben, wie per <code>powershell Set-AuthConfig</code> das neue Zertifikat hinterlegt werden kann:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Set-AuthConfig</span> -NewCertificateThumbprint &lt;myCertThumbprint&gt; -NewCertificateEffectiveDate (<span style=color:#d0a8ff>Get-Date</span>)
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Set-AuthConfig</span> -PublishCertificate
</span></span></code></pre></td></tr></table></div></div><p>Anschließend ist noch ein <code>iisreset</code> notwendig.</p><h3 id=intra-organization-connector-konfigurieren>Intra-Organization Connector konfigurieren<a hidden class=anchor aria-hidden=true href=#intra-organization-connector-konfigurieren>#</a></h3><p>Anschließend konnte ich der Dokumentation entsprechend weiter verfahren (<a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help#step-3-export-the-on-premises-authorization-certificate target=_blank>Step 3, 4 und 5</a>). <a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help#step-6-create-an-intraorganizationconnector-from-your-on-premises-organization-to-office-365 target=_blank>Step 6 und 7</a> waren nicht mehr zutreffend. Die IOC mussten nicht mehr angelegt werden, sondern mussten nur noch per <code>Get-IntraOrganizationConnector | Set-IntraOrganizationConnector -Enabled $true</code> aktiviert werden. Step 8 spielte keine Rolle, da keine pre-Exchange 2013 SP1 Server in der Umgebung vorhanden waren.</p><h2 id=tests>Tests<a hidden class=anchor aria-hidden=true href=#tests>#</a></h2><p>Anschließend konnte ich folgende Tests erfolgreich durchführen:</p><h3 id=oauth-test-per-powershell>OAuth Test per PowerShell<a hidden class=anchor aria-hidden=true href=#oauth-test-per-powershell>#</a></h3><p>In On-Premise Exchange Management Shell ausführen:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Test-OAuthConnectivity</span> -Service EWS -TargetUri https<span style=color:#960050>:</span>//outlook.office365.com/ews/exchange.asmx -Mailbox &lt;<span style=color:#d0a8ff>On-Premises</span> Mailbox&gt; -Verbose | <span style=color:#d0a8ff>Format-List</span>
</span></span></code></pre></td></tr></table></div></div><p>In Exchange Online PowerShell ausführen:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Test-OAuthConnectivity</span> -Service EWS -TargetUri &lt;external hostname authority of your Exchange <span style=color:#d0a8ff>On-Premises</span> deployment&gt;/metadata/json/<span style=color:#d0bf69>1</span> -Mailbox &lt;Exchange Online Mailbox&gt; -Verbose | <span style=color:#d0a8ff>Format-List</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=abruf-von-freebusy-zeiten-cross-premise>Abruf von Free/Busy Zeiten (Cross-Premise)<a hidden class=anchor aria-hidden=true href=#abruf-von-freebusy-zeiten-cross-premise>#</a></h3><p>Tatsächlich konnten jetzt Cross-Premise die Free/Busy Zeiten abgerufen werden - in beide Richtungen. Hier ein exemplarischer Screenshot, der die Abfrage von einem Exchange Online Postfach zu einem Exchange On-Premise Postfach zeigt.</p><p><img loading=lazy src=/images/2020/2020-04-28-FreeBusy.png alt="Outlook on the Web: Abruf von Free/Busy Zeiten von Exchange Online zu Exchange On-Premise - erfolgreich" title="Outlook on the Web: Abruf von Free/Busy Zeiten von Exchange Online zu Exchange On-Premise - erfolgreich"></p><h2 id=weiterführende-links>Weiterführende Links<a hidden class=anchor aria-hidden=true href=#weiterführende-links>#</a></h2><ul><li><a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-what-are-the-moving-parts/ba-p/607704 target=_blank>Demystifying Hybrid Free/Busy: what are the moving parts? (Exchange Team Blog)</a></li><li><a href=https://techcommunity.microsoft.com/t5/exchange-team-blog/demystifying-hybrid-free-busy-finding-errors-and-troubleshooting/ba-p/607727 target=_blank>Demystifying Hybrid Free/Busy: Finding errors and troubleshooting (Exchange Team Blog)</a></li><li><a href=https://docs.microsoft.com/en-us/exchange/configure-oauth-authentication-between-exchange-and-exchange-online-organizations-exchange-2013-help target=_blank>Configure OAuth authentication between Exchange and Exchange Online organizations (docs.microsoft.com)</a></li><li><a href=https://www.msxfaq.de/exchange/e2013/exchange_oauth.htm target=_blank>Exchange OAuth Artikel (msxfaq.de)</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/de/tags/exchange/>Exchange</a></li><li><a href=https://diecknet.de/de/tags/exchange2013/>Exchange2013</a></li><li><a href=https://diecknet.de/de/tags/exchangehybrid/>Exchangehybrid</a></li><li><a href=https://diecknet.de/de/tags/oauth/>Oauth</a></li><li><a href=https://diecknet.de/de/tags/office365/>Office365</a></li></ul><div class=share-buttons></div></footer><script src=https://giscus.diecknet.de/client.js data-repo=diecknet/diecknet-blog data-repo-id="MDEwOlJlcG9zaXRvcnkyMDkzNDUzNzM=" data-category="Blog Discussions" data-category-id=MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyNjMwOTY0 data-mapping=specific data-term=Exchange-Hybrid-HCW8064-OAuth data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://diecknet.de/de/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/de/legal/>Impressum</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/de/privacy/>Datenschutz</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Kopieren";function s(){t.innerHTML="Kopiert!",setTimeout(()=>{t.innerHTML="Kopieren"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>