<!doctype html><html lang=de dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Active Directory Papierkorb aktivieren, konfigurieren und Objekte wiederherstellen | diecknet</title>
<meta name=keywords content="powershell,active directory"><meta name=description content="Wenn ihr Active Directory Domain Services verwendet, solltet ihr unbedingt prüfen, ob der AD-Papierkorb bei euch aktiviert ist.
Was ist der AD-Papierkorb?
Der AD-Papierkorb funktioniert ähnlich wie ein Papierkorb im Dateisystem:
Gelöschte Objekte (Benutzer, Gruppen etc.) landen zunächst im Papierkorb und können einfach wiederhergestellt werden.
Das ist besonders praktisch bei:

versehentlichen Löschungen
absichtlichen Löschungen, die rückgängig gemacht werden sollen,
fehlendem AD-Backup (ersetzt natürlich kein Backup!)

Der AD-Papierkorb wurde mit Windows Server 2008 R2 eingeführt.
Voraussetzung: Euer AD-Forest muss mindestens den Windows Server 2008 R2 Functional Level haben."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/de/2025/04/28/active-directory-recycle-bin/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=de href=https://diecknet.de/de/2025/04/28/active-directory-recycle-bin/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Active Directory Papierkorb aktivieren, konfigurieren und Objekte wiederherstellen"><meta property="og:description" content="Wenn ihr Active Directory Domain Services verwendet, solltet ihr unbedingt prüfen, ob der AD-Papierkorb bei euch aktiviert ist.
Was ist der AD-Papierkorb?
Der AD-Papierkorb funktioniert ähnlich wie ein Papierkorb im Dateisystem:
Gelöschte Objekte (Benutzer, Gruppen etc.) landen zunächst im Papierkorb und können einfach wiederhergestellt werden.
Das ist besonders praktisch bei:

versehentlichen Löschungen
absichtlichen Löschungen, die rückgängig gemacht werden sollen,
fehlendem AD-Backup (ersetzt natürlich kein Backup!)

Der AD-Papierkorb wurde mit Windows Server 2008 R2 eingeführt.
Voraussetzung: Euer AD-Forest muss mindestens den Windows Server 2008 R2 Functional Level haben."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/de/2025/04/28/active-directory-recycle-bin/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-28T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-28T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Active Directory Papierkorb aktivieren, konfigurieren und Objekte wiederherstellen"><meta name=twitter:description content="Wenn ihr Active Directory Domain Services verwendet, solltet ihr unbedingt prüfen, ob der AD-Papierkorb bei euch aktiviert ist.
Was ist der AD-Papierkorb?
Der AD-Papierkorb funktioniert ähnlich wie ein Papierkorb im Dateisystem:
Gelöschte Objekte (Benutzer, Gruppen etc.) landen zunächst im Papierkorb und können einfach wiederhergestellt werden.
Das ist besonders praktisch bei:

versehentlichen Löschungen
absichtlichen Löschungen, die rückgängig gemacht werden sollen,
fehlendem AD-Backup (ersetzt natürlich kein Backup!)

Der AD-Papierkorb wurde mit Windows Server 2008 R2 eingeführt.
Voraussetzung: Euer AD-Forest muss mindestens den Windows Server 2008 R2 Functional Level haben."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/de/posts/"},{"@type":"ListItem","position":2,"name":"Active Directory Papierkorb aktivieren, konfigurieren und Objekte wiederherstellen","item":"https://diecknet.de/de/2025/04/28/active-directory-recycle-bin/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Active Directory Papierkorb aktivieren, konfigurieren und Objekte wiederherstellen","name":"Active Directory Papierkorb aktivieren, konfigurieren und Objekte wiederherstellen","description":"Wenn ihr Active Directory Domain Services verwendet, solltet ihr unbedingt prüfen, ob der AD-Papierkorb bei euch aktiviert ist.\nWas ist der AD-Papierkorb? Der AD-Papierkorb funktioniert ähnlich wie ein Papierkorb im Dateisystem:\nGelöschte Objekte (Benutzer, Gruppen etc.) landen zunächst im Papierkorb und können einfach wiederhergestellt werden.\nDas ist besonders praktisch bei:\nversehentlichen Löschungen absichtlichen Löschungen, die rückgängig gemacht werden sollen, fehlendem AD-Backup (ersetzt natürlich kein Backup!) Der AD-Papierkorb wurde mit Windows Server 2008 R2 eingeführt.\nVoraussetzung: Euer AD-Forest muss mindestens den Windows Server 2008 R2 Functional Level haben.\n","keywords":["powershell","active directory"],"articleBody":"Wenn ihr Active Directory Domain Services verwendet, solltet ihr unbedingt prüfen, ob der AD-Papierkorb bei euch aktiviert ist.\nWas ist der AD-Papierkorb? Der AD-Papierkorb funktioniert ähnlich wie ein Papierkorb im Dateisystem:\nGelöschte Objekte (Benutzer, Gruppen etc.) landen zunächst im Papierkorb und können einfach wiederhergestellt werden.\nDas ist besonders praktisch bei:\nversehentlichen Löschungen absichtlichen Löschungen, die rückgängig gemacht werden sollen, fehlendem AD-Backup (ersetzt natürlich kein Backup!) Der AD-Papierkorb wurde mit Windows Server 2008 R2 eingeführt.\nVoraussetzung: Euer AD-Forest muss mindestens den Windows Server 2008 R2 Functional Level haben.\nOhne aktivierten AD-Papierkorb ist das Wiederherstellen gelöschter Objekte deutlich schwieriger (siehe Abschnitt Wiederherstellen ohne AD-Papierkorb).\nWichtige Hinweise Generell ist die Aktivierung des AD-Papierkorbs empfehlenswert. Aber:\nWichtig: Die Aktivierung kann nicht rückgängig gemacht werden! Bereits gelöschte Objekte werden dadurch nicht nachträglich besser wiederherstellbar. Ganz im Gegenteil: Es gibt auch ohne AD-Papierkorb eine rudimentäre Wiederherstellungsmöglichkeit (siehe Abschnitt Wiederherstellen ohne AD-Papierkorb). Falls ihr jetzt aber einfach den AD-Papierkorb aktiviert, gehen bereits gelöschte Elemente unwiderruflich verloren. Wiederherstellen ohne AD-Papierkorb Auch ohne AD-Papierkorb können gelöschte Objekte rudimentär wiederhergestellt werden, aber:\nDie meisten Eigenschaften bleiben verloren (wurden in dem Moment verworfen, wo das Objekt gelöscht wurde) Nur die ObjectSID, ObjectGUID und DistinguishedName bleiben erhalten (nützlich falls das gelöschte Objekt in irgendwelchen Berechtigungs-ACLs drin steht) Beispiel: Wiederherstellung per PowerShell:\n1 2 3 4 5 6 7 8 9 Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects \u003c# Beispiel Rückgabe: [...] ObjectGUID: 4ed8fada-a248-49fc-bca9-5b920231bd5b #\u003e # Dann die ObjectGUID bei Restore-ADObject angeben: Restore-ADObject -Identity 4ed8fada-a248-49fc-bca9-5b920231bd5b AD-Papierkorb aktivieren Das Aktivieren des Active Directory Papierkorbs kann wahlweise über die GUI (AD Verwaltungscenter) oder die PowerShell gemacht werden.\nÜber das Active Directory Verwaltungscenter Das Active Directory Verwaltungscenter öffnen. Auf die eigene Domäne klicken. Rechts erscheint die Option Papierkorb aktivieren ➡️ drauf klicken und bestätigen. Falls die Option ausgegraut ist, ist der AD-Papierkorb bei euch wahrscheinlich schon aktiviert. Wenn ihr euch nicht sicher seid, dann schaut, ob es den Container “Deleted Objects” bei euch im AD gibt. Der sollte nur existieren, wenn der AD-Papierkorb aktiviert ist.\nPer PowerShell Per PowerShell könnt ihr den Papierkorb ebenfalls aktivieren. Für meine Domäne “lan.demotenant.de” habe ich folgenden Befehl verwendet. Bei den Parametern -Identity und -Target müsst ihr natürlich Werte eintragen, die eurer Umgebung entsprechen:\n1 Enable-ADOptionalFeature -Identity 'CN=Recycle Bin Feature,CN=Optional Features,CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,DC=lan,DC=demotenant,DC=de' -Scope ForestOrConfigurationSet -Target 'lan.demotenant.de' Ihr erhaltet eine Warnung, dass die Änderung nicht rückgängig gemacht werden kann. Die solltet ihr bestätigen.\nWiederherstellen von Objekten aus dem AD-Papierkorb Abgesehen von den Objekt-Eigenschaften die jetzt erhalten bleiben, hat die Wiederherstellung aus dem AD-Papierkorb noch einen weiteren Vorteil:\nDie Objekte sind auch per GUI (per AD Verwaltungscenter) wiederherstellbar.\nWiederherstellung per Active Directory Verwaltungscenter Auf den Container Deleted Objects klicken. Objekt auswählen und auf Wiederherstellen klicken um das Objekt in der originalen Organisationseinheit, oder auf Wiederherstellen in… um das Objekt in einem anderen Container wiederherzustellen. Wiederherstellung per PowerShell 1 2 3 4 5 6 # Erstmal nach dem gelöschten Objekt suchen, z.B. hier nach *test* Get-ADObject -Filter 'isDeleted -eq $true -and Name -like \"*Test*\"' -IncludeDeletedObjects # Wenn das passt und nur 1 Objekt zurückgegeben wird, # können wir die Rückgabe an Restore-ADObject pipen: Get-ADObject -Filter 'isDeleted -eq $true -and Name -like \"*Test*\"' -IncludeDeletedObjects | Restore-ADObject Optional: Wiederherstellung in eine andere OU/einen anderen Container:\n1 Restore-ADObject -Identity -TargetPath \"OU=Beispiel,DC=lan,DC=demotenant,DC=de\" Aufbewahrungsdauer der gelöschten Objekte Standardmäßig bleiben gelöschte Objekte 180 Tage im AD erhalten.\nDieser Wert wird über das Tombstone Lifetime-Attribut gesteuert. In älteren Domainen kann es aber sein, dass ihr noch einen geringeren Standardwert habt.\nDas könnt ihr mit ADSI Edit überprüfen:\nADSI Editor öffnen Verbindung herstellen mit Konfiguration Pfad: CN=Configuration [...] -\u003e CN=Services [...] -\u003e CN=Windows NT [...] -\u003e CN=Directory Services [...]. Mit Rechtsklick auf CN=Directory Services [...] klicken und im Kontextmenü “Eigenschaften” aufrufen. Im Attribut-Editor das Attribut tombstoneLifetime prüfen = das ist die Aufbewahrungszeit in Tagen. Falls msDS-DeletedObjectLifetime explizit gesetzt ist, wird stattdessen dieser Wert verwendet. Im Standard ist der Wert aber leer.\nIst er nicht gesetzt, greift der Wert aus tombstoneLifetime.\nWeiterführende Links Video dazu auf meinem YouTube-Kanal: https://youtu.be/3f5Nozh9ny4 Microsoft Dokumentation - Enable and use Active Directory Recycle Bin: https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/adac/active-directory-recycle-bin?tabs=powershell ","wordCount":"668","inLanguage":"de","datePublished":"2025-04-28T00:00:00Z","dateModified":"2025-04-28T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/de/2025/04/28/active-directory-recycle-bin/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/de/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/ title=Deutsch aria-label=Deutsch><b>Deutsch</b></a></li><li><a href=https://diecknet.de/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/de/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/de/services/ title=Services><span>Services</span></a></li><li><a href=https://diecknet.de/de/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/de/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/de/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/de/>Home</a>&nbsp;»&nbsp;<a href=https://diecknet.de/de/posts/>Posts</a></div><h1 class=post-title>Active Directory Papierkorb aktivieren, konfigurieren und Objekte wiederherstellen</h1><div class=post-meta><span title='2025-04-28 00:00:00 +0000 UTC'>2025-04-28</span>&nbsp;·&nbsp;4 Minuten&nbsp;·&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/de/posts/2025/2025-04-28-AD-Recycle-Bin.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Inhaltsverzeichnis</span></summary><div class=inner><ul><li><a href=#was-ist-der-ad-papierkorb aria-label="Was ist der AD-Papierkorb?">Was ist der AD-Papierkorb?</a><ul><li><a href=#wichtige-hinweise aria-label="Wichtige Hinweise">Wichtige Hinweise</a></li><li><a href=#wiederherstellen-ohne-ad-papierkorb aria-label="Wiederherstellen ohne AD-Papierkorb">Wiederherstellen ohne AD-Papierkorb</a></li></ul></li><li><a href=#ad-papierkorb-aktivieren aria-label="AD-Papierkorb aktivieren">AD-Papierkorb aktivieren</a><ul><li><a href=#%c3%bcber-das-active-directory-verwaltungscenter aria-label="Über das Active Directory Verwaltungscenter">Über das Active Directory Verwaltungscenter</a></li><li><a href=#per-powershell aria-label="Per PowerShell">Per PowerShell</a></li></ul></li><li><a href=#wiederherstellen-von-objekten-aus-dem-ad-papierkorb aria-label="Wiederherstellen von Objekten aus dem AD-Papierkorb">Wiederherstellen von Objekten aus dem AD-Papierkorb</a><ul><li><a href=#wiederherstellung-per-active-directory-verwaltungscenter aria-label="Wiederherstellung per Active Directory Verwaltungscenter">Wiederherstellung per Active Directory Verwaltungscenter</a></li><li><a href=#wiederherstellung-per-powershell aria-label="Wiederherstellung per PowerShell">Wiederherstellung per PowerShell</a></li></ul></li><li><a href=#aufbewahrungsdauer-der-gel%c3%b6schten-objekte aria-label="Aufbewahrungsdauer der gelöschten Objekte">Aufbewahrungsdauer der gelöschten Objekte</a></li><li><a href=#weiterf%c3%bchrende-links aria-label="Weiterführende Links">Weiterführende Links</a></li></ul></div></details></div><div class=post-content><p>Wenn ihr Active Directory Domain Services verwendet, solltet ihr unbedingt prüfen, ob der <strong>AD-Papierkorb</strong> bei euch aktiviert ist.</p><h2 id=was-ist-der-ad-papierkorb>Was ist der AD-Papierkorb?<a hidden class=anchor aria-hidden=true href=#was-ist-der-ad-papierkorb>#</a></h2><p>Der AD-Papierkorb funktioniert ähnlich wie ein Papierkorb im Dateisystem:<br><strong>Gelöschte Objekte</strong> (Benutzer, Gruppen etc.) landen zunächst im Papierkorb und können einfach wiederhergestellt werden.</p><p>Das ist besonders praktisch bei:</p><ul><li>versehentlichen Löschungen</li><li>absichtlichen Löschungen, die rückgängig gemacht werden sollen,</li><li>fehlendem AD-Backup (ersetzt natürlich kein Backup!)</li></ul><p>Der AD-Papierkorb wurde mit <strong>Windows Server 2008 R2</strong> eingeführt.<br>Voraussetzung: Euer AD-Forest muss mindestens den <strong>Windows Server 2008 R2 Functional Level</strong> haben.</p><p>Ohne aktivierten AD-Papierkorb ist das Wiederherstellen gelöschter Objekte deutlich schwieriger (siehe Abschnitt <a href=#wiederherstellen-ohne-ad-papierkorb>Wiederherstellen ohne AD-Papierkorb</a>).</p><h3 id=wichtige-hinweise>Wichtige Hinweise<a hidden class=anchor aria-hidden=true href=#wichtige-hinweise>#</a></h3><p>Generell ist die Aktivierung des AD-Papierkorbs empfehlenswert. Aber:</p><ul><li><strong>Wichtig:</strong> Die Aktivierung kann <strong>nicht rückgängig</strong> gemacht werden!</li><li>Bereits gelöschte Objekte werden dadurch <strong>nicht</strong> nachträglich besser wiederherstellbar.<ul><li>Ganz im Gegenteil: Es gibt auch ohne AD-Papierkorb eine rudimentäre Wiederherstellungsmöglichkeit (siehe Abschnitt <a href=#wiederherstellen-ohne-ad-papierkorb>Wiederherstellen ohne AD-Papierkorb</a>). Falls ihr jetzt aber einfach den AD-Papierkorb aktiviert, gehen bereits gelöschte Elemente unwiderruflich verloren.</li></ul></li></ul><h3 id=wiederherstellen-ohne-ad-papierkorb>Wiederherstellen ohne AD-Papierkorb<a hidden class=anchor aria-hidden=true href=#wiederherstellen-ohne-ad-papierkorb>#</a></h3><p>Auch ohne AD-Papierkorb können gelöschte Objekte rudimentär wiederhergestellt werden, aber:</p><ul><li>Die meisten Eigenschaften <strong>bleiben verloren</strong> (wurden in dem Moment verworfen, wo das Objekt gelöscht wurde)</li><li>Nur die ObjectSID, ObjectGUID und DistinguishedName bleiben erhalten (nützlich falls das gelöschte Objekt in irgendwelchen Berechtigungs-ACLs drin steht)</li></ul><p>Beispiel: Wiederherstellung per PowerShell:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-ADObject</span> -Filter <span style=color:#fc6a5d>&#39;isDeleted -eq $true&#39;</span> -IncludeDeletedObjects
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986>&lt;# Beispiel Rückgabe:
</span></span></span><span style=display:flex><span><span style=color:#6c7986>[...]
</span></span></span><span style=display:flex><span><span style=color:#6c7986>ObjectGUID: 4ed8fada-a248-49fc-bca9-5b920231bd5b
</span></span></span><span style=display:flex><span><span style=color:#6c7986>#&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Dann die ObjectGUID bei Restore-ADObject angeben:</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Restore-ADObject</span> -Identity 4ed8fada-a248-49fc-bca9-5b920231bd5b
</span></span></code></pre></td></tr></table></div></div><h2 id=ad-papierkorb-aktivieren>AD-Papierkorb aktivieren<a hidden class=anchor aria-hidden=true href=#ad-papierkorb-aktivieren>#</a></h2><p>Das Aktivieren des Active Directory Papierkorbs kann wahlweise über die GUI (AD Verwaltungscenter) oder die PowerShell gemacht werden.</p><h3 id=über-das-active-directory-verwaltungscenter>Über das Active Directory Verwaltungscenter<a hidden class=anchor aria-hidden=true href=#über-das-active-directory-verwaltungscenter>#</a></h3><ol><li>Das <strong>Active Directory Verwaltungscenter</strong> öffnen.</li><li>Auf die eigene <strong>Domäne</strong> klicken.</li><li>Rechts erscheint die Option <strong>Papierkorb aktivieren</strong> ➡️ drauf klicken und bestätigen.</li></ol><p>Falls die Option ausgegraut ist, ist der AD-Papierkorb bei euch wahrscheinlich schon aktiviert. Wenn ihr euch nicht sicher seid, dann schaut, ob es den Container &ldquo;Deleted Objects&rdquo; bei euch im AD gibt. Der sollte nur existieren, wenn der AD-Papierkorb aktiviert ist.</p><p><a href=/images/2025/2025-04-28_AD-Papierkorb.jpg><img loading=lazy src=/images/2025/2025-04-28_AD-Papierkorb.jpg alt="Active Directory Admin Center: Prüfen ob der AD-Papierkorb aktiviert ist" title="Active Directory Admin Center: Prüfen ob der AD-Papierkorb aktiviert ist"></a></p><h3 id=per-powershell>Per PowerShell<a hidden class=anchor aria-hidden=true href=#per-powershell>#</a></h3><p>Per PowerShell könnt ihr den Papierkorb ebenfalls aktivieren. Für meine Domäne &ldquo;lan.demotenant.de&rdquo; habe ich folgenden Befehl verwendet. Bei den Parametern <code>-Identity</code> und <code>-Target</code> müsst ihr natürlich Werte eintragen, die eurer Umgebung entsprechen:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Enable-ADOptionalFeature</span> -Identity <span style=color:#fc6a5d>&#39;CN=Recycle Bin Feature,CN=Optional Features,CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,DC=lan,DC=demotenant,DC=de&#39;</span> -Scope ForestOrConfigurationSet -Target <span style=color:#fc6a5d>&#39;lan.demotenant.de&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>Ihr erhaltet eine Warnung, dass die Änderung nicht rückgängig gemacht werden kann. Die solltet ihr bestätigen.</p><h2 id=wiederherstellen-von-objekten-aus-dem-ad-papierkorb>Wiederherstellen von Objekten aus dem AD-Papierkorb<a hidden class=anchor aria-hidden=true href=#wiederherstellen-von-objekten-aus-dem-ad-papierkorb>#</a></h2><p>Abgesehen von den Objekt-Eigenschaften die jetzt erhalten bleiben, hat die Wiederherstellung aus dem AD-Papierkorb noch einen weiteren Vorteil:<br>Die Objekte sind auch per GUI (per AD Verwaltungscenter) wiederherstellbar.</p><h3 id=wiederherstellung-per-active-directory-verwaltungscenter>Wiederherstellung per Active Directory Verwaltungscenter<a hidden class=anchor aria-hidden=true href=#wiederherstellung-per-active-directory-verwaltungscenter>#</a></h3><ul><li>Auf den Container <strong>Deleted Objects</strong> klicken.</li><li>Objekt auswählen und auf <strong>Wiederherstellen</strong> klicken um das Objekt in der originalen Organisationseinheit, oder auf <strong>Wiederherstellen in&mldr;</strong> um das Objekt in einem anderen Container wiederherzustellen.</li></ul><p><a href=/images/2025/2025-04-28_AD-Papierkorb-Restore.jpg><img loading=lazy src=/images/2025/2025-04-28_AD-Papierkorb-Restore.jpg alt="Active Directory Admin Center: Wiederherstellen eines gelöschten Objekts" title="Active Directory Admin Center: Wiederherstellen eines gelöschten Objekts"></a></p><h3 id=wiederherstellung-per-powershell>Wiederherstellung per PowerShell<a hidden class=anchor aria-hidden=true href=#wiederherstellung-per-powershell>#</a></h3><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Erstmal nach dem gelöschten Objekt suchen, z.B. hier nach *test*</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-ADObject</span> -Filter <span style=color:#fc6a5d>&#39;isDeleted -eq $true -and Name -like &#34;*Test*&#34;&#39;</span> -IncludeDeletedObjects
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Wenn das passt und nur 1 Objekt zurückgegeben wird, </span>
</span></span><span style=display:flex><span><span style=color:#6c7986># können wir die Rückgabe an Restore-ADObject pipen:</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-ADObject</span> -Filter <span style=color:#fc6a5d>&#39;isDeleted -eq $true -and Name -like &#34;*Test*&#34;&#39;</span> -IncludeDeletedObjects | <span style=color:#d0a8ff>Restore-ADObject</span>
</span></span></code></pre></td></tr></table></div></div><p>Optional: Wiederherstellung in eine andere OU/einen anderen Container:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Restore-ADObject</span> -Identity &lt;ObjectGUID&gt; -TargetPath <span style=color:#fc6a5d>&#34;OU=Beispiel,DC=lan,DC=demotenant,DC=de&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=aufbewahrungsdauer-der-gelöschten-objekte>Aufbewahrungsdauer der gelöschten Objekte<a hidden class=anchor aria-hidden=true href=#aufbewahrungsdauer-der-gelöschten-objekte>#</a></h2><p>Standardmäßig bleiben gelöschte Objekte <strong>180 Tage</strong> im AD erhalten.<br>Dieser Wert wird über das <strong>Tombstone Lifetime</strong>-Attribut gesteuert. In älteren Domainen kann es aber sein, dass ihr noch einen geringeren Standardwert habt.</p><p>Das könnt ihr mit ADSI Edit überprüfen:</p><ol><li>ADSI Editor öffnen</li><li>Verbindung herstellen mit <strong>Konfiguration</strong></li><li>Pfad: <code>CN=Configuration [...] -> CN=Services [...] -> CN=Windows NT [...] -> CN=Directory Services [...]</code>. Mit Rechtsklick auf <code>CN=Directory Services [...]</code> klicken und im Kontextmenü &ldquo;Eigenschaften&rdquo; aufrufen.</li><li>Im Attribut-Editor das Attribut <strong>tombstoneLifetime</strong> prüfen = das ist die Aufbewahrungszeit in Tagen.</li></ol><p>Falls <code>msDS-DeletedObjectLifetime</code> explizit gesetzt ist, wird stattdessen dieser Wert verwendet. Im Standard ist der Wert aber leer.<br>Ist er nicht gesetzt, greift der Wert aus <code>tombstoneLifetime</code>.</p><h2 id=weiterführende-links>Weiterführende Links<a hidden class=anchor aria-hidden=true href=#weiterführende-links>#</a></h2><ul><li>Video dazu auf meinem YouTube-Kanal: <a href=https://youtu.be/3f5Nozh9ny4 target=_blank>https://youtu.be/3f5Nozh9ny4</a></li><li>Microsoft Dokumentation - Enable and use Active Directory Recycle Bin: <a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/adac/active-directory-recycle-bin?tabs=powershell" target=_blank>https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/adac/active-directory-recycle-bin?tabs=powershell</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/de/tags/powershell/>Powershell</a></li><li><a href=https://diecknet.de/de/tags/Active-Directory/>Active Directory</a></li></ul><div class=share-buttons></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://diecknet.de/de/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/de/legal/>Impressum</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/de/privacy/>Datenschutz</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Kopieren";function s(){t.innerHTML="Kopiert!",setTimeout(()=>{t.innerHTML="Kopieren"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>