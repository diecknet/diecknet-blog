<!doctype html><html lang=de dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>E-Mails per PowerShell verschicken mit Send-MailMessage | diecknet</title>
<meta name=keywords content="powershell"><meta name=description content="Es ist recht einfach E-Mails per PowerShell zu verschicken. Dafür gibt es das mitgelieferte Cmdlet Send-MailMessage, welches allerdings mittlerweile von Microsoft als veraltet bezeichnet wird:

⚠️ Warnung
Das Cmdlet Send-MailMessage ist veraltet. Dieses Cmdlet garantiert keine sicheren Verbindungen mit SMTP-Servern. Es ist zwar kein sofortiger Ersatz in PowerShell verfügbar, es wird jedoch empfohlen, Send-MailMessage nicht zu verwenden. Weitere Informationen finden Sie unter Plattformkompatibilitätshinweis DE0005.

Quelle: https://learn.microsoft.com/de-de/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.5
Für einige Szenarien ist die Verwendung von Send-MailMessage aber meiner Meinung nach trotzdem okay. Wenn ihr zum Beispiel einen eigenen SMTP-Server (z.B. Microsoft Exchange Server) betreibt oder angemietet habt (z.B. bei jedem beliebigen Webhoster), dann gibt es dort in der Regel gar keine Unterstützung für modernere Authentifizierungsmethoden. Ihr könnt einen solchen SMTP-Server natürlich auch zusätzlich zu einer Exchange Online Umgebung betreiben. Tendenziell würde ich empfehlen für solche automatischen E-Mails eher eine Subdomain (z.B. &ldquo;reports.demotenant.de&rdquo; statt einfach nur &ldquo;demotenant.de&rdquo;) oder eine separate Domain zu verwenden, aber das ist natürlich kein Muss."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/de/2025/03/23/powershell-send-mailmessage/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=de href=https://diecknet.de/de/2025/03/23/powershell-send-mailmessage/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="E-Mails per PowerShell verschicken mit Send-MailMessage"><meta property="og:description" content="Es ist recht einfach E-Mails per PowerShell zu verschicken. Dafür gibt es das mitgelieferte Cmdlet Send-MailMessage, welches allerdings mittlerweile von Microsoft als veraltet bezeichnet wird:

⚠️ Warnung
Das Cmdlet Send-MailMessage ist veraltet. Dieses Cmdlet garantiert keine sicheren Verbindungen mit SMTP-Servern. Es ist zwar kein sofortiger Ersatz in PowerShell verfügbar, es wird jedoch empfohlen, Send-MailMessage nicht zu verwenden. Weitere Informationen finden Sie unter Plattformkompatibilitätshinweis DE0005.

Quelle: https://learn.microsoft.com/de-de/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.5
Für einige Szenarien ist die Verwendung von Send-MailMessage aber meiner Meinung nach trotzdem okay. Wenn ihr zum Beispiel einen eigenen SMTP-Server (z.B. Microsoft Exchange Server) betreibt oder angemietet habt (z.B. bei jedem beliebigen Webhoster), dann gibt es dort in der Regel gar keine Unterstützung für modernere Authentifizierungsmethoden. Ihr könnt einen solchen SMTP-Server natürlich auch zusätzlich zu einer Exchange Online Umgebung betreiben. Tendenziell würde ich empfehlen für solche automatischen E-Mails eher eine Subdomain (z.B. &ldquo;reports.demotenant.de&rdquo; statt einfach nur &ldquo;demotenant.de&rdquo;) oder eine separate Domain zu verwenden, aber das ist natürlich kein Muss."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/de/2025/03/23/powershell-send-mailmessage/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-23T00:00:00+00:00"><meta property="article:modified_time" content="2025-03-23T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="E-Mails per PowerShell verschicken mit Send-MailMessage"><meta name=twitter:description content="Es ist recht einfach E-Mails per PowerShell zu verschicken. Dafür gibt es das mitgelieferte Cmdlet Send-MailMessage, welches allerdings mittlerweile von Microsoft als veraltet bezeichnet wird:

⚠️ Warnung
Das Cmdlet Send-MailMessage ist veraltet. Dieses Cmdlet garantiert keine sicheren Verbindungen mit SMTP-Servern. Es ist zwar kein sofortiger Ersatz in PowerShell verfügbar, es wird jedoch empfohlen, Send-MailMessage nicht zu verwenden. Weitere Informationen finden Sie unter Plattformkompatibilitätshinweis DE0005.

Quelle: https://learn.microsoft.com/de-de/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.5
Für einige Szenarien ist die Verwendung von Send-MailMessage aber meiner Meinung nach trotzdem okay. Wenn ihr zum Beispiel einen eigenen SMTP-Server (z.B. Microsoft Exchange Server) betreibt oder angemietet habt (z.B. bei jedem beliebigen Webhoster), dann gibt es dort in der Regel gar keine Unterstützung für modernere Authentifizierungsmethoden. Ihr könnt einen solchen SMTP-Server natürlich auch zusätzlich zu einer Exchange Online Umgebung betreiben. Tendenziell würde ich empfehlen für solche automatischen E-Mails eher eine Subdomain (z.B. &ldquo;reports.demotenant.de&rdquo; statt einfach nur &ldquo;demotenant.de&rdquo;) oder eine separate Domain zu verwenden, aber das ist natürlich kein Muss."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/de/posts/"},{"@type":"ListItem","position":2,"name":"E-Mails per PowerShell verschicken mit Send-MailMessage","item":"https://diecknet.de/de/2025/03/23/powershell-send-mailmessage/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"E-Mails per PowerShell verschicken mit Send-MailMessage","name":"E-Mails per PowerShell verschicken mit Send-MailMessage","description":"Es ist recht einfach E-Mails per PowerShell zu verschicken. Dafür gibt es das mitgelieferte Cmdlet Send-MailMessage, welches allerdings mittlerweile von Microsoft als veraltet bezeichnet wird:\n⚠️ Warnung\nDas Cmdlet Send-MailMessage ist veraltet. Dieses Cmdlet garantiert keine sicheren Verbindungen mit SMTP-Servern. Es ist zwar kein sofortiger Ersatz in PowerShell verfügbar, es wird jedoch empfohlen, Send-MailMessage nicht zu verwenden. Weitere Informationen finden Sie unter Plattformkompatibilitätshinweis DE0005.\nQuelle: https://learn.microsoft.com/de-de/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.5\nFür einige Szenarien ist die Verwendung von Send-MailMessage aber meiner Meinung nach trotzdem okay. Wenn ihr zum Beispiel einen eigenen SMTP-Server (z.B. Microsoft Exchange Server) betreibt oder angemietet habt (z.B. bei jedem beliebigen Webhoster), dann gibt es dort in der Regel gar keine Unterstützung für modernere Authentifizierungsmethoden. Ihr könnt einen solchen SMTP-Server natürlich auch zusätzlich zu einer Exchange Online Umgebung betreiben. Tendenziell würde ich empfehlen für solche automatischen E-Mails eher eine Subdomain (z.B. \u0026ldquo;reports.demotenant.de\u0026rdquo; statt einfach nur \u0026ldquo;demotenant.de\u0026rdquo;) oder eine separate Domain zu verwenden, aber das ist natürlich kein Muss.\n","keywords":["powershell"],"articleBody":"Es ist recht einfach E-Mails per PowerShell zu verschicken. Dafür gibt es das mitgelieferte Cmdlet Send-MailMessage, welches allerdings mittlerweile von Microsoft als veraltet bezeichnet wird:\n⚠️ Warnung\nDas Cmdlet Send-MailMessage ist veraltet. Dieses Cmdlet garantiert keine sicheren Verbindungen mit SMTP-Servern. Es ist zwar kein sofortiger Ersatz in PowerShell verfügbar, es wird jedoch empfohlen, Send-MailMessage nicht zu verwenden. Weitere Informationen finden Sie unter Plattformkompatibilitätshinweis DE0005.\nQuelle: https://learn.microsoft.com/de-de/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.5\nFür einige Szenarien ist die Verwendung von Send-MailMessage aber meiner Meinung nach trotzdem okay. Wenn ihr zum Beispiel einen eigenen SMTP-Server (z.B. Microsoft Exchange Server) betreibt oder angemietet habt (z.B. bei jedem beliebigen Webhoster), dann gibt es dort in der Regel gar keine Unterstützung für modernere Authentifizierungsmethoden. Ihr könnt einen solchen SMTP-Server natürlich auch zusätzlich zu einer Exchange Online Umgebung betreiben. Tendenziell würde ich empfehlen für solche automatischen E-Mails eher eine Subdomain (z.B. “reports.demotenant.de” statt einfach nur “demotenant.de”) oder eine separate Domain zu verwenden, aber das ist natürlich kein Muss.\nFalls ihr ausschließlich Exchange Online für den E-Mail-Versand verwendet bzw. verwenden wollt, dann ist das Cmdlet Send-MailMessage dafür nicht geeignet. Ich werde aber demnächst auch noch ein Video und einen Blog-Post zum Thema “E-Mail Versand per Microsoft Graph und PowerShell” machen. Wenn euch das interessiert, dann schaut demnächst auch hier vorbei und/oder abonniert meinen YouTube Kanal.\nBeispiele Hier sind ein paar Beispiele, die ich ganz nett fand. Ein paar weitere/andere Beispiele sind auch in der Microsoft Dokumentation zu dem Cmdlet zu finden. Ich demonstriere die Beispiele auch hier in einem Video.\nHinweis zu Zugangsdaten Ihr solltet keine Zugangsdaten im Klartext in eurem PowerShell Code ablegen. Jeder der den Code in die Hand bekommt, hätte dann auch die Zugangsdaten und könnte damit Unfug treiben. Für einfache Testzwecke könnt ihr die Zugangsdaten interaktiv abfragen. Meine nachfolgenden Beispiele gehen davon aus, dass in der Variable $Credential ein PSCredential Objekt mit den Zugangsdaten steckt. Das könnt ihr wie folgt abfragen:\n1 2 # Abfrage der Zugangsdaten und speichern als PSCredential Objekt $Credential = Get-Credential Hier ist noch ein Video zum Thema “Zugangsdaten sicher im Code ablegen”: https://www.youtube.com/watch?v=C9bYPSWjCDY\nHinweis zu Encoding Ich verwende hier in allen Beispielen explizit UTF8 als Encoding, um Probleme mit Sonderzeichen zu verhindern. Falls die Sonderzeichen bei euch nicht richtig dargestellt werden, schaut mal, ob euer PowerShell Skript auch im UTF8 Encoding gespeichert ist. Falls es dann immer noch nicht hinhaut, müsst ihr eventuell ein anderes Encoding wählen.\nBeispiel 1: Versand per TLS/SSL über Port 25 Ein einfaches Beispiel: Wir verschicken abgesichert per TLS/SSL (-UseSSL), aber über Port 25. Die Angabe des Ports ist damit eigentlich optional (-Port 25). Die Zugangsdaten werden aus der Variable $Credential verwendet.\n1 2 3 4 5 6 # Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in # der nächsten Zeile weiter. Send-MailMessage -From \"test@demotenant.de\" -SmtpServer \"MeinSMTPServer.demotenant.de\" ` -Credential $Credential -UseSSL -Port 25 -To \"hans.maulwurf@demotenant.de\" ` -Subject \"Hallo aus der PowerShell\" -Body \"Das hier ist der Inhalt der Mail\" ` -Encoding utf8 Beispiel 2: Mehrzeilige E-Mails Wenn ihr nur ganz kurze E-Mails verschicken wollt, dann kommt ihr vielleicht mit der Angabe des Texts direkt am Parameter aus. Falls ihr dabei einen Zeilenumbruch einfügen wollt, dann könnt ihr `r`n in euren Parameterwert für -Body schreiben. In der Regel würde ich aber den E-Mail-Text in einer Variable definieren und an das Cmdlet übergeben. Mit folgender Schreibweise könnt ihr einfach einen mehrzeiligen String in PowerShell definieren:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $EmailText = @\" Hallo, das hier ist eine E-Mail. Viele Grüße PowerShell \"@ # Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in # der nächsten Zeile weiter. Send-MailMessage -From \"test@demotenant.de\" -SmtpServer \"MeinSMTPServer.demotenant.de\" ` -Credential $Credential -UseSSL -Port 25 -To \"hans.maulwurf@demotenant.de\" ` -Subject \"Hallo aus der PowerShell\" -Body $EmailText ` -Encoding utf8 Beispiel 3: HTML E-Mails Um eure E-Mails ein wenig hübscher zu gestalten, könnt ihr HTML verwenden. Damit das dann auch vom E-Mail-Client auf Empfängerseite richtig interpretiert wird, muss der Switch Parameter -BodyAsHTML angegeben werden. Der eigentliche Body (jetzt im HTML-Format) wird aber trotzdem per -Body angegeben.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $EmailText = @\" Hallo, das hier ist eine E-Mail. Viele Grüße PowerShell \"@ # Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in # der nächsten Zeile weiter. Send-MailMessage -From \"test@demotenant.de\" -SmtpServer \"MeinSMTPServer.demotenant.de\" ` -Credential $Credential -UseSSL -Port 25 -To \"hans.maulwurf@demotenant.de\" ` -Subject \"Hallo aus der PowerShell\" -Body $EmailText -BodyAsHTML ` -Encoding utf8 Beispiel 4: PowerShell Array/Objekte zu HTML konvertieren Richtig nützlich wird es natürlich erst, wenn ihr auch Daten per PowerShell sammelt oder generiert und die dann per E-Mail verschickt. Mit dem Cmdlet ConvertTo-HTML könnt ihr ein Array bzw. ein PowerShell Objekt zu HTML konvertieren. Im folgenden liste ich alle lokalen User am Computer auf, um so einen kleinen Report per PowerShell zu verschicken. Beim Cmdlet ConvertTo-HTML verwende ich außerdem die Parameter -Property um die Eigenschaften auszuwählen (sonst werden alle genommen) und -Fragment, damit nur eine HTML-Tabelle generiert wird und nicht eine komplette Webseite (mit komplettem HTML-Gerüst).\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $HTMLTabelle = Get-LocalUser | ConvertTo-HTML -Property Name,SID -Fragment $EmailText = @\" Hallo, das hier ist ein Report über lokale User, generiert per PowerShell. Viele Grüße PowerShell $HTMLTabelle \"@ # Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in # der nächsten Zeile weiter. Send-MailMessage -From \"test@demotenant.de\" -SmtpServer \"MeinSMTPServer.demotenant.de\" ` -Credential $Credential -UseSSL -Port 25 -To \"hans.maulwurf@demotenant.de\" ` -Subject \"Hallo aus der PowerShell\" -Body $EmailText -BodyAsHTML ` -Encoding utf8 Beispiel 5: Mehrere Empfänger, CC und BCC Wenn ihr nicht nur normale Empfänger per -To Parameter verwenden wollt, sondern auch CC oder BCC, dann könnt ihr dafür die Parameter -CC bzw. -BCC verwenden. Und bei allen 3 Parametern könnt ihr mehrere Empfänger eingeben, wenn ihr sie als Array angebt. Zum Beispiel so: -To \"hans.maulwurf@demotenant.de\",\"alexw@demotenant.de\".\n1 2 3 4 5 6 # Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in # der nächsten Zeile weiter. Send-MailMessage -From \"test@demotenant.de\" -SmtpServer \"MeinSMTPServer.demotenant.de\" ` -Credential $Credential -UseSSL -Port 25 -To \"hans.maulwurf@demotenant.de\",\"alexw@demotenant.de\" ` -Subject \"Hallo aus der PowerShell\" -Body \"Das hier ist der Inhalt der Mail\" ` -Encoding utf8 -CC \"irgendjemand@demotenant.de\" -BCC \"beispiel@demotenant.de\" Beispiel 6: E-Mail Anhänge Um E-Mail Anhänge hinzuzufügen, könnt ihr den Pfad zur Datei am Parameter -Attachment angeben. Mehrere Anhänge sind auch möglich, wenn sie als Array angegeben werden, z.B. so: -Attachment \"Anhang1.docx\",\"Anhang2.txt\".\n1 2 3 4 5 6 # Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in # der nächsten Zeile weiter. Send-MailMessage -From \"test@demotenant.de\" -SmtpServer \"MeinSMTPServer.demotenant.de\" ` -Credential $Credential -UseSSL -Port 25 -To \"hans.maulwurf@demotenant.de\",\"alexw@demotenant.de\" ` -Subject \"Hallo aus der PowerShell\" -Body \"Das hier ist der Inhalt der Mail\" ` -Encoding utf8 -Attachment \"Anhang.docx\" ","wordCount":"1136","inLanguage":"de","datePublished":"2025-03-23T00:00:00Z","dateModified":"2025-03-23T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/de/2025/03/23/powershell-send-mailmessage/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/de/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/ title=Deutsch aria-label=Deutsch><b>Deutsch</b></a></li><li><a href=https://diecknet.de/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/de/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/de/services/ title=Services><span>Services</span></a></li><li><a href=https://diecknet.de/de/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/de/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/de/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/de/>Home</a>&nbsp;»&nbsp;<a href=https://diecknet.de/de/posts/>Posts</a></div><h1 class=post-title>E-Mails per PowerShell verschicken mit Send-MailMessage</h1><div class=post-meta><span title='2025-03-23 00:00:00 +0000 UTC'>2025-03-23</span>&nbsp;·&nbsp;6 Minuten&nbsp;·&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/de/posts/2025/2025-03-23-PowerShell-Send-MailMessage.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Inhaltsverzeichnis</span></summary><div class=inner><ul><li><a href=#beispiele aria-label=Beispiele>Beispiele</a></li><li><a href=#hinweis-zu-zugangsdaten aria-label="Hinweis zu Zugangsdaten">Hinweis zu Zugangsdaten</a><ul><li><a href=#hinweis-zu-encoding aria-label="Hinweis zu Encoding">Hinweis zu Encoding</a></li><li><a href=#beispiel-1-versand-per-tlsssl-%c3%bcber-port-25 aria-label="Beispiel 1: Versand per TLS/SSL über Port 25">Beispiel 1: Versand per TLS/SSL über Port 25</a></li><li><a href=#beispiel-2-mehrzeilige-e-mails aria-label="Beispiel 2: Mehrzeilige E-Mails">Beispiel 2: Mehrzeilige E-Mails</a></li><li><a href=#beispiel-3-html-e-mails aria-label="Beispiel 3: HTML E-Mails">Beispiel 3: HTML E-Mails</a></li><li><a href=#beispiel-4-powershell-arrayobjekte-zu-html-konvertieren aria-label="Beispiel 4: PowerShell Array/Objekte zu HTML konvertieren">Beispiel 4: PowerShell Array/Objekte zu HTML konvertieren</a></li><li><a href=#beispiel-5-mehrere-empf%c3%a4nger-cc-und-bcc aria-label="Beispiel 5: Mehrere Empfänger, CC und BCC">Beispiel 5: Mehrere Empfänger, CC und BCC</a></li><li><a href=#beispiel-6-e-mail-anh%c3%a4nge aria-label="Beispiel 6: E-Mail Anhänge">Beispiel 6: E-Mail Anhänge</a></li></ul></li></ul></div></details></div><div class=post-content><p>Es ist recht einfach E-Mails per PowerShell zu verschicken. Dafür gibt es das mitgelieferte Cmdlet <code>Send-MailMessage</code>, welches allerdings mittlerweile von Microsoft als veraltet bezeichnet wird:</p><blockquote><p>⚠️ Warnung</p><p>Das Cmdlet <code>Send-MailMessage</code> ist veraltet. Dieses Cmdlet garantiert keine sicheren Verbindungen mit SMTP-Servern. Es ist zwar kein sofortiger Ersatz in PowerShell verfügbar, es wird jedoch empfohlen, <code>Send-MailMessage</code> nicht zu verwenden. Weitere Informationen finden Sie unter <a href=https://aka.ms/SendMailMessage target=_blank>Plattformkompatibilitätshinweis DE0005</a>.</p></blockquote><p>Quelle: <a href="https://learn.microsoft.com/de-de/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.5" target=_blank>https://learn.microsoft.com/de-de/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.5</a></p><p>Für einige Szenarien ist die Verwendung von <code>Send-MailMessage</code> aber <em>meiner Meinung nach</em> trotzdem okay. Wenn ihr zum Beispiel einen eigenen SMTP-Server (z.B. Microsoft Exchange Server) betreibt oder angemietet habt (z.B. bei jedem beliebigen Webhoster), dann gibt es dort in der Regel gar keine Unterstützung für modernere Authentifizierungsmethoden. Ihr könnt einen solchen SMTP-Server natürlich auch zusätzlich zu einer Exchange Online Umgebung betreiben. Tendenziell würde ich empfehlen für solche automatischen E-Mails eher eine Subdomain (z.B. &ldquo;reports.demotenant.de&rdquo; statt einfach nur &ldquo;demotenant.de&rdquo;) oder eine separate Domain zu verwenden, aber das ist natürlich kein Muss.</p><p>Falls ihr ausschließlich Exchange Online für den E-Mail-Versand verwendet bzw. verwenden wollt, dann ist das Cmdlet <code>Send-MailMessage</code> dafür nicht geeignet. Ich werde aber demnächst auch noch ein Video und einen Blog-Post zum Thema &ldquo;E-Mail Versand per Microsoft Graph und PowerShell&rdquo; machen. Wenn euch das interessiert, dann schaut demnächst auch hier vorbei und/oder abonniert <a href=https://youtube.com/@diecknet target=_blank>meinen YouTube Kanal</a>.</p><h2 id=beispiele>Beispiele<a hidden class=anchor aria-hidden=true href=#beispiele>#</a></h2><p>Hier sind ein paar Beispiele, die ich ganz nett fand. Ein paar weitere/andere Beispiele sind auch in der <a href="https://learn.microsoft.com/de-de/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.5" target=_blank>Microsoft Dokumentation zu dem Cmdlet</a> zu finden. Ich demonstriere die Beispiele auch <a href=https://youtu.be/zFDWjaKu2EQ target=_blank>hier in einem Video</a>.</p><h2 id=hinweis-zu-zugangsdaten>Hinweis zu Zugangsdaten<a hidden class=anchor aria-hidden=true href=#hinweis-zu-zugangsdaten>#</a></h2><p>Ihr solltet keine Zugangsdaten im Klartext in eurem PowerShell Code ablegen. Jeder der den Code in die Hand bekommt, hätte dann auch die Zugangsdaten und könnte damit Unfug treiben.
Für einfache Testzwecke könnt ihr die Zugangsdaten interaktiv abfragen. Meine nachfolgenden Beispiele gehen davon aus, dass in der Variable <code>$Credential</code> ein PSCredential Objekt mit den Zugangsdaten steckt. Das könnt ihr wie folgt abfragen:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Abfrage der Zugangsdaten und speichern als PSCredential Objekt</span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$Credential</span> = <span style=color:#d0a8ff>Get-Credential</span>
</span></span></code></pre></td></tr></table></div></div><p>Hier ist noch ein Video zum Thema &ldquo;Zugangsdaten sicher im Code ablegen&rdquo;: <a href="https://www.youtube.com/watch?v=C9bYPSWjCDY" target=_blank>https://www.youtube.com/watch?v=C9bYPSWjCDY</a></p><h3 id=hinweis-zu-encoding>Hinweis zu Encoding<a hidden class=anchor aria-hidden=true href=#hinweis-zu-encoding>#</a></h3><p>Ich verwende hier in allen Beispielen explizit UTF8 als Encoding, um Probleme mit Sonderzeichen zu verhindern. Falls die Sonderzeichen bei euch nicht richtig dargestellt werden, schaut mal, ob euer PowerShell Skript auch im UTF8 Encoding gespeichert ist. Falls es dann immer noch nicht hinhaut, müsst ihr eventuell ein anderes Encoding wählen.</p><h3 id=beispiel-1-versand-per-tlsssl-über-port-25>Beispiel 1: Versand per TLS/SSL über Port 25<a hidden class=anchor aria-hidden=true href=#beispiel-1-versand-per-tlsssl-über-port-25>#</a></h3><p>Ein einfaches Beispiel: Wir verschicken abgesichert per TLS/SSL (<code>-UseSSL</code>), aber über Port 25. Die Angabe des Ports ist damit eigentlich optional (<code>-Port 25</code>).
Die Zugangsdaten werden aus der Variable <code>$Credential</code> verwendet.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in</span>
</span></span><span style=display:flex><span><span style=color:#6c7986># der nächsten Zeile weiter.</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Send-MailMessage</span> -From <span style=color:#fc6a5d>&#34;test@demotenant.de&#34;</span> -SmtpServer <span style=color:#fc6a5d>&#34;MeinSMTPServer.demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Credential <span style=color:#41a1c0>$Credential</span> -UseSSL -Port <span style=color:#d0bf69>25</span> -To <span style=color:#fc6a5d>&#34;hans.maulwurf@demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Subject <span style=color:#fc6a5d>&#34;Hallo aus der PowerShell&#34;</span> -Body <span style=color:#fc6a5d>&#34;Das hier ist der Inhalt der Mail&#34;</span> `
</span></span><span style=display:flex><span>    -Encoding utf8
</span></span></code></pre></td></tr></table></div></div><h3 id=beispiel-2-mehrzeilige-e-mails>Beispiel 2: Mehrzeilige E-Mails<a hidden class=anchor aria-hidden=true href=#beispiel-2-mehrzeilige-e-mails>#</a></h3><p>Wenn ihr nur ganz kurze E-Mails verschicken wollt, dann kommt ihr vielleicht mit der Angabe des Texts direkt am Parameter aus. Falls ihr dabei einen Zeilenumbruch einfügen wollt, dann könnt ihr <code>`r`n</code> in euren Parameterwert für <code>-Body</code> schreiben. In der Regel würde ich aber den E-Mail-Text in einer Variable definieren und an das Cmdlet übergeben.
Mit folgender Schreibweise könnt ihr einfach einen mehrzeiligen String in PowerShell definieren:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$EmailText</span> = <span style=color:#fc6a5d>@&#34;
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>Hallo,
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>das hier ist eine E-Mail.
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>Viele Grüße
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>PowerShell
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>&#34;@</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in</span>
</span></span><span style=display:flex><span><span style=color:#6c7986># der nächsten Zeile weiter.</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Send-MailMessage</span> -From <span style=color:#fc6a5d>&#34;test@demotenant.de&#34;</span> -SmtpServer <span style=color:#fc6a5d>&#34;MeinSMTPServer.demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Credential <span style=color:#41a1c0>$Credential</span> -UseSSL -Port <span style=color:#d0bf69>25</span> -To <span style=color:#fc6a5d>&#34;hans.maulwurf@demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Subject <span style=color:#fc6a5d>&#34;Hallo aus der PowerShell&#34;</span> -Body <span style=color:#41a1c0>$EmailText</span> `
</span></span><span style=display:flex><span>    -Encoding utf8
</span></span></code></pre></td></tr></table></div></div><h3 id=beispiel-3-html-e-mails>Beispiel 3: HTML E-Mails<a hidden class=anchor aria-hidden=true href=#beispiel-3-html-e-mails>#</a></h3><p>Um eure E-Mails ein wenig hübscher zu gestalten, könnt ihr HTML verwenden. Damit das dann auch vom E-Mail-Client auf Empfängerseite richtig interpretiert wird, muss der Switch Parameter <code>-BodyAsHTML</code> angegeben werden. Der eigentliche Body (jetzt im HTML-Format) wird aber trotzdem per <code>-Body</code> angegeben.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$EmailText</span> = <span style=color:#fc6a5d>@&#34;
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>&lt;h1&gt;Hallo,&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>&lt;b&gt;das&lt;/b&gt; &lt;u&gt;hier&lt;/u&gt; ist eine &lt;i&gt;E-Mail&lt;/i&gt;.
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>Viele Grüße
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>PowerShell
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>&#34;@</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in</span>
</span></span><span style=display:flex><span><span style=color:#6c7986># der nächsten Zeile weiter.</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Send-MailMessage</span> -From <span style=color:#fc6a5d>&#34;test@demotenant.de&#34;</span> -SmtpServer <span style=color:#fc6a5d>&#34;MeinSMTPServer.demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Credential <span style=color:#41a1c0>$Credential</span> -UseSSL -Port <span style=color:#d0bf69>25</span> -To <span style=color:#fc6a5d>&#34;hans.maulwurf@demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Subject <span style=color:#fc6a5d>&#34;Hallo aus der PowerShell&#34;</span> -Body <span style=color:#41a1c0>$EmailText</span> -BodyAsHTML ` 
</span></span><span style=display:flex><span>    -Encoding utf8
</span></span></code></pre></td></tr></table></div></div><h3 id=beispiel-4-powershell-arrayobjekte-zu-html-konvertieren>Beispiel 4: PowerShell Array/Objekte zu HTML konvertieren<a hidden class=anchor aria-hidden=true href=#beispiel-4-powershell-arrayobjekte-zu-html-konvertieren>#</a></h3><p>Richtig nützlich wird es natürlich erst, wenn ihr auch Daten per PowerShell sammelt oder generiert und die dann per E-Mail verschickt. Mit dem Cmdlet <code>ConvertTo-HTML</code> könnt ihr ein Array bzw. ein PowerShell Objekt zu HTML konvertieren. Im folgenden liste ich alle lokalen User am Computer auf, um so einen kleinen Report per PowerShell zu verschicken.
Beim Cmdlet <code>ConvertTo-HTML</code> verwende ich außerdem die Parameter <code>-Property</code> um die Eigenschaften auszuwählen (sonst werden alle genommen) und <code>-Fragment</code>, damit nur eine HTML-Tabelle generiert wird und nicht eine komplette Webseite (mit komplettem HTML-Gerüst).</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$HTMLTabelle</span> = <span style=color:#d0a8ff>Get-LocalUser</span> | <span style=color:#d0a8ff>ConvertTo-HTML</span> -Property Name,SID -Fragment
</span></span><span style=display:flex><span><span style=color:#41a1c0>$EmailText</span> = <span style=color:#fc6a5d>@&#34;
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>&lt;h1&gt;Hallo,&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>das hier ist ein Report über lokale User, generiert per PowerShell.
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>Viele Grüße
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>PowerShell
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>&lt;hr&gt;
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d></span><span style=color:#41a1c0>$HTMLTabelle</span><span style=color:#fc6a5d>
</span></span></span><span style=display:flex><span><span style=color:#fc6a5d>&#34;@</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in</span>
</span></span><span style=display:flex><span><span style=color:#6c7986># der nächsten Zeile weiter.</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Send-MailMessage</span> -From <span style=color:#fc6a5d>&#34;test@demotenant.de&#34;</span> -SmtpServer <span style=color:#fc6a5d>&#34;MeinSMTPServer.demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Credential <span style=color:#41a1c0>$Credential</span> -UseSSL -Port <span style=color:#d0bf69>25</span> -To <span style=color:#fc6a5d>&#34;hans.maulwurf@demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Subject <span style=color:#fc6a5d>&#34;Hallo aus der PowerShell&#34;</span> -Body <span style=color:#41a1c0>$EmailText</span> -BodyAsHTML ` 
</span></span><span style=display:flex><span>    -Encoding utf8
</span></span></code></pre></td></tr></table></div></div><h3 id=beispiel-5-mehrere-empfänger-cc-und-bcc>Beispiel 5: Mehrere Empfänger, CC und BCC<a hidden class=anchor aria-hidden=true href=#beispiel-5-mehrere-empfänger-cc-und-bcc>#</a></h3><p>Wenn ihr nicht nur normale Empfänger per <code>-To</code> Parameter verwenden wollt, sondern auch CC oder BCC, dann könnt ihr dafür die Parameter <code>-CC</code> bzw. <code>-BCC</code> verwenden.
Und bei allen 3 Parametern könnt ihr mehrere Empfänger eingeben, wenn ihr sie als Array angebt. Zum Beispiel so: <code>-To "hans.maulwurf@demotenant.de","alexw@demotenant.de"</code>.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in</span>
</span></span><span style=display:flex><span><span style=color:#6c7986># der nächsten Zeile weiter.</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Send-MailMessage</span> -From <span style=color:#fc6a5d>&#34;test@demotenant.de&#34;</span> -SmtpServer <span style=color:#fc6a5d>&#34;MeinSMTPServer.demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Credential <span style=color:#41a1c0>$Credential</span> -UseSSL -Port <span style=color:#d0bf69>25</span> -To <span style=color:#fc6a5d>&#34;hans.maulwurf@demotenant.de&#34;</span>,<span style=color:#fc6a5d>&#34;alexw@demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Subject <span style=color:#fc6a5d>&#34;Hallo aus der PowerShell&#34;</span> -Body <span style=color:#fc6a5d>&#34;Das hier ist der Inhalt der Mail&#34;</span> `
</span></span><span style=display:flex><span>    -Encoding utf8 -CC <span style=color:#fc6a5d>&#34;irgendjemand@demotenant.de&#34;</span> -BCC <span style=color:#fc6a5d>&#34;beispiel@demotenant.de&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=beispiel-6-e-mail-anhänge>Beispiel 6: E-Mail Anhänge<a hidden class=anchor aria-hidden=true href=#beispiel-6-e-mail-anhänge>#</a></h3><p>Um E-Mail Anhänge hinzuzufügen, könnt ihr den Pfad zur Datei am Parameter <code>-Attachment</code> angeben. Mehrere Anhänge sind auch möglich, wenn sie als Array angegeben werden, z.B. so: <code>-Attachment "Anhang1.docx","Anhang2.txt"</code>.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Hinweis: Das Backtick am Ende der Zeile beachten! Die Parameter gehen also in</span>
</span></span><span style=display:flex><span><span style=color:#6c7986># der nächsten Zeile weiter.</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Send-MailMessage</span> -From <span style=color:#fc6a5d>&#34;test@demotenant.de&#34;</span> -SmtpServer <span style=color:#fc6a5d>&#34;MeinSMTPServer.demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Credential <span style=color:#41a1c0>$Credential</span> -UseSSL -Port <span style=color:#d0bf69>25</span> -To <span style=color:#fc6a5d>&#34;hans.maulwurf@demotenant.de&#34;</span>,<span style=color:#fc6a5d>&#34;alexw@demotenant.de&#34;</span> `
</span></span><span style=display:flex><span>    -Subject <span style=color:#fc6a5d>&#34;Hallo aus der PowerShell&#34;</span> -Body <span style=color:#fc6a5d>&#34;Das hier ist der Inhalt der Mail&#34;</span> `
</span></span><span style=display:flex><span>    -Encoding utf8 -Attachment <span style=color:#fc6a5d>&#34;Anhang.docx&#34;</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/de/tags/powershell/>Powershell</a></li></ul><div class=share-buttons></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://diecknet.de/de/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/de/legal/>Impressum</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/de/privacy/>Datenschutz</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Kopieren";function s(){t.innerHTML="Kopiert!",setTimeout(()=>{t.innerHTML="Kopieren"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>