<!doctype html><html lang=de dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Das Problem mit Array += in PowerShell | diecknet</title>
<meta name=keywords content="powershell"><meta name=description content="Die PowerShell macht es leider recht einfach ineffizienten Code zu schreiben. Viele Leute benutzen zum Beispiel die += Schreibweise um ein Array zu befüllen. Nicht empfehlenswert!
1 2 3 4 5 # So bitte nicht machen! $Array = @() for ($i = 0; $i -lt 10000; $i++) { $Array += $i } Mit Measure-Command können wir messen, wie lange die Ausführung eines Skriptblocks dauert. Bei mir hat die Ausführung des obigen Codes in einer Test-VM über 2 Sekunden benötigt."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/de/2024/09/12/powershell-array-plus/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=de href=https://diecknet.de/de/2024/09/12/powershell-array-plus/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Das Problem mit Array += in PowerShell"><meta property="og:description" content="Die PowerShell macht es leider recht einfach ineffizienten Code zu schreiben. Viele Leute benutzen zum Beispiel die += Schreibweise um ein Array zu befüllen. Nicht empfehlenswert!
1 2 3 4 5 # So bitte nicht machen! $Array = @() for ($i = 0; $i -lt 10000; $i++) { $Array += $i } Mit Measure-Command können wir messen, wie lange die Ausführung eines Skriptblocks dauert. Bei mir hat die Ausführung des obigen Codes in einer Test-VM über 2 Sekunden benötigt."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/de/2024/09/12/powershell-array-plus/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-12T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Das Problem mit Array += in PowerShell"><meta name=twitter:description content="Die PowerShell macht es leider recht einfach ineffizienten Code zu schreiben. Viele Leute benutzen zum Beispiel die += Schreibweise um ein Array zu befüllen. Nicht empfehlenswert!
1 2 3 4 5 # So bitte nicht machen! $Array = @() for ($i = 0; $i -lt 10000; $i++) { $Array += $i } Mit Measure-Command können wir messen, wie lange die Ausführung eines Skriptblocks dauert. Bei mir hat die Ausführung des obigen Codes in einer Test-VM über 2 Sekunden benötigt."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/de/posts/"},{"@type":"ListItem","position":2,"name":"Das Problem mit Array += in PowerShell","item":"https://diecknet.de/de/2024/09/12/powershell-array-plus/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Das Problem mit Array += in PowerShell","name":"Das Problem mit Array \u002b= in PowerShell","description":"Die PowerShell macht es leider recht einfach ineffizienten Code zu schreiben. Viele Leute benutzen zum Beispiel die += Schreibweise um ein Array zu befüllen. Nicht empfehlenswert!\n1 2 3 4 5 # So bitte nicht machen! $Array = @() for ($i = 0; $i -lt 10000; $i++) { $Array += $i } Mit Measure-Command können wir messen, wie lange die Ausführung eines Skriptblocks dauert. Bei mir hat die Ausführung des obigen Codes in einer Test-VM über 2 Sekunden benötigt.","keywords":["powershell"],"articleBody":"Die PowerShell macht es leider recht einfach ineffizienten Code zu schreiben. Viele Leute benutzen zum Beispiel die += Schreibweise um ein Array zu befüllen. Nicht empfehlenswert!\n1 2 3 4 5 # So bitte nicht machen! $Array = @() for ($i = 0; $i -lt 10000; $i++) { $Array += $i } Mit Measure-Command können wir messen, wie lange die Ausführung eines Skriptblocks dauert. Bei mir hat die Ausführung des obigen Codes in einer Test-VM über 2 Sekunden benötigt.\nUrsache Die Ursache ist, dass Arrays in PowerShell eigentlich statisch sind. Sie können nicht wirklich um neue Einträge ergänzt werden. Stattdessen wird der Inhalt vom Array kopiert, um den neuen Eintrag ergänzt und in einem neuen Array Objekt gespeichert. Meistens wird das alte Array dann in die gleiche Variable gespeichert, wie das alte Array - deshalb ist dieser Vorgang nicht richtig sichtbar und wird nicht bemerkt.\nAlternativen Es gibt verschiedene Alternativen zur += Methode.\nPipeline abfangen Wenn die Daten im Array nur einmalig angelegt werden sollen, aber nicht verändert werden müssen, dann bevorzuge ich folgendes. Ich nehme meine Variable in der ich das Array speichern möchte, und weise als Inhalt einfach die Rückgabe meiner Schleife zu. Innerhalb der Schleife erfolgt dann gar keine Zuweisung, sondern nur das Ausgabe eines Objekts. Die initialisierung der Variable als Array z.B. per $MeinArray = @() ist in dem Fall auch nicht nötig.\n1 2 3 4 # $MeinArray erhält als Inhalt die Rückgabe der Schleife $MeinArray = for ($i = 0; $i -lt 10000; $i++) { $i # Diese Rückgabe landet automatisch in der Variable $MeinArray } Generic List Wenn die Daten auch geändert werden sollen, ist eine Generic List praktisch. Diese muss per .NET Methode initialisiert werden, was minimal komplizierter als normale PowerShell Cmdlets ist. Aber der Code kann natürlich auch einfach kopiert werden, deshalb spielt es nicht wirklich eine Rolle.\n1 2 3 4 $List = [Collections.Generic.List[PSObject]]::new() for ($i = 0; $i -lt 10000; $i++) { $List.Add($i) } Ich zeige das auch noch mit mehr Details in einem Video im kostenlosen PowerShell Kurs.\nWeitere Alternativen Es gibt auch noch weitere Alternativen, wie z.B. Hashtables.\n1 2 3 4 $MeineHashtable = @{\"Hallo\"=\"Hallo PowerShell\"} # Verschiedene Varianten um Daten zur Hashtable hinzuzufügen $MeineHashtable[\"hi\"] = \"Hi PowerShell :)\" $MeineHashTable.Add(\"moin\",\"MOIN MOIN!\") Verbesserungen ab PowerShell 7.5 Ab PowerShell 7.5 (erscheint voraussichtlich im November 2024) ist die Problematik aber etwas entschärft. Die += Methode funktioniert dort weitaus schneller als in bisherigen PowerShell Versionen. 100%ig ideal ist sie trotzdem nicht, da weiterhin Daten unnötig im Arbeitsspeicher hin und her kopiert werden müssen.\nGeschwindigkeit messen Mit folgendem Code habe ich die Geschwindigkeit von += vs. Generic Lists gemessen. Wobei der Testcode für “Allocated Memory” nur in PowerShell 7 funktioniert, nicht in Windows PowerShell 5.1.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #Requires -Version 7.4 $Host.UI.RawUI.WindowTitle = $PSVersionTable.PSVersion Write-Host \"Using PowerShell $($PSVersionTable.PSVersion)\" -ForegroundColor DarkYellow \"--------------------------------------\" #region Test Array += $s = [gc]::GetTotalAllocatedBytes($true) $Time = (Measure-Command { \u0026{ $val = @() for ($i = 0; $i -lt 10000; $i++) { $val += $i } } }).TotalMilliseconds $e = [gc]::GetTotalAllocatedBytes($true); $RAM = [math]::Round(($e-$s)/1MB,2) Write-Host \"Using += took $($Time)ms\" Write-Host \"Allocated Memory $($RAM)MB\" #endregion \"--------------------------------------\" #region Test List $s = [gc]::GetTotalAllocatedBytes($true) $Time = (Measure-Command { \u0026{ $List = [Collections.Generic.List[PSObject]]::new() for ($i = 0; $i -lt 10000; $i++) { $List.Add($i) } } }).TotalMilliseconds $e = [gc]::GetTotalAllocatedBytes($true); $RAM = [math]::Round(($e-$s)/1MB,2) Write-Host \"Using List.Add() took $($Time)ms\" Write-Host \"Allocated Memory $($RAM)MB\" #endregion ","wordCount":"601","inLanguage":"de","datePublished":"2024-09-12T00:00:00Z","dateModified":"2024-09-12T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/de/2024/09/12/powershell-array-plus/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/de/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/ title=Deutsch aria-label=Deutsch><b>Deutsch</b></a></li><li><a href=https://diecknet.de/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/de/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/de/services/ title=Services><span>Services</span></a></li><li><a href=https://diecknet.de/de/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/de/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/de/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/de/>Home</a>&nbsp;»&nbsp;<a href=https://diecknet.de/de/posts/>Posts</a></div><h1 class=post-title>Das Problem mit Array += in PowerShell</h1><div class=post-meta><span title='2024-09-12 00:00:00 +0000 UTC'>2024-09-12</span>&nbsp;·&nbsp;3 Minuten&nbsp;·&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/de/posts/2024/2024-09-12-PowerShell-Array-plus.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Inhaltsverzeichnis</span></summary><div class=inner><ul><li><a href=#ursache aria-label=Ursache>Ursache</a></li><li><a href=#alternativen aria-label=Alternativen>Alternativen</a><ul><li><a href=#pipeline-abfangen aria-label="Pipeline abfangen">Pipeline abfangen</a></li><li><a href=#generic-list aria-label="Generic List">Generic List</a></li><li><a href=#weitere-alternativen aria-label="Weitere Alternativen">Weitere Alternativen</a></li></ul></li><li><a href=#verbesserungen-ab-powershell-75 aria-label="Verbesserungen ab PowerShell 7.5">Verbesserungen ab PowerShell 7.5</a></li><li><a href=#geschwindigkeit-messen aria-label="Geschwindigkeit messen">Geschwindigkeit messen</a></li></ul></div></details></div><div class=post-content><p>Die PowerShell macht es leider recht einfach ineffizienten Code zu schreiben. Viele Leute benutzen zum Beispiel die <code>+=</code> Schreibweise um ein Array zu befüllen. Nicht empfehlenswert!</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># So bitte nicht machen!</span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$Array</span> = @()
</span></span><span style=display:flex><span><span style=color:#fc5fa3>for</span> (<span style=color:#41a1c0>$i</span> = <span style=color:#d0bf69>0</span>; <span style=color:#41a1c0>$i</span> -lt <span style=color:#d0bf69>10000</span>; <span style=color:#41a1c0>$i</span>++) {
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#41a1c0>$Array</span> += <span style=color:#41a1c0>$i</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Mit <code>Measure-Command</code> können wir messen, wie lange die Ausführung eines Skriptblocks dauert. Bei mir hat die Ausführung des obigen Codes in einer Test-VM über 2 Sekunden benötigt.</p><p><a href=/images/2024/2024-09-12_Measure-Command1.jpg><img loading=lazy src=/images/2024/2024-09-12_Measure-Command1.jpg alt="Das Ergebnis von Measure-Command: TotalMilliSeconds 2260" title="Das Ergebnis von Measure-Command: TotalMilliSeconds 2260"></a></p><h2 id=ursache>Ursache<a hidden class=anchor aria-hidden=true href=#ursache>#</a></h2><p>Die Ursache ist, dass Arrays in PowerShell eigentlich statisch sind. Sie können nicht <em>wirklich</em> um neue Einträge ergänzt werden. Stattdessen wird der Inhalt vom Array kopiert, um den neuen Eintrag ergänzt und in einem neuen Array Objekt gespeichert. Meistens wird das alte Array dann in die gleiche Variable gespeichert, wie das alte Array - deshalb ist dieser Vorgang nicht richtig sichtbar und wird nicht bemerkt.</p><h2 id=alternativen>Alternativen<a hidden class=anchor aria-hidden=true href=#alternativen>#</a></h2><p>Es gibt verschiedene Alternativen zur <code>+=</code> Methode.</p><h3 id=pipeline-abfangen>Pipeline abfangen<a hidden class=anchor aria-hidden=true href=#pipeline-abfangen>#</a></h3><p>Wenn die Daten im Array nur einmalig angelegt werden sollen, aber nicht verändert werden müssen, dann bevorzuge ich folgendes. Ich nehme meine Variable in der ich das Array speichern möchte, und weise als Inhalt einfach die Rückgabe meiner Schleife zu. Innerhalb der Schleife erfolgt dann gar keine Zuweisung, sondern nur das Ausgabe eines Objekts. Die initialisierung der Variable als Array z.B. per <code>$MeinArray = @()</code> ist in dem Fall auch nicht nötig.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># $MeinArray erhält als Inhalt die Rückgabe der Schleife</span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$MeinArray</span> = <span style=color:#fc5fa3>for</span> (<span style=color:#41a1c0>$i</span> = <span style=color:#d0bf69>0</span>; <span style=color:#41a1c0>$i</span> -lt <span style=color:#d0bf69>10000</span>; <span style=color:#41a1c0>$i</span>++) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$i</span> <span style=color:#6c7986># Diese Rückgabe landet automatisch in der Variable $MeinArray</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=generic-list>Generic List<a hidden class=anchor aria-hidden=true href=#generic-list>#</a></h3><p>Wenn die Daten auch geändert werden sollen, ist eine Generic List praktisch. Diese muss per .NET Methode initialisiert werden, was minimal komplizierter als normale PowerShell Cmdlets ist. Aber der Code kann natürlich auch einfach kopiert werden, deshalb spielt es nicht wirklich eine Rolle.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$List</span> = [Collections.Generic.List[PSObject]]::new()
</span></span><span style=display:flex><span><span style=color:#fc5fa3>for</span> (<span style=color:#41a1c0>$i</span> = <span style=color:#d0bf69>0</span>; <span style=color:#41a1c0>$i</span> -lt <span style=color:#d0bf69>10000</span>; <span style=color:#41a1c0>$i</span>++) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$List</span>.Add(<span style=color:#41a1c0>$i</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Ich zeige das auch noch mit mehr Details in <a href="https://www.youtube.com/watch?v=tCJyYLgiSZA" target=_blank>einem Video im kostenlosen PowerShell Kurs</a>.</p><h3 id=weitere-alternativen>Weitere Alternativen<a hidden class=anchor aria-hidden=true href=#weitere-alternativen>#</a></h3><p>Es gibt auch noch weitere Alternativen, wie z.B. Hashtables.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$MeineHashtable</span> = @{<span style=color:#fc6a5d>&#34;Hallo&#34;</span>=<span style=color:#fc6a5d>&#34;Hallo PowerShell&#34;</span>}
</span></span><span style=display:flex><span><span style=color:#6c7986># Verschiedene Varianten um Daten zur Hashtable hinzuzufügen</span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$MeineHashtable</span>[<span style=color:#fc6a5d>&#34;hi&#34;</span>] = <span style=color:#fc6a5d>&#34;Hi PowerShell :)&#34;</span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$MeineHashTable</span>.Add(<span style=color:#fc6a5d>&#34;moin&#34;</span>,<span style=color:#fc6a5d>&#34;MOIN MOIN!&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><h2 id=verbesserungen-ab-powershell-75>Verbesserungen ab PowerShell 7.5<a hidden class=anchor aria-hidden=true href=#verbesserungen-ab-powershell-75>#</a></h2><p>Ab PowerShell 7.5 (erscheint voraussichtlich im November 2024) ist die Problematik aber etwas <a href=https://github.com/PowerShell/PowerShell/pull/23901 target=_blank>entschärft</a>. Die <code>+=</code> Methode funktioniert dort weitaus schneller als in bisherigen PowerShell Versionen. 100%ig ideal ist sie trotzdem nicht, da weiterhin Daten unnötig im Arbeitsspeicher hin und her kopiert werden müssen.</p><p><a href=/images/2024/2024-09-12_Measure-Command2.jpg><img loading=lazy src=/images/2024/2024-09-12_Measure-Command2.jpg alt="+= ist weitaus schneller in PowerShell 7.5, als in bisherigen Versionen. Hier 55ms statt 2768ms." title="+= ist weitaus schneller in PowerShell 7.5, als in bisherigen Versionen. Hier 55ms statt 2768ms."></a></p><h2 id=geschwindigkeit-messen>Geschwindigkeit messen<a hidden class=anchor aria-hidden=true href=#geschwindigkeit-messen>#</a></h2><p>Mit folgendem Code habe ich die Geschwindigkeit von <code>+=</code> vs. Generic Lists gemessen. Wobei der Testcode für &ldquo;Allocated Memory&rdquo; nur in PowerShell 7 funktioniert, nicht in Windows PowerShell 5.1.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986>#</span><span style=color:#fc5fa3>Requires</span> <span style=color:#fc5fa3>-Version</span> 7.4
</span></span><span style=display:flex><span><span style=color:#41a1c0>$Host</span>.UI.RawUI.WindowTitle = <span style=color:#41a1c0>$PSVersionTable</span>.PSVersion
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Write-Host</span> <span style=color:#fc6a5d>&#34;Using PowerShell </span>$(<span style=color:#41a1c0>$PSVersionTable</span>.PSVersion)<span style=color:#fc6a5d>&#34;</span> -ForegroundColor DarkYellow
</span></span><span style=display:flex><span><span style=color:#fc6a5d>&#34;--------------------------------------&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986>#region Test Array +=</span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$s</span> = [gc]::GetTotalAllocatedBytes($true)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$Time</span> = (<span style=color:#d0a8ff>Measure-Command</span> {
</span></span><span style=display:flex><span>    &amp;{
</span></span><span style=display:flex><span>        <span style=color:#41a1c0>$val</span> = @()
</span></span><span style=display:flex><span>        <span style=color:#fc5fa3>for</span> (<span style=color:#41a1c0>$i</span> = <span style=color:#d0bf69>0</span>; <span style=color:#41a1c0>$i</span> -lt <span style=color:#d0bf69>10000</span>; <span style=color:#41a1c0>$i</span>++) {
</span></span><span style=display:flex><span>            <span style=color:#41a1c0>$val</span> += <span style=color:#41a1c0>$i</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}).TotalMilliseconds
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$e</span> = [gc]::GetTotalAllocatedBytes($true);
</span></span><span style=display:flex><span><span style=color:#41a1c0>$RAM</span> = [math]::Round((<span style=color:#41a1c0>$e</span>-<span style=color:#41a1c0>$s</span>)/<span style=color:#d0bf69>1</span>MB,<span style=color:#d0bf69>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Write-Host</span> <span style=color:#fc6a5d>&#34;Using += took </span>$(<span style=color:#41a1c0>$Time</span>)<span style=color:#fc6a5d>ms&#34;</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Write-Host</span> <span style=color:#fc6a5d>&#34;Allocated Memory </span>$(<span style=color:#41a1c0>$RAM</span>)<span style=color:#fc6a5d>MB&#34;</span>
</span></span><span style=display:flex><span><span style=color:#6c7986>#endregion</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fc6a5d>&#34;--------------------------------------&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986>#region Test List</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$s</span> = [gc]::GetTotalAllocatedBytes($true)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$Time</span> = (<span style=color:#d0a8ff>Measure-Command</span> {
</span></span><span style=display:flex><span>    &amp;{
</span></span><span style=display:flex><span>        <span style=color:#41a1c0>$List</span> = [Collections.Generic.List[PSObject]]::new()
</span></span><span style=display:flex><span>        <span style=color:#fc5fa3>for</span> (<span style=color:#41a1c0>$i</span> = <span style=color:#d0bf69>0</span>; <span style=color:#41a1c0>$i</span> -lt <span style=color:#d0bf69>10000</span>; <span style=color:#41a1c0>$i</span>++) {
</span></span><span style=display:flex><span>            <span style=color:#41a1c0>$List</span>.Add(<span style=color:#41a1c0>$i</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}).TotalMilliseconds
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a1c0>$e</span> = [gc]::GetTotalAllocatedBytes($true);
</span></span><span style=display:flex><span><span style=color:#41a1c0>$RAM</span> = [math]::Round((<span style=color:#41a1c0>$e</span>-<span style=color:#41a1c0>$s</span>)/<span style=color:#d0bf69>1</span>MB,<span style=color:#d0bf69>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Write-Host</span> <span style=color:#fc6a5d>&#34;Using List.Add() took </span>$(<span style=color:#41a1c0>$Time</span>)<span style=color:#fc6a5d>ms&#34;</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Write-Host</span> <span style=color:#fc6a5d>&#34;Allocated Memory </span>$(<span style=color:#41a1c0>$RAM</span>)<span style=color:#fc6a5d>MB&#34;</span>
</span></span><span style=display:flex><span><span style=color:#6c7986>#endregion</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/de/tags/powershell/>Powershell</a></li></ul><div class=share-buttons></div></footer><script src=https://giscus.diecknet.de/client.js data-repo=diecknet/diecknet-blog data-repo-id="MDEwOlJlcG9zaXRvcnkyMDkzNDUzNzM=" data-category="Blog Discussions" data-category-id=MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyNjMwOTY0 data-mapping=specific data-term=powershell-array-plus data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://diecknet.de/de/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/de/legal/>Impressum</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/de/privacy/>Datenschutz</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Kopieren";function s(){t.innerHTML="Kopiert!",setTimeout(()=>{t.innerHTML="Kopieren"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>