<!doctype html><html lang=de dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PowerShell NTFS Alternate Data Streams | diecknet</title>
<meta name=keywords content="powershell,ntfs"><meta name=description content="Das Dateisystem NTFS wird standardmäßig unter Windows verwendet. Und normalerweise hat eine Datei nur einen dazugehörigen normalen Datenstrom (Data Stream) mit dem Namen :$DATA. Aber es gibt auch die sogenannten &ldquo;Alternate Data Streams&rdquo; (ADS), die zusätzliche Daten enthalten können.
Diese ADS werden teilweise vom System verwendet, könnten aber auch von Angreifern verwendet werden, um Daten zu verstecken.
NTFS Alternate Data Stream auslesen Aus dem Internet heruntergeladene Dateien erhalten bei vielen Browsern unter Windows ein &ldquo;Mark of the web&rdquo; (MOTW) im Zone."><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=de href=https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/><link rel=alternate hreflang=en href=https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="PowerShell NTFS Alternate Data Streams"><meta property="og:description" content="Das Dateisystem NTFS wird standardmäßig unter Windows verwendet. Und normalerweise hat eine Datei nur einen dazugehörigen normalen Datenstrom (Data Stream) mit dem Namen :$DATA. Aber es gibt auch die sogenannten &ldquo;Alternate Data Streams&rdquo; (ADS), die zusätzliche Daten enthalten können.
Diese ADS werden teilweise vom System verwendet, könnten aber auch von Angreifern verwendet werden, um Daten zu verstecken.
NTFS Alternate Data Stream auslesen Aus dem Internet heruntergeladene Dateien erhalten bei vielen Browsern unter Windows ein &ldquo;Mark of the web&rdquo; (MOTW) im Zone."><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-30T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-30T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="PowerShell NTFS Alternate Data Streams"><meta name=twitter:description content="Das Dateisystem NTFS wird standardmäßig unter Windows verwendet. Und normalerweise hat eine Datei nur einen dazugehörigen normalen Datenstrom (Data Stream) mit dem Namen :$DATA. Aber es gibt auch die sogenannten &ldquo;Alternate Data Streams&rdquo; (ADS), die zusätzliche Daten enthalten können.
Diese ADS werden teilweise vom System verwendet, könnten aber auch von Angreifern verwendet werden, um Daten zu verstecken.
NTFS Alternate Data Stream auslesen Aus dem Internet heruntergeladene Dateien erhalten bei vielen Browsern unter Windows ein &ldquo;Mark of the web&rdquo; (MOTW) im Zone."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/de/posts/"},{"@type":"ListItem","position":2,"name":"PowerShell NTFS Alternate Data Streams","item":"https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PowerShell NTFS Alternate Data Streams","name":"PowerShell NTFS Alternate Data Streams","description":"Das Dateisystem NTFS wird standardmäßig unter Windows verwendet. Und normalerweise hat eine Datei nur einen dazugehörigen normalen Datenstrom (Data Stream) mit dem Namen :$DATA. Aber es gibt auch die sogenannten \u0026ldquo;Alternate Data Streams\u0026rdquo; (ADS), die zusätzliche Daten enthalten können.\nDiese ADS werden teilweise vom System verwendet, könnten aber auch von Angreifern verwendet werden, um Daten zu verstecken.\nNTFS Alternate Data Stream auslesen Aus dem Internet heruntergeladene Dateien erhalten bei vielen Browsern unter Windows ein \u0026ldquo;Mark of the web\u0026rdquo; (MOTW) im Zone.","keywords":["powershell","ntfs"],"articleBody":"Das Dateisystem NTFS wird standardmäßig unter Windows verwendet. Und normalerweise hat eine Datei nur einen dazugehörigen normalen Datenstrom (Data Stream) mit dem Namen :$DATA. Aber es gibt auch die sogenannten “Alternate Data Streams” (ADS), die zusätzliche Daten enthalten können.\nDiese ADS werden teilweise vom System verwendet, könnten aber auch von Angreifern verwendet werden, um Daten zu verstecken.\nNTFS Alternate Data Stream auslesen Aus dem Internet heruntergeladene Dateien erhalten bei vielen Browsern unter Windows ein “Mark of the web” (MOTW) im Zone.Identifier Stream. Dieser Stream enthält Infos zur Quelle der Datei - also z.B. dass sie aus dem Internet heruntergeladen wurde. Um den Inhalt eines ADS auszulesen, kann einfach Get-Content mit dem Parameter -Stream und der Angabe des Streamnamens verwendet werden. Alternativ kann an den Dateinamen : angehängt werden.\n1 2 3 4 5 6 7 8 9 # Zwei Varianten um den Zone.Identifier Stream auszulesen Get-Content .\\Beispiel.txt -Stream Zone.Identifier Get-Content .\\Beispiel.txt:Zone.Identifier # Rückgabe [ZoneTransfer] ZoneId=3 ReferrerUrl=https://diecknet.de HostUrl=https://github.com Der tatsächliche Inhalt von Zone.Identifier kann abweichen. Mal sind mehr oder weniger Infos enthalten. Die Info zur ZoneId sollte aber immer enthalten sein. Folgende Werte sind für die Zone möglich:\nWert Bedeutung 0 My Computer 1 Local Intranet Zone 2 Trusted sites Zone 3 Internet Zone 4 Restricted Sites Zone Quelle: https://learn.microsoft.com/en-us/previous-versions/troubleshoot/browsers/security-privacy/ie-security-zones-registry-entries#zones\nDer Windows Smartscreen Filter legt teilweise auch noch einen eigenen ADS namens SmartScreen an. Wenn dort Anaheim als Inhalt steht, wurde die Datei als unsicher eingestuft.\n1 2 3 4 Get-Content .\\Beispiel.exe -Stream Smartscreen # Rückgabe Anaheim Und falls es irgendwelche komplett anderen Streams gibt, könnt ihr sie natürlich mit der gleichen Vorgehensweise auslesen.\nMark of the web entfernen Der reguläre Weg um das “Mark of the web” zu entfernen ist per Unblock-File oder per Eigenschaften Dialog der Datei.\n1 Unblock-File .\\MeineDatei.docx NTFS Alternate Data Streams finden Um herauszufinden, welche Alternate Data Streams vorhanden sind, kann der Parameter -Stream vom Cmdlet Get-Item genutzt werden. Mit * als Platzhalter können wir alle ADS finden.\n1 2 # Alle Streams von allen Daten im aktuellen Verzeichnis auflisten Get-Item * -Stream * Die Info, dass der Standard :$DATA Stream vorhanden ist, können wir aber auch wegfiltern:\n1 Get-Item * -Stream * | Where-Object {$_.Stream -ne ':$DATA' } Noch etwas flexibler geht es mit dem Skript Get-NTFSADS.ps1 welches ich auf GitHub veröffentlicht habe.\nNTFS Alternate Data Streams schreiben Es ist möglich eigene Daten in ADS reinzuschreiben. Dafür kann z.B. Set-Content/Add-Content verwendet werden.\n1 2 3 4 5 6 7 # Zwei Varianten um den Beispiel Stream zu setzen, ggf. wird er überschrieben Set-Content .\\MeineDatei.docx -Stream \"Beispiel\" -Value \"Hallo PowerShell!\" Set-Content .\\MeineDatei.docx:Beispiel -Value \"Hallo PowerShell!\" # Zwei Varianten um den Beispiel Stream zu ergänzen Add-Content .\\MeineDatei.docx -Stream \"Beispiel\" -Value \"Hallo PowerShell!\" Add-Content .\\MeineDatei.docx:Beispiel -Value \"Hallo PowerShell!\" NTFS Alternate Data Streams löschen ADS können wie normale Dateien auch per Remove-Item gelöscht werden. Die Datei und der :$DATA Stream würden im folgenden Beispiel weiter existieren:\n1 Remove-Item .\\MeineDatei.docx -Stream \"Beispiel\" Fazit NTFS Alternate Data Streams sind eine interessante Funktion. Als Einfallstor für Angreifer sind sie weniger geeignet, da bei einem normalen Download keine zusätzlichen Data Streams übermittelt werden können. Aber in manchen Containerformaten könnten auch ADS übertragen werden, wie z.B. innerhalb von .vhdx-Dateien für virtuelle Festplattenabbilder. Allerdings wäre die Verwendung eines ADS-fähigen Containers auch schon sehr auffällig.\nIch denke, dass ADS dann eher von Angreifern verwendet werden könnten, wenn sie sich bereits in einem System eingenistet haben. Dann könnten Schadcodes oder andere Daten versteckt werden. Allerdings sollten (meiner Meinung nach) moderne EDR Lösungen anschlagen, falls ADS verwendet werden - technisch möglich wäre es z.B. per Sysmon Logging.\n","wordCount":"591","inLanguage":"de","datePublished":"2024-08-30T00:00:00Z","dateModified":"2024-08-30T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/de/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/2024/08/30/powershell-ntfs-alternate-data-streams/ title=Deutsch aria-label=Deutsch><b>Deutsch</b></a></li><li><a href=https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/de/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/de/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/de/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/de/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/de/>Home</a>&nbsp;»&nbsp;<a href=https://diecknet.de/de/posts/>Posts</a></div><h1 class=post-title>PowerShell NTFS Alternate Data Streams</h1><div class=post-meta><span title='2024-08-30 00:00:00 +0000 UTC'>2024-08-30</span>&nbsp;·&nbsp;3 Minuten&nbsp;·&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<ul class=i18n_list>🌍&nbsp;This content is also available in:&nbsp;<li><a href=https://diecknet.de/en/2024/08/30/powershell-ntfs-alternate-data-streams/>English</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/de/posts/2024/2024-08-30-PowerShell-NTFS-Alternate-Data-Streams.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Inhaltsverzeichnis</span></summary><div class=inner><ul><li><a href=#ntfs-alternate-data-stream-auslesen aria-label="NTFS Alternate Data Stream auslesen">NTFS Alternate Data Stream auslesen</a><ul><li><a href=#mark-of-the-web-entfernen aria-label="Mark of the web entfernen">Mark of the web entfernen</a></li></ul></li><li><a href=#ntfs-alternate-data-streams-finden aria-label="NTFS Alternate Data Streams finden">NTFS Alternate Data Streams finden</a></li><li><a href=#ntfs-alternate-data-streams-schreiben aria-label="NTFS Alternate Data Streams schreiben">NTFS Alternate Data Streams schreiben</a></li><li><a href=#ntfs-alternate-data-streams-l%c3%b6schen aria-label="NTFS Alternate Data Streams löschen">NTFS Alternate Data Streams löschen</a></li><li><a href=#fazit aria-label=Fazit>Fazit</a></li></ul></div></details></div><div class=post-content><p>Das Dateisystem NTFS wird standardmäßig unter Windows verwendet. Und normalerweise hat eine Datei nur einen dazugehörigen normalen Datenstrom (Data Stream) mit dem Namen <code>:$DATA</code>. Aber es gibt auch die sogenannten &ldquo;Alternate Data Streams&rdquo; (ADS), die zusätzliche Daten enthalten können.</p><p>Diese ADS werden teilweise vom System verwendet, könnten aber auch von Angreifern verwendet werden, um Daten zu verstecken.</p><h2 id=ntfs-alternate-data-stream-auslesen>NTFS Alternate Data Stream auslesen<a hidden class=anchor aria-hidden=true href=#ntfs-alternate-data-stream-auslesen>#</a></h2><p>Aus dem Internet heruntergeladene Dateien erhalten bei vielen Browsern unter Windows ein &ldquo;Mark of the web&rdquo; (MOTW) im <code>Zone.Identifier</code> Stream. Dieser Stream enthält Infos zur Quelle der Datei - also z.B. dass sie aus dem Internet heruntergeladen wurde.
Um den Inhalt eines ADS auszulesen, kann einfach <code>Get-Content</code> mit dem Parameter <code>-Stream</code> und der Angabe des Streamnamens verwendet werden. Alternativ kann an den Dateinamen <code>:&lt;Name des Streams></code> angehängt werden.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Zwei Varianten um den Zone.Identifier Stream auszulesen</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-Content</span> .\Beispiel.txt -Stream Zone.Identifier
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-Content</span> .\Beispiel.txt<span style=color:#960050>:</span>Zone.Identifier
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Rückgabe</span>
</span></span><span style=display:flex><span>[ZoneTransfer]
</span></span><span style=display:flex><span>ZoneId=<span style=color:#d0bf69>3</span>
</span></span><span style=display:flex><span>ReferrerUrl=https<span style=color:#960050>:</span>//diecknet.de
</span></span><span style=display:flex><span>HostUrl=https<span style=color:#960050>:</span>//github.com
</span></span></code></pre></td></tr></table></div></div><p>Der tatsächliche Inhalt von <code>Zone.Identifier</code> kann abweichen. Mal sind mehr oder weniger Infos enthalten. Die Info zur <code>ZoneId</code> sollte aber immer enthalten sein. Folgende Werte sind für die Zone möglich:</p><table><thead><tr><th>Wert</th><th>Bedeutung</th></tr></thead><tbody><tr><td>0</td><td>My Computer</td></tr><tr><td>1</td><td>Local Intranet Zone</td></tr><tr><td>2</td><td>Trusted sites Zone</td></tr><tr><td>3</td><td>Internet Zone</td></tr><tr><td>4</td><td>Restricted Sites Zone</td></tr></tbody></table><p>Quelle: <a href=https://learn.microsoft.com/en-us/previous-versions/troubleshoot/browsers/security-privacy/ie-security-zones-registry-entries#zones target=_blank>https://learn.microsoft.com/en-us/previous-versions/troubleshoot/browsers/security-privacy/ie-security-zones-registry-entries#zones</a></p><p>Der Windows Smartscreen Filter legt teilweise auch noch einen eigenen ADS namens <code>SmartScreen</code> an. Wenn dort <code>Anaheim</code> als Inhalt steht, wurde die Datei als unsicher eingestuft.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-Content</span> .\Beispiel.exe -Stream Smartscreen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Rückgabe</span>
</span></span><span style=display:flex><span>Anaheim
</span></span></code></pre></td></tr></table></div></div><p>Und falls es irgendwelche komplett anderen Streams gibt, könnt ihr sie natürlich mit der gleichen Vorgehensweise auslesen.</p><h3 id=mark-of-the-web-entfernen>Mark of the web entfernen<a hidden class=anchor aria-hidden=true href=#mark-of-the-web-entfernen>#</a></h3><p>Der reguläre Weg um das &ldquo;Mark of the web&rdquo; zu entfernen ist per <code>Unblock-File</code> oder per Eigenschaften Dialog der Datei.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Unblock-File</span> .\MeineDatei.docx
</span></span></code></pre></td></tr></table></div></div><p><a href=/images/2024/2024-08-30_NTFS_ADS_EigenschaftenDialog.jpg><img loading=lazy src=/images/2024/2024-08-30_NTFS_ADS_EigenschaftenDialog.jpg alt="Setzen des Hakens &amp;lsquo;Zulassen&amp;rsquo; in den Dateieigenschaften entfernt das Mark of the web" title="Setzen des Hakens 'Zulassen' in den Dateieigenschaften entfernt das Mark of the web"></a></p><h2 id=ntfs-alternate-data-streams-finden>NTFS Alternate Data Streams finden<a hidden class=anchor aria-hidden=true href=#ntfs-alternate-data-streams-finden>#</a></h2><p>Um herauszufinden, welche Alternate Data Streams vorhanden sind, kann der Parameter <code>-Stream</code> vom Cmdlet <code>Get-Item</code> genutzt werden. Mit <code>*</code> als Platzhalter können wir alle ADS finden.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Alle Streams von allen Daten im aktuellen Verzeichnis auflisten</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-Item</span> * -Stream *
</span></span></code></pre></td></tr></table></div></div><p>Die Info, dass der Standard <code>:$DATA</code> Stream vorhanden ist, können wir aber auch wegfiltern:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Get-Item</span> * -Stream * | <span style=color:#d0a8ff>Where-Object</span> {<span style=color:#41a1c0>$_</span>.Stream -ne <span style=color:#fc6a5d>&#39;:$DATA&#39;</span> }
</span></span></code></pre></td></tr></table></div></div><p>Noch etwas flexibler geht es mit <a href=https://github.com/diecknet/diecknet-scripts/blob/main/Windows/Get-NTFSADS.ps1 target=_blank>dem Skript <code>Get-NTFSADS.ps1</code></a> welches ich auf GitHub veröffentlicht habe.</p><h2 id=ntfs-alternate-data-streams-schreiben>NTFS Alternate Data Streams schreiben<a hidden class=anchor aria-hidden=true href=#ntfs-alternate-data-streams-schreiben>#</a></h2><p>Es ist möglich eigene Daten in ADS reinzuschreiben. Dafür kann z.B. <code>Set-Content</code>/<code>Add-Content</code> verwendet werden.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Zwei Varianten um den Beispiel Stream zu setzen, ggf. wird er überschrieben</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Set-Content</span> .\MeineDatei.docx -Stream <span style=color:#fc6a5d>&#34;Beispiel&#34;</span> -Value <span style=color:#fc6a5d>&#34;Hallo PowerShell!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Set-Content</span> .\MeineDatei.docx<span style=color:#960050>:</span>Beispiel -Value <span style=color:#fc6a5d>&#34;Hallo PowerShell!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Zwei Varianten um den Beispiel Stream zu ergänzen</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Add-Content</span> .\MeineDatei.docx -Stream <span style=color:#fc6a5d>&#34;Beispiel&#34;</span> -Value <span style=color:#fc6a5d>&#34;Hallo PowerShell!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Add-Content</span> .\MeineDatei.docx<span style=color:#960050>:</span>Beispiel -Value <span style=color:#fc6a5d>&#34;Hallo PowerShell!&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ntfs-alternate-data-streams-löschen>NTFS Alternate Data Streams löschen<a hidden class=anchor aria-hidden=true href=#ntfs-alternate-data-streams-löschen>#</a></h2><p>ADS können wie normale Dateien auch per <code>Remove-Item</code> gelöscht werden. Die Datei und der <code>:$DATA</code> Stream würden im folgenden Beispiel weiter existieren:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#d0a8ff>Remove-Item</span> .\MeineDatei.docx -Stream <span style=color:#fc6a5d>&#34;Beispiel&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=fazit>Fazit<a hidden class=anchor aria-hidden=true href=#fazit>#</a></h2><p>NTFS Alternate Data Streams sind eine interessante Funktion. Als Einfallstor für Angreifer sind sie weniger geeignet, da bei einem normalen Download keine zusätzlichen Data Streams übermittelt werden können. Aber in manchen Containerformaten könnten auch ADS übertragen werden, wie z.B. innerhalb von <code>.vhdx</code>-Dateien für virtuelle Festplattenabbilder. Allerdings wäre die Verwendung eines ADS-fähigen Containers auch schon sehr auffällig.</p><p>Ich denke, dass ADS dann eher von Angreifern verwendet werden könnten, wenn sie sich bereits in einem System eingenistet haben. Dann könnten Schadcodes oder andere Daten versteckt werden. Allerdings sollten (meiner Meinung nach) moderne EDR Lösungen anschlagen, falls ADS verwendet werden - technisch möglich wäre es z.B. per Sysmon Logging.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/de/tags/powershell/>Powershell</a></li><li><a href=https://diecknet.de/de/tags/ntfs/>Ntfs</a></li></ul><div class=share-buttons></div></footer><script src=https://giscus.diecknet.de/client.js data-repo=diecknet/diecknet-blog data-repo-id="MDEwOlJlcG9zaXRvcnkyMDkzNDUzNzM=" data-category="Blog Discussions" data-category-id=MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyNjMwOTY0 data-mapping=specific data-term=powershell-ntfs-alternate-data-streams data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://diecknet.de/de/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/de/legal/>Impressum</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/de/privacy/>Datenschutz</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Kopieren";function s(){t.innerHTML="Kopiert!",setTimeout(()=>{t.innerHTML="Kopieren"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>