<!doctype html><html lang=de dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PowerShell Befehle auf mehrere Zeilen aufteilen | diecknet</title>
<meta name=keywords content="powershell"><meta name=description content='PowerShell Befehle mit vielen Parametern k√∂nnen die Lesbarkeit vom Code verschlechtern. Zum Beispiel habe ich im nachfolgenden Codeabschnitt in Zeile 5 das Cmdlet New-ADUser verwendet und dabei 7 Parameter angegeben. Das ist sehr schwer auf einer Zeile zu lesen, selbst wenn ihr einen Ultra-Wide Monitor verwendet.
1 2 3 4 5 6 $CSVFile = Import-Csv .\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter "mail -eq &#39;$($User.Manager)&#39;" New-ADUser -Name "$($User.Vorname) $($User.'><meta name=author content="Andreas Dieckmann"><link rel=canonical href=https://diecknet.de/de/2024/05/15/powershell-multiline-commands/><link crossorigin=anonymous href=/assets/css/stylesheet.75a517428f403193483801122d6350f6956c3bb6bf5c6504311f8c24e6bab3e7.css integrity="sha256-daUXQo9AMZNIOAESLWNQ9pVsO7a/XGUEMR+MJOa6s+c=" rel="preload stylesheet" as=style><link rel=icon href=https://diecknet.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://diecknet.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://diecknet.de/favicon-32x32.png><link rel=apple-touch-icon href=https://diecknet.de/apple-touch-icon.png><link rel=mask-icon href=https://diecknet.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=de href=https://diecknet.de/de/2024/05/15/powershell-multiline-commands/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="PowerShell Befehle auf mehrere Zeilen aufteilen"><meta property="og:description" content='PowerShell Befehle mit vielen Parametern k√∂nnen die Lesbarkeit vom Code verschlechtern. Zum Beispiel habe ich im nachfolgenden Codeabschnitt in Zeile 5 das Cmdlet New-ADUser verwendet und dabei 7 Parameter angegeben. Das ist sehr schwer auf einer Zeile zu lesen, selbst wenn ihr einen Ultra-Wide Monitor verwendet.
1 2 3 4 5 6 $CSVFile = Import-Csv .\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter "mail -eq &#39;$($User.Manager)&#39;" New-ADUser -Name "$($User.Vorname) $($User.'><meta property="og:type" content="article"><meta property="og:url" content="https://diecknet.de/de/2024/05/15/powershell-multiline-commands/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="PowerShell Befehle auf mehrere Zeilen aufteilen"><meta name=twitter:description content='PowerShell Befehle mit vielen Parametern k√∂nnen die Lesbarkeit vom Code verschlechtern. Zum Beispiel habe ich im nachfolgenden Codeabschnitt in Zeile 5 das Cmdlet New-ADUser verwendet und dabei 7 Parameter angegeben. Das ist sehr schwer auf einer Zeile zu lesen, selbst wenn ihr einen Ultra-Wide Monitor verwendet.
1 2 3 4 5 6 $CSVFile = Import-Csv .\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter "mail -eq &#39;$($User.Manager)&#39;" New-ADUser -Name "$($User.Vorname) $($User.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://diecknet.de/de/posts/"},{"@type":"ListItem","position":2,"name":"PowerShell Befehle auf mehrere Zeilen aufteilen","item":"https://diecknet.de/de/2024/05/15/powershell-multiline-commands/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PowerShell Befehle auf mehrere Zeilen aufteilen","name":"PowerShell Befehle auf mehrere Zeilen aufteilen","description":"PowerShell Befehle mit vielen Parametern k√∂nnen die Lesbarkeit vom Code verschlechtern. Zum Beispiel habe ich im nachfolgenden Codeabschnitt in Zeile 5 das Cmdlet New-ADUser verwendet und dabei 7 Parameter angegeben. Das ist sehr schwer auf einer Zeile zu lesen, selbst wenn ihr einen Ultra-Wide Monitor verwendet.\n1 2 3 4 5 6 $CSVFile = Import-Csv .\\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter \u0026#34;mail -eq \u0026#39;$($User.Manager)\u0026#39;\u0026#34; New-ADUser -Name \u0026#34;$($User.Vorname) $($User.","keywords":["powershell"],"articleBody":"PowerShell Befehle mit vielen Parametern k√∂nnen die Lesbarkeit vom Code verschlechtern. Zum Beispiel habe ich im nachfolgenden Codeabschnitt in Zeile 5 das Cmdlet New-ADUser verwendet und dabei 7 Parameter angegeben. Das ist sehr schwer auf einer Zeile zu lesen, selbst wenn ihr einen Ultra-Wide Monitor verwendet.\n1 2 3 4 5 6 $CSVFile = Import-Csv .\\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter \"mail -eq '$($User.Manager)'\" New-ADUser -Name \"$($User.Vorname) $($User.Nachname)\" -Surname $User.Nachname -GivenName $User.Vorname -UserPrincipalName \"$($User.Vorname).$($User.Nachname)@demotenant.de\" -Department $User.Abteilung -Company \"Demotenant\" -Path \"OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de\" } Es w√ºrde die Lesbarkeit erh√∂hen, wenn wir den Befehl auf mehrere Zeilen aufteilen k√∂nnen. Deshalb zeige ich euch in diesem Artikel zwei M√∂glichkeiten um eure PowerShell Befehle auf mehrere Zeilen aufzuteilen.\nüé¨ Ich habe √ºbrigens auch ein Video zu dem Thema erstellt.\nBackticks Die erste M√∂glichkeit sind Backticks ` vor Zeilenumbr√ºchen. Das Backtick k√∂nnt ihr eingeben, indem ihr auf einer deutschen Tastatur die Umschalttaste gedr√ºckt haltet und dann oben rechts auf die Taste mit den zwei Akzentzeichen dr√ºckt. Mit dem Zeichen k√∂nnen in der PowerShell auch noch andere Sachen gemacht werden, aber wir verwenden es jetzt um das nachfolgende Zeichen, also den Zeilenumbruch zu escapen. Dadurch wird der Zeilenumbruch nicht als Ende des Befehls gewertet und wir k√∂nnen in der n√§chsten Zeile weiter machen. üëç\nTheoretisch k√∂nnt ihr trotzdem mehrere Parameter auf eine Zeile packen, aber ich finde es so am sch√∂nsten: Erst den Cmdlet Namen in die erste Zeile, dann Leerzeichen, Backtick, neuer Zeilenumbruch. Anschlie√üend r√ºcke ich mit einem Druck auf die Tab-Taste den Code ein St√ºck ein - das ist nur Optik, aber ich finde es dadurch besser lesbar. Also es wird dadurch besser erkennbar, dass diese neue Zeile zum Cmdlet dadr√ºber geh√∂rt. Nun folgt pro Zeile ein Parameter mit Parameterwert und jeweils ein Leerzeichen und ein Backtick, falls noch ein weiterer Parameter in der n√§chsten Zeile folgen soll.\nDer Code vom Anfang des Artikels umgebaut mit Backticks w√ºrde dann so aussehen:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $CSVFile = Import-Csv .\\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter \"mail -eq '$($User.Manager)'\" New-ADUser ` -Name \"$($User.Vorname) $($User.Nachname)\" ` -Surname $User.Nachname ` -GivenName $User.Vorname ` -UserPrincipalName \"$($User.Vorname).$($User.Nachname)@demotenant.de\" ` -Department $User.Abteilung ` -Company \"Demotenant\" ` -Path \"OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de\" } Dieser Code ist weitaus besser lesbar, funktioniert aber genauso wie das Original.\nGrunds√§tzlich finde ich diese Backtick Methode nicht so toll, weil diese Backticks so unscheinbar sind. Ich habe da immer Bedenken, dass sie dann sp√§ter √ºbersehen werden, wenn ich oder jemand anderes dieses Skript sp√§ter bearbeitet. Aber die Methode ist einfach umzusetzen und funktioniert.\nHinweis zu langen Pipelines Wenn ihr einen verketteten Befehl mit Pipes verwendet, dann k√∂nnt ihr auch das Pipe-Symbol jeweils an das Ende der Zeile setzen. Und dann f√ºgt ihr einen Zeilenumbruch ein - es ist kein Backtick notwendig - und schreibt den n√§chsten Befehl der Pipeline in die n√§chste Zeile. Und wenn dann noch mehr Pipes folgen, dann k√∂nnt ihr das nat√ºrlich auch beliebig oft machen. Auch hier w√ºrde ich aber zwecks Lesbarkeit empfehlen, ab der zweiten Zeile den Code einzur√ºcken.\n1 2 3 4 5 6 7 # Originale Pipeline Get-Service | Where-Object {$_.Name -eq \"wuauserv\"} | Stop-Service # Mehrzeilige Pipeline Get-Service | Where-Object {$_.Name -eq \"wuauserv\"} | Stop-Service Splatting Eine Alternative zu den Backticks ist das sogenannte Splatting. Um das zu nutzen schreiben wir unsere Cmdlet Parameter als Sammlung in eine Variable und k√∂nnen sie dann einfach an unser Cmdlet ransplatten. Das urspr√ºngliche Beispiel vom Anfang dieses Artikels w√ºrde damit wie folgt aussehen:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $CSVFile = Import-Csv .\\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter \"mail -eq '$($User.Manager)'\" $MeineParameter = @{ Name = \"$($User.Vorname) $($User.Nachname)\" Surname = $User.Nachname GivenName = $User.Vorname UserPrincipalName = \"$($User.Vorname).$($User.Nachname)@demotenant.de\" Department = $User.Abteilung Company = \"Demotenant\" Path = \"OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de\" } New-ADUser @MeineParameter } Hier habe ich also zun√§chst einmal eine Hashtable mit dem Namen $MeineParameter erstellt (der Name ist frei w√§hlbar). In der Hashtable ist jeweils ein Eintrag f√ºr einen Parameter inklusive des jeweiligen Parameterwerts. Um jetzt an einem Cmdlet eine gesplattete Variable als Parameter zu verwenden, muss diese mit einem @-Symbol anstatt des normalen $-Symbol f√ºr Variablen angegeben werden. Parameternamen m√ºssen dann am Cmdlet nicht angegeben werden, denn die stehen ja alle in der Hashtable/Variable.\nDas sind die Grundlagen und ich finde es so weitaus sch√∂ner anzusehen als mit Backticks.\nTipps und Besonderheiten zum Splatting Mehrfach splatten Ihr k√∂nnt mehrfach splatten, also zwei oder mehr Hashtables verwenden (z.B. eine f√ºr Standardwerte wie OU). Am Cmdlet nennt ihr dann einfach mehrere Variablen mit der @-Schreibweise.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 $CSVFile = Import-Csv .\\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter \"mail -eq '$($User.Manager)'\" $StandardWerte = @{ Path = \"OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de\" } $MeineParameter = @{ Name = \"$($User.Vorname) $($User.Nachname)\" Surname = $User.Nachname GivenName = $User.Vorname UserPrincipalName = \"$($User.Vorname).$($User.Nachname)@demotenant.de\" Department = $User.Abteilung Company = \"Demotenant\" } New-ADUser @MeineParameter @StandardWerte } Weitere Parameter manuell angeben Wenn ihr Parameter an ein Cmdlet splattet, m√ºsst ihr nicht ausschlie√ülich splatten. Ihr d√ºrft auch trotzdem noch Parameter direkt angeben. Zum Beispiel habe ich im folgenden Beispiel den Parameter Department nicht in der Hashtable definiert und gebe ihn stattdessen direkt am Cmdlet an:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 $CSVFile = Import-Csv .\\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter \"mail -eq '$($User.Manager)'\" $MeineParameter = @{ Name = \"$($User.Vorname) $($User.Nachname)\" Surname = $User.Nachname GivenName = $User.Vorname UserPrincipalName = \"$($User.Vorname).$($User.Nachname)@demotenant.de\" Company = \"Demotenant\" Path = \"OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de\" } New-ADUser @MeineParameter -Department \"IT-Abteilung\" } Gesplattete Werte √ºberschreiben In PowerShell 7 k√∂nnt ihr einen gesplatteten Wert auch manuell √ºberschreiben. Ein direkt genannter Parameter hat Vorrang. In der Windows PowerShell geht das leider nicht. Im nachfolgenden Beispiel √ºberschreibe ich den Company Wert direkt am Cmdlet - der Wert aus der Hashtable wird also ignoriert. Alle weiteren Werte gesplatteten Werte werden aber verwendet.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $CSVFile = Import-Csv .\\NeueUser.csv foreach($User in $CSVFile) { $Manager = Get-ADUser -Filter \"mail -eq '$($User.Manager)'\" $MeineParameter = @{ Name = \"$($User.Vorname) $($User.Nachname)\" Surname = $User.Nachname GivenName = $User.Vorname UserPrincipalName = \"$($User.Vorname).$($User.Nachname)@demotenant.de\" Department = $User.Abteilung Company = \"Demotenant\" Path = \"OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de\" } New-ADUser @MeineParameter -Company \"diecknet\" } Array statt Hashtable Theoretisch m√ºsst ihr nicht mal eine Hashtable verwenden, es geht auch mit einem Array. Bei einem Array gibt aber ja gar keinen Namen f√ºr einen Eintrag, die sind einfach nur durchnummeriert von 0 bis unendlich. Deshalb funktioniert das nur f√ºr positionale Parameter. Nehmen wir mal einen anderen Befehl. Das Cmdlet New-ADGroup kann neue Gruppen im Active Directory anlegen. Und der Befehl unterst√ºtzt zwei positionale Parameter. Als ersten den Namen der Gruppe und als zweiten den GroupScope. Mit dem Wissen k√∂nnen wir wie folgt splatten:\n1 2 $MeinArray = \"Meine lustige Gruppe\", \"DomainLocal\" New-ADGroup @MeinArray Weitere Parameter k√∂nnte ich hier nat√ºrlich auch wieder direkt angeben, oder auch theoretisch noch zus√§tzlich eine Hashtable ransplatten. Aber dann h√§tte ich auch gleich nur eine Hashtable verwenden k√∂nnen üòí.\nGrunds√§tzlich w√ºrde ich aber eigentlich immer eine Hashtable statt einem Array f√ºrs Splatting verwenden, weil es einfach besser verst√§ndlich ist, wenn die Parameternamen auch sichtbar sind.\nFazit Ich hoffe das hat euch geholfen, euren PowerShell Code ein bisschen besser lesbar zu machen. Ich pers√∂nlich finde die Hashtable Schreibweise eigentlich besser, aber auch die Backtick-Methode hat seine Daseinsberechtigung.\n","wordCount":"1232","inLanguage":"de","datePublished":"2024-05-15T00:00:00Z","dateModified":"2024-05-15T00:00:00Z","author":{"@type":"Person","name":"Andreas Dieckmann"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://diecknet.de/de/2024/05/15/powershell-multiline-commands/"},"publisher":{"@type":"Organization","name":"diecknet","logo":{"@type":"ImageObject","url":"https://diecknet.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://diecknet.de/de/ accesskey=h title="diecknet (Alt + H)">diecknet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://diecknet.de/de/ title=Deutsch aria-label=Deutsch><b>Deutsch</b></a></li><li><a href=https://diecknet.de/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://diecknet.de/de/ title=Home><span>Home</span></a></li><li><a href=https://diecknet.de/de/about/ title=About><span>About</span></a></li><li><a href=https://diecknet.de/de/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://diecknet.de/de/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://diecknet.de/de/>Home</a>&nbsp;¬ª&nbsp;<a href=https://diecknet.de/de/posts/>Posts</a></div><h1 class=post-title>PowerShell Befehle auf mehrere Zeilen aufteilen</h1><div class=post-meta><span title='2024-05-15 00:00:00 +0000 UTC'>2024-05-15</span>&nbsp;¬∑&nbsp;6 Minuten&nbsp;¬∑&nbsp;Andreas Dieckmann&nbsp;|&nbsp;<a href=https://github.com/diecknet/diecknet-blog/tree/main/content/de/posts/2024/2024-05-15-PowerShell-MultiLine-Commands.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Inhaltsverzeichnis</span></summary><div class=inner><ul><li><a href=#backticks aria-label=Backticks>Backticks</a><ul><li><a href=#hinweis-zu-langen-pipelines aria-label="Hinweis zu langen Pipelines">Hinweis zu langen Pipelines</a></li></ul></li><li><a href=#splatting aria-label=Splatting>Splatting</a><ul><li><a href=#tipps-und-besonderheiten-zum-splatting aria-label="Tipps und Besonderheiten zum Splatting">Tipps und Besonderheiten zum Splatting</a><ul><li><a href=#mehrfach-splatten aria-label="Mehrfach splatten">Mehrfach splatten</a></li><li><a href=#weitere-parameter-manuell-angeben aria-label="Weitere Parameter manuell angeben">Weitere Parameter manuell angeben</a></li><li><a href=#gesplattete-werte-%c3%bcberschreiben aria-label="Gesplattete Werte √ºberschreiben">Gesplattete Werte √ºberschreiben</a></li><li><a href=#array-statt-hashtable aria-label="Array statt Hashtable">Array statt Hashtable</a></li></ul></li></ul></li><li><a href=#fazit aria-label=Fazit>Fazit</a></li></ul></div></details></div><div class=post-content><p>PowerShell Befehle mit vielen Parametern k√∂nnen die Lesbarkeit vom Code verschlechtern. Zum Beispiel habe ich im nachfolgenden Codeabschnitt in Zeile 5 das Cmdlet <code>New-ADUser</code> verwendet und dabei 7 Parameter angegeben. Das ist sehr schwer auf einer Zeile zu lesen, selbst wenn ihr einen Ultra-Wide Monitor verwendet.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$CSVFile</span> = <span style=color:#d0a8ff>Import-Csv</span> .\NeueUser.csv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fc5fa3>foreach</span>(<span style=color:#41a1c0>$User</span> <span style=color:#fc5fa3>in</span> <span style=color:#41a1c0>$CSVFile</span>) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$Manager</span> = <span style=color:#d0a8ff>Get-ADUser</span> -Filter <span style=color:#fc6a5d>&#34;mail -eq &#39;</span>$(<span style=color:#41a1c0>$User</span>.Manager)<span style=color:#fc6a5d>&#39;&#34;</span>
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#d0a8ff>New-ADUser</span> -Name <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d> </span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>&#34;</span> -Surname <span style=color:#41a1c0>$User</span>.Nachname -GivenName <span style=color:#41a1c0>$User</span>.Vorname -UserPrincipalName <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d>.</span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>@demotenant.de&#34;</span> -Department <span style=color:#41a1c0>$User</span>.Abteilung -Company <span style=color:#fc6a5d>&#34;Demotenant&#34;</span> -Path <span style=color:#fc6a5d>&#34;OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Es w√ºrde die Lesbarkeit erh√∂hen, wenn wir den Befehl auf mehrere Zeilen aufteilen k√∂nnen.
Deshalb zeige ich euch in diesem Artikel zwei M√∂glichkeiten um eure PowerShell Befehle auf mehrere Zeilen aufzuteilen.</p><p><strong>üé¨ Ich habe √ºbrigens auch ein <a href="https://www.youtube.com/watch?v=dMR0rrC_xIw" target=_blank>Video zu dem Thema erstellt.</a></strong></p><h2 id=backticks>Backticks<a hidden class=anchor aria-hidden=true href=#backticks>#</a></h2><p>Die erste M√∂glichkeit sind Backticks <code>`</code> vor Zeilenumbr√ºchen. Das Backtick k√∂nnt ihr eingeben, indem ihr auf einer deutschen Tastatur die Umschalttaste gedr√ºckt haltet und dann oben rechts auf die Taste mit den zwei Akzentzeichen dr√ºckt. Mit dem Zeichen k√∂nnen in der PowerShell auch noch andere Sachen gemacht werden, aber wir verwenden es jetzt um das nachfolgende Zeichen, also den Zeilenumbruch zu escapen. Dadurch wird der Zeilenumbruch nicht als Ende des Befehls gewertet und wir k√∂nnen in der n√§chsten Zeile weiter machen. üëç</p><p>Theoretisch k√∂nnt ihr trotzdem mehrere Parameter auf eine Zeile packen, aber ich finde es so am sch√∂nsten: Erst den Cmdlet Namen in die erste Zeile, dann Leerzeichen, Backtick, neuer Zeilenumbruch. Anschlie√üend r√ºcke ich mit einem Druck auf die Tab-Taste den Code ein St√ºck ein - das ist nur Optik, aber ich finde es dadurch besser lesbar. Also es wird dadurch besser erkennbar, dass diese neue Zeile zum Cmdlet dadr√ºber geh√∂rt. Nun folgt pro Zeile ein Parameter mit Parameterwert und jeweils ein Leerzeichen und ein Backtick, falls noch ein weiterer Parameter in der n√§chsten Zeile folgen soll.</p><p>Der Code vom Anfang des Artikels umgebaut mit Backticks w√ºrde dann so aussehen:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$CSVFile</span> = <span style=color:#d0a8ff>Import-Csv</span> .\NeueUser.csv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fc5fa3>foreach</span>(<span style=color:#41a1c0>$User</span> <span style=color:#fc5fa3>in</span> <span style=color:#41a1c0>$CSVFile</span>) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$Manager</span> = <span style=color:#d0a8ff>Get-ADUser</span> -Filter <span style=color:#fc6a5d>&#34;mail -eq &#39;</span>$(<span style=color:#41a1c0>$User</span>.Manager)<span style=color:#fc6a5d>&#39;&#34;</span>
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#d0a8ff>New-ADUser</span> `
</span></span><span style=display:flex;background-color:#353539><span>        -Name <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d> </span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>&#34;</span> `
</span></span><span style=display:flex;background-color:#353539><span>        -Surname <span style=color:#41a1c0>$User</span>.Nachname `
</span></span><span style=display:flex;background-color:#353539><span>        -GivenName <span style=color:#41a1c0>$User</span>.Vorname `
</span></span><span style=display:flex;background-color:#353539><span>        -UserPrincipalName <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d>.</span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>@demotenant.de&#34;</span> `
</span></span><span style=display:flex;background-color:#353539><span>        -Department <span style=color:#41a1c0>$User</span>.Abteilung `
</span></span><span style=display:flex;background-color:#353539><span>        -Company <span style=color:#fc6a5d>&#34;Demotenant&#34;</span> `
</span></span><span style=display:flex;background-color:#353539><span>        -Path <span style=color:#fc6a5d>&#34;OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Dieser Code ist weitaus besser lesbar, funktioniert aber genauso wie das Original.</p><p>Grunds√§tzlich finde ich diese Backtick Methode nicht so toll, weil diese Backticks so unscheinbar sind. Ich habe da immer Bedenken, dass sie dann sp√§ter √ºbersehen werden, wenn ich oder jemand anderes dieses Skript sp√§ter bearbeitet. Aber die Methode ist einfach umzusetzen und funktioniert.</p><h3 id=hinweis-zu-langen-pipelines>Hinweis zu langen Pipelines<a hidden class=anchor aria-hidden=true href=#hinweis-zu-langen-pipelines>#</a></h3><p>Wenn ihr einen verketteten Befehl mit Pipes verwendet, dann k√∂nnt ihr auch das Pipe-Symbol jeweils an das Ende der Zeile setzen. Und dann f√ºgt ihr einen Zeilenumbruch ein - <strong>es ist kein Backtick notwendig</strong> - und schreibt den n√§chsten Befehl der Pipeline in die n√§chste Zeile. Und wenn dann noch mehr Pipes folgen, dann k√∂nnt ihr das nat√ºrlich auch beliebig oft machen. Auch hier w√ºrde ich aber zwecks Lesbarkeit empfehlen, ab der zweiten Zeile den Code einzur√ºcken.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#6c7986># Originale Pipeline</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-Service</span> | <span style=color:#d0a8ff>Where-Object</span> {<span style=color:#41a1c0>$_</span>.Name -eq <span style=color:#fc6a5d>&#34;wuauserv&#34;</span>} | <span style=color:#d0a8ff>Stop-Service</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7986># Mehrzeilige Pipeline</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>Get-Service</span> |
</span></span><span style=display:flex><span>    <span style=color:#d0a8ff>Where-Object</span> {<span style=color:#41a1c0>$_</span>.Name -eq <span style=color:#fc6a5d>&#34;wuauserv&#34;</span>} |
</span></span><span style=display:flex><span>    <span style=color:#d0a8ff>Stop-Service</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=splatting>Splatting<a hidden class=anchor aria-hidden=true href=#splatting>#</a></h2><p>Eine Alternative zu den Backticks ist das sogenannte Splatting. Um das zu nutzen schreiben wir unsere Cmdlet Parameter als Sammlung in eine Variable und k√∂nnen sie dann einfach an unser Cmdlet ransplatten. Das urspr√ºngliche Beispiel vom Anfang dieses Artikels w√ºrde damit wie folgt aussehen:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$CSVFile</span> = <span style=color:#d0a8ff>Import-Csv</span> .\NeueUser.csv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fc5fa3>foreach</span>(<span style=color:#41a1c0>$User</span> <span style=color:#fc5fa3>in</span> <span style=color:#41a1c0>$CSVFile</span>) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$Manager</span> = <span style=color:#d0a8ff>Get-ADUser</span> -Filter <span style=color:#fc6a5d>&#34;mail -eq &#39;</span>$(<span style=color:#41a1c0>$User</span>.Manager)<span style=color:#fc6a5d>&#39;&#34;</span>
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#41a1c0>$MeineParameter</span> = @{
</span></span><span style=display:flex;background-color:#353539><span>        Name                = <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d> </span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>&#34;</span>
</span></span><span style=display:flex;background-color:#353539><span>        Surname             = <span style=color:#41a1c0>$User</span>.Nachname
</span></span><span style=display:flex;background-color:#353539><span>        GivenName           = <span style=color:#41a1c0>$User</span>.Vorname
</span></span><span style=display:flex;background-color:#353539><span>        UserPrincipalName   = <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d>.</span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>@demotenant.de&#34;</span> 
</span></span><span style=display:flex;background-color:#353539><span>        Department          = <span style=color:#41a1c0>$User</span>.Abteilung 
</span></span><span style=display:flex;background-color:#353539><span>        Company             = <span style=color:#fc6a5d>&#34;Demotenant&#34;</span> 
</span></span><span style=display:flex;background-color:#353539><span>        Path                = <span style=color:#fc6a5d>&#34;OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de&#34;</span>
</span></span><span style=display:flex;background-color:#353539><span>    }
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#d0a8ff>New-ADUser</span> <span style=color:#41a1c0>@MeineParameter</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Hier habe ich also zun√§chst einmal eine Hashtable mit dem Namen <code>$MeineParameter</code> erstellt (der Name ist frei w√§hlbar). In der Hashtable ist jeweils ein Eintrag f√ºr einen Parameter inklusive des jeweiligen Parameterwerts. Um jetzt an einem Cmdlet eine gesplattete Variable als Parameter zu verwenden, muss diese mit einem <code>@</code>-Symbol anstatt des normalen <code>$</code>-Symbol f√ºr Variablen angegeben werden. Parameternamen m√ºssen dann am Cmdlet nicht angegeben werden, denn die stehen ja alle in der Hashtable/Variable.</p><p>Das sind die Grundlagen und ich finde es so weitaus sch√∂ner anzusehen als mit Backticks.</p><h3 id=tipps-und-besonderheiten-zum-splatting>Tipps und Besonderheiten zum Splatting<a hidden class=anchor aria-hidden=true href=#tipps-und-besonderheiten-zum-splatting>#</a></h3><h4 id=mehrfach-splatten>Mehrfach splatten<a hidden class=anchor aria-hidden=true href=#mehrfach-splatten>#</a></h4><p>Ihr k√∂nnt mehrfach splatten, also zwei oder mehr Hashtables verwenden (z.B. eine f√ºr Standardwerte wie OU). Am Cmdlet nennt ihr dann einfach mehrere Variablen mit der <code>@</code>-Schreibweise.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span></span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$CSVFile</span> = <span style=color:#d0a8ff>Import-Csv</span> .\NeueUser.csv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fc5fa3>foreach</span>(<span style=color:#41a1c0>$User</span> <span style=color:#fc5fa3>in</span> <span style=color:#41a1c0>$CSVFile</span>) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$Manager</span> = <span style=color:#d0a8ff>Get-ADUser</span> -Filter <span style=color:#fc6a5d>&#34;mail -eq &#39;</span>$(<span style=color:#41a1c0>$User</span>.Manager)<span style=color:#fc6a5d>&#39;&#34;</span>
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#41a1c0>$StandardWerte</span> =  @{
</span></span><span style=display:flex;background-color:#353539><span>        Path                = <span style=color:#fc6a5d>&#34;OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de&#34;</span>
</span></span><span style=display:flex;background-color:#353539><span>    }
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$MeineParameter</span> = @{
</span></span><span style=display:flex><span>        Name                = <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d> </span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>&#34;</span>
</span></span><span style=display:flex><span>        Surname             = <span style=color:#41a1c0>$User</span>.Nachname
</span></span><span style=display:flex><span>        GivenName           = <span style=color:#41a1c0>$User</span>.Vorname
</span></span><span style=display:flex><span>        UserPrincipalName   = <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d>.</span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>@demotenant.de&#34;</span> 
</span></span><span style=display:flex><span>        Department          = <span style=color:#41a1c0>$User</span>.Abteilung 
</span></span><span style=display:flex><span>        Company             = <span style=color:#fc6a5d>&#34;Demotenant&#34;</span> 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#d0a8ff>New-ADUser</span> <span style=color:#41a1c0>@MeineParameter</span> <span style=color:#41a1c0>@StandardWerte</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=weitere-parameter-manuell-angeben>Weitere Parameter manuell angeben<a hidden class=anchor aria-hidden=true href=#weitere-parameter-manuell-angeben>#</a></h4><p>Wenn ihr Parameter an ein Cmdlet splattet, m√ºsst ihr <strong>nicht</strong> ausschlie√ülich splatten. Ihr d√ºrft auch trotzdem noch Parameter direkt angeben. Zum Beispiel habe ich im folgenden Beispiel den Parameter <code>Department</code> nicht in der Hashtable definiert und gebe ihn stattdessen direkt am Cmdlet an:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$CSVFile</span> = <span style=color:#d0a8ff>Import-Csv</span> .\NeueUser.csv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fc5fa3>foreach</span>(<span style=color:#41a1c0>$User</span> <span style=color:#fc5fa3>in</span> <span style=color:#41a1c0>$CSVFile</span>) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$Manager</span> = <span style=color:#d0a8ff>Get-ADUser</span> -Filter <span style=color:#fc6a5d>&#34;mail -eq &#39;</span>$(<span style=color:#41a1c0>$User</span>.Manager)<span style=color:#fc6a5d>&#39;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$MeineParameter</span> = @{
</span></span><span style=display:flex><span>        Name                = <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d> </span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>&#34;</span>
</span></span><span style=display:flex><span>        Surname             = <span style=color:#41a1c0>$User</span>.Nachname
</span></span><span style=display:flex><span>        GivenName           = <span style=color:#41a1c0>$User</span>.Vorname
</span></span><span style=display:flex><span>        UserPrincipalName   = <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d>.</span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>@demotenant.de&#34;</span> 
</span></span><span style=display:flex><span>        Company             = <span style=color:#fc6a5d>&#34;Demotenant&#34;</span> 
</span></span><span style=display:flex><span>        Path                = <span style=color:#fc6a5d>&#34;OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#d0a8ff>New-ADUser</span> <span style=color:#41a1c0>@MeineParameter</span> -Department <span style=color:#fc6a5d>&#34;IT-Abteilung&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=gesplattete-werte-√ºberschreiben>Gesplattete Werte √ºberschreiben<a hidden class=anchor aria-hidden=true href=#gesplattete-werte-√ºberschreiben>#</a></h4><p>In PowerShell 7 k√∂nnt ihr einen gesplatteten Wert auch manuell √ºberschreiben. Ein direkt genannter Parameter hat Vorrang. In der Windows PowerShell geht das leider nicht. Im nachfolgenden Beispiel √ºberschreibe ich den <code>Company</code> Wert direkt am Cmdlet - der Wert aus der Hashtable wird also ignoriert. Alle weiteren Werte gesplatteten Werte werden aber verwendet.</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style=background-color:#353539><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$CSVFile</span> = <span style=color:#d0a8ff>Import-Csv</span> .\NeueUser.csv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fc5fa3>foreach</span>(<span style=color:#41a1c0>$User</span> <span style=color:#fc5fa3>in</span> <span style=color:#41a1c0>$CSVFile</span>) {
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$Manager</span> = <span style=color:#d0a8ff>Get-ADUser</span> -Filter <span style=color:#fc6a5d>&#34;mail -eq &#39;</span>$(<span style=color:#41a1c0>$User</span>.Manager)<span style=color:#fc6a5d>&#39;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#41a1c0>$MeineParameter</span> = @{
</span></span><span style=display:flex><span>        Name                = <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d> </span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>&#34;</span>
</span></span><span style=display:flex><span>        Surname             = <span style=color:#41a1c0>$User</span>.Nachname
</span></span><span style=display:flex><span>        GivenName           = <span style=color:#41a1c0>$User</span>.Vorname
</span></span><span style=display:flex><span>        UserPrincipalName   = <span style=color:#fc6a5d>&#34;</span>$(<span style=color:#41a1c0>$User</span>.Vorname)<span style=color:#fc6a5d>.</span>$(<span style=color:#41a1c0>$User</span>.Nachname)<span style=color:#fc6a5d>@demotenant.de&#34;</span> 
</span></span><span style=display:flex><span>        Department          = <span style=color:#41a1c0>$User</span>.Abteilung 
</span></span><span style=display:flex><span>        Company             = <span style=color:#fc6a5d>&#34;Demotenant&#34;</span> 
</span></span><span style=display:flex><span>        Path                = <span style=color:#fc6a5d>&#34;OU=User,OU=Demotenant,DC=lan,DC=demotenant,DC=de&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex;background-color:#353539><span>    <span style=color:#d0a8ff>New-ADUser</span> <span style=color:#41a1c0>@MeineParameter</span> -Company <span style=color:#fc6a5d>&#34;diecknet&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=array-statt-hashtable>Array statt Hashtable<a hidden class=anchor aria-hidden=true href=#array-statt-hashtable>#</a></h4><p>Theoretisch m√ºsst ihr nicht mal eine Hashtable verwenden, es geht auch mit einem Array. Bei einem Array gibt aber ja gar keinen Namen f√ºr einen Eintrag, die sind einfach nur durchnummeriert von 0 bis unendlich. Deshalb funktioniert das nur f√ºr positionale Parameter. Nehmen wir mal einen anderen Befehl. Das Cmdlet <code>New-ADGroup</code> kann neue Gruppen im Active Directory anlegen. Und der Befehl unterst√ºtzt zwei positionale Parameter. Als ersten den Namen der Gruppe und als zweiten den GroupScope. Mit dem Wissen k√∂nnen wir wie folgt splatten:</p><div class=highlight><div style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#fff;background-color:#1f1f24;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#41a1c0>$MeinArray</span> = <span style=color:#fc6a5d>&#34;Meine lustige Gruppe&#34;</span>, <span style=color:#fc6a5d>&#34;DomainLocal&#34;</span>
</span></span><span style=display:flex><span><span style=color:#d0a8ff>New-ADGroup</span> <span style=color:#41a1c0>@MeinArray</span>
</span></span></code></pre></td></tr></table></div></div><p>Weitere Parameter k√∂nnte ich hier nat√ºrlich auch wieder direkt angeben, oder auch theoretisch noch zus√§tzlich eine Hashtable ransplatten. Aber dann h√§tte ich auch gleich nur eine Hashtable verwenden k√∂nnen üòí.</p><p>Grunds√§tzlich w√ºrde ich aber eigentlich immer eine Hashtable statt einem Array f√ºrs Splatting verwenden, weil es einfach besser verst√§ndlich ist, wenn die Parameternamen auch sichtbar sind.</p><h2 id=fazit>Fazit<a hidden class=anchor aria-hidden=true href=#fazit>#</a></h2><p>Ich hoffe das hat euch geholfen, euren PowerShell Code ein bisschen besser lesbar zu machen. Ich pers√∂nlich finde die Hashtable Schreibweise eigentlich besser, aber auch die Backtick-Methode hat seine Daseinsberechtigung.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://diecknet.de/de/tags/powershell/>Powershell</a></li></ul><div class=share-buttons></div></footer><script src=https://giscus.diecknet.de/client.js data-repo=diecknet/diecknet-blog data-repo-id="MDEwOlJlcG9zaXRvcnkyMDkzNDUzNzM=" data-category="Blog Discussions" data-category-id=MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyNjMwOTY0 data-mapping=specific data-term=powershell-multiline-commands data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://diecknet.de/de/>diecknet</a></span>
&nbsp;|&nbsp;
<span><a href=https://diecknet.de/de/legal/>Impressum</a>
</span>&nbsp;|&nbsp;<span>
<a href=https://diecknet.de/de/privacy/>Datenschutz</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Kopieren";function s(){t.innerHTML="Kopiert!",setTimeout(()=>{t.innerHTML="Kopieren"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script type=text/javascript>var _paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="//nc.diecknet.de/mt/",_paq.push(["setTrackerUrl",t+"mdata"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.defer=!0,e.src=t+"m.js",s.parentNode.insertBefore(e,s)}()</script><noscript><p><img src="https://nc.diecknet.de/mt/mdata?idsite=1&amp;rec=1" style=border:0 alt></p></noscript></body></html>